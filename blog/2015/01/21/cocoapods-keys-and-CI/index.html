
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>CocoaPods-Keys and CI - Artsy Engineering</title>
  <meta name="author" content="Artsy">

  
  <meta name="description" content="We built CocoaPods-Keys as a way to remove API keys and secrets from our source code. We use it to open up our code to the pubic, without leaking &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://artsy.github.io/blog/2015/01/21/cocoapods-keys-and-CI">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Artsy Engineering" type="application/atom+xml">
  <!--[if IE 8]>
<link href="/stylesheets/custom/ie_font.css" type="text/css">
<![endif]-->

<!--- MathJax Configuration -->
<script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12450662-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


<body>

  <a href="/">
    <h1 id="lrg-mark">
      <span>Artsy</span>
    </h1>
  </a>

  <header id="banner"><hgroup>
  <div id="header">
    <h2>Inspiration from the engineering team at <a href="https://artsy.net">Artsy</a> â€” Discover, Research, and Collect the World's Best Art Online.</h2>
  </div>
</hgroup>

</header>

  <div id="main">
    
      <div id="mobile_search">
        <form action="https://www.google.com/cse" method="get">
          <input type="hidden" value="010245880960712892902:tnjd4ryb3ci" name="cx" />
          <input class="search" type="text" name="q" results="0" placeholder="Search" />
        </form>
      </div>
    
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
    <a href="">
      <div class="date">




  
<time datetime="2015-01-21T16:43:00-05:00" pubdate>01/21/15</time></div>
    
    
      <h1 class="entry-title">CocoaPods-Keys and CI</h1>
    
    </a>
    
      <p class="meta">
        
      </p>
    
  </header>


<div class="entry-content"><p>We built CocoaPods-Keys as a way to remove API keys and secrets from our source code. We use it to open up our code to the pubic, without leaking private details. One of the cool things about doing it this way was that we could all use different API keys stashed away in each developers Keychain.</p>

<p>To ensure we could run CI on our apps we came up with two different ways to use keys on CI. This post explains them both.</p>

<!-- more -->


<h2>The easy way.</h2>

<p>Depending on your use-case, you may not need to use the keys at all in your testing. This works really well if you&#8217;re using stubbed network requests. So if you have a keys definition in your <a href="https://github.com/artsy/eidolon/blob/9a918108e717a68a45709345f38d55e0eeb1f8b3/Podfile#L4-L21">Podfile</a> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">plugin</span> <span class="s1">&#39;cocoapods-keys&#39;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:project</span> <span class="o">=&gt;</span> <span class="s2">&quot;Eidolon&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:target</span> <span class="o">=&gt;</span> <span class="s2">&quot;Kiosk&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:keys</span> <span class="o">=&gt;</span> <span class="o">[</span>
</span><span class='line'>    <span class="s2">&quot;ArtsyAPIClientSecret&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;ArtsyAPIClientKey&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before the CI runs <code>pod install</code> you will want ensure you have already set the keys to be dummy data. So in either your <code>install:</code> or <code>before_install:</code> add commands like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">pod</span> <span class="n">keys</span> <span class="n">set</span> <span class="no">ArtsyAPIClientSecret</span> <span class="s2">&quot;-&quot;</span> <span class="no">Eidolon</span>
</span><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">pod</span> <span class="n">keys</span> <span class="n">set</span> <span class="no">ArtsyAPIClientKey</span> <span class="s2">&quot;-&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will set up the keys beforehand with the right target name.</p>

<h2>The fully featured way</h2>

<p>If you need to have full access to an API with secret keys, we recommend using the CI&#8217;s private environment keys feature. You can see the technique being used here in Eidolon, starting on <a href="https://github.com/artsy/eidolon/blob/master/.travis.yml#L5">line 5</a> we declare a secure environment key <code>GITHUB_API_KEY</code> in that hash. Then it is used on <a href="https://github.com/artsy/eidolon/blob/aa8e8447f797c483ff72148d124d2930b58a42e7/.travis.yml#L8">line 8</a> to set up our <code>~/.netrc</code>.</p>

<p>To get started on Travis CI you will need to install the travis gem, and go through the <a href="http://docs.travis-ci.com/user/environment-variables/">Environment Variables</a> section of their documentation. Notably the <a href="http://docs.travis-ci.com/user/environment-variables/#Secure-Variables">Secure Variables</a> section. In a gist, you run <code>travis encrypt ARTSYAPICLIENTSECRET=super_secret_yo</code> and it gives you the secure string.</p>

<p>You can then use the new keys in your <code>before:</code> section:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">pod</span> <span class="n">keys</span> <span class="n">set</span> <span class="no">ArtsyAPIClientSecret</span> <span class="vg">$ARTSYAPICLIENTSECRET</span> <span class="no">Eidolon</span>
</span><span class='line'><span class="n">bundle</span> <span class="nb">exec</span> <span class="n">pod</span> <span class="n">keys</span> <span class="n">set</span> <span class="no">ArtsyAPIClientKey</span> <span class="vg">$ARTSYAPICLIENTKEY</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s a wrap. We don&#8217;t use the second technique in any OSS repos, though there is talk of doing it on our <a href="https://github.com/artsy/Artsy_Authentication/">Artsy Authentication</a> pod. So if you&#8217;re in my future ðŸ‘‹, maybe give that a look over as an example of the latter.</p>
</div>


  <footer>
    <div class="meta">
      
  



  <span class="byline author vcard">
    Posted by 
    <span class="fn">
      Orta
    </span>
    
    
    
    
      (
      
      <span class="fn">
        <a href="http://orta.io/">blog</a>
      </span>
      
      
      <span class="fn">
        <a href="https://www.github.com/orta">github</a>
      </span>
      
      
      <span class="fn">
        <a href="http://twitter.com/orta">twitter</a>
      </span>
      
      )
    
    
  </span>


    </div>
    <div class="meta">
      Categories: 

<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>iOS</a>, <a class='category' href='/blog/categories/mobile/'>mobile</a>
  
</span>


    </div>

    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://artsy.github.io/blog/2015/01/21/cocoapods-keys-and-CI/" data-via="artsy" data-counturl="http://artsy.github.io/blog/2015/01/21/cocoapods-keys-and-CI/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/01/04/cocoapods-and-frameworks/" title="Previous Post: CocoaPods and Frameworks">&laquo; CocoaPods and Frameworks</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/03/23/artsy-technology-stack-2015/" title="next Post: Artsy's Technology Stack, 2015">Artsy's Technology Stack, 2015 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>
    </div>
    <div id="sidebar">
      
  
    <section>
  <h1>Info</h1>
  <ul>
    <li> <a href="/about">About Us</a></li>
    <li> <a href="/open-source">Artsy Open-Source</a></li>
    <li> <a href="https://developers.artsy.net">Artsy Public API</a></li>
    <li> <a href="https://artsy.net/job/developer">Join the Artsy Engineering Team</a></li>
  </ul>
</section>
<section id="recent_posts_section">
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/28/how-we-open-sourced-eigen/">How we Open Source'd Eigen</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/09/so-you-want-an-ssl-certificate/">So You Want an SSL Certificate? A Pragmatic Handbook</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/08/creating-a-dynamic-single-page-app-for-our-genome-team-using-react/">Trying out React</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/03/artsy-engineering-compensation-framework/">Artsy's Engineering Compensation Framework</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/31/the-culture-of-openness-artsy-mobile/">The Culture of Openness in the Artsy Mobile Team</a>
      </li>
    
  </ul>
  <a class="archive_link" href="/blog/archives">Blog Archive</a>
</section>

<section>
  <h1>Search</h1>
  <form action="https://www.google.com/cse" method="get">
    <input type="hidden" value="010245880960712892902:tnjd4ryb3ci" name="cx" />
    <input class="search" type="text" name="q" results="0" />
  </form>
</section>


  


    </div>
  </div>
  <footer id="main_footer"><p>
  Copyright &copy; 2015 - Artsy -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'artsy';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://artsy.github.io/blog/2015/01/21/cocoapods-keys-and-CI/';
        var disqus_url = 'http://artsy.github.io/blog/2015/01/21/cocoapods-keys-and-CI/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
