<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Conditional types in TypeScript - Artsy Engineering</title>
  <meta name="author" content="">

  
  <meta name="description" content="This year TypeScript gained a new feature that punches far above its weight.

Working through our (enormous) backlog of unsorted TypeScript "Sugges...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:image" content="http://artsy.github.io/images/artsy_oss_image.png" />
  <meta property="og:image:type" content="image/png" />

  
  <link rel="canonical" href="http://artsy.github.io/blog/2018/11/21/conditional-types-in-typescript/">
  <link rel="alternate" type="application/rss+xml" title="Artsy Engineering Blog" href="/feed">

  <link href="/favicon.ico" rel="icon">
  <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <script src="/javascripts/jquery-1.11.3.min.js"> </script>
  <script src="/javascripts/gradient-fade.js"></script>
  <script src="/javascripts/noframework.waypoints.min.js"></script>
  <script src="/javascripts/sticky.min.js"></script>
  <script src="/javascripts/search.min.js"></script>

  

  <script type="text/javascript" src="https://fast.fonts.net/jsapi/f7f47a40-b25b-44ee-9f9c-cfdfc8bb2741.js"></script>


  <link href="" rel="alternate" title="Artsy Engineering" type="application/atom+xml">
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12450662-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <!--[if IE 8]><link href="/stylesheets/custom/ie_font.css" type="text/css"><![endif]-->

</head>


<link href="/css/epic.css" media="screen, projection" rel="stylesheet" type="text/css">



<body>
  <div>
    <div id="bodywrapper">
      <header>
        <ul>
          <li><a href="/">Artsy Engineering Blog</a></li>
          <li><a href="https://www.artsy.net/jobs">Careers</a></li>
          <li><a href="https://developers.artsy.net">API</a></li>
        </ul>

        <ul>
          <li><a href="http://artsy.github.io/open-source/">Our Open Source</a></li>
          <li><a href="http://twitter.com/artsyopensource">@artsyopensource</a></li>
          <li><a href="https://www.artsy.net">artsy.net</a></li>
        </ul>
      </header>

      <section>
        <header id="page">
          <h1>Conditional types in TypeScript</h1>
          <h3>
          <!-- Yep, single line so the comma lines up right -->
          By  David Sheldrick
          </h3>
        </header>

        <article class='post'>
          <p>This year TypeScript gained a new feature that punches far above its weight.</p>

<blockquote><p>Working through our (enormous) backlog of unsorted TypeScript "Suggestions" and it's remarkable how many of them
are solved by conditional types.</p></blockquote>

<p>-- <a href="https://twitter.com/SeaRyanC/status/1029846761718702081">Ryan Cavanaugh</a>, TypeScript maintainer</p>

<p>Conditional types probably aren't something you'll write every day, but you might end up using them indirectly all
the time. That's because they're great for 'plumbing' or 'framework' code, for dealing with API boundaries and
other behind-the-scenes kinda stuff. So, dear reader, read on! It's always good to learn how the sausage is made.
Then you can make sausage of your own.</p>

<p>Typewurst! üå≠</p>

<!-- more -->


<p><em>Note: This is a straightforward adaptation of a 35-minute presentation given at
<a href="https://www.meetup.com/Futurice-London-Beer-Tech/events/255295412/">Futurice London's TypeScript Night meetup</a>,
and therefore provides more context than an ordinary blog post might. I hope a lot of that context is interesting
and useful even for seasoned TypeScript developers. If you'd prefer a no-frills experience, check out the
<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html">TypeScript 2.8 Release notes</a> .</em></p>

<a name="Your.first.conditional.type"></a>
<h2>Your first conditional type</h2>

<p>Here's some plain JavaScript</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">text</span> <span class="o">&amp;&amp;</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/f/g</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">process</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reading the code, it's clear to a human that the <code>.toUpperCase()</code> method call is safe. We can tell that whenever a
string is passed in to <code>process</code>, a string will be returned.</p>

<p>But notice that we could also pass something like <code>null</code> into the function, in which case <code>null</code> would be returned.
Then calling <code>.toUpperCase()</code> on the result would be an error.</p>

<p>Let's add basic types to this function so we can let TypeScript worry about whether we are using it safely or not.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">text</span>: <span class="kt">string</span> <span class="o">|</span> <span class="kc">null</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span> <span class="o">|</span> <span class="kc">null</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">text</span> <span class="o">&amp;&amp;</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/f/g</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Seems sensible. What happens if we try to use it like before?</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="c1">//            ‚åÑ Type Error! :(</span>
</span><span class='line'><span class="nx">process</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>TypeScript complains because it thinks that the result of <code>process("foo")</code> might be <code>null</code>, even though we clever
humans know that it won't be. It can't figure out the runtime semantics of the function on its own.</p>

<p>One way of helping TS understand the function better is to use 'overloading'. Overloading involves providing
multiple type signatures for a single function, and letting TypeScript figure out which one to use in any given
context.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">text</span>: <span class="kt">null</span><span class="p">)</span><span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">text</span>: <span class="kt">string</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span><span class="p">;</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">process</span><span class="p">(</span><span class="nx">text</span>: <span class="kt">any</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we've said that if we pass a <code>string</code>, it returns a <code>string</code>, and if we pass <code>null</code>, it returns <code>null</code>. <em>(The
<code>any</code> type is ignored but still needs to be there for some reason</em> ü§∑‚ÄçÔ∏è<em>)</em></p>

<p>That works nicely:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="c1">// All clear!</span>
</span><span class='line'><span class="nx">process</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span>
</span><span class='line'><span class="c1">//           ‚åÑ Type Error! :)</span>
</span><span class='line'><span class="nx">process</span><span class="p">(</span><span class="kc">null</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>But there's another use case that doesn't work:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kr">declare</span> <span class="kr">const</span> <span class="nx">maybeFoo</span>: <span class="kt">string</span> <span class="o">|</span> <span class="kc">null</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//      ‚åÑ Type Error! :(</span>
</span><span class='line'><span class="nx">process</span><span class="p">(</span><span class="nx">maybeFoo</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>TypeScript won't let us pass something that is of type <code>string | null</code> because it's not smart enough to collapse
the overloaded signatures when that's possible. So we can either add yet another overload signature for the
<code>string | null</code> case, or we can be like <span style="white-space: nowrap; font-family: sans-serif;">(‚ïØ¬∞‚ñ°¬∞)‚ïØÔ∏µ
‚îª‚îÅ‚îª</span> and switch to using <strong>conditional types</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kd">function</span> <span class="nx">process</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kr">extends</span> <span class="kt">string</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span><span class="p">(</span>
</span><span class='line'>  <span class="nx">text</span>: <span class="kt">T</span>
</span><span class='line'><span class="p">)</span><span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="kt">string</span> <span class="o">?</span> <span class="kt">string</span> <span class="o">:</span> <span class="kc">null</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we've introduced a type variable <code>T</code> for the <code>text</code> parameter. We can then use <code>T</code> as part of a conditional
return type: <code>T extends string ? string : null</code>. You probably noticed that this looks just like a ternary
expression! Indeed, it's doing the same kind of thing, but within the type system at compile time.</p>

<p>And that takes care of all our use cases:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="k">typeof</span> <span class="nx">process</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span> <span class="c1">// =&gt; string</span>
</span><span class='line'><span class="k">typeof</span> <span class="nx">process</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span> <span class="c1">// =&gt; null</span>
</span><span class='line'><span class="k">typeof</span> <span class="nx">process</span><span class="p">(</span><span class="nx">maybeFoo</span><span class="p">)</span> <span class="c1">// =&gt; string | null</span>
</span></code></pre></td></tr></table></div></figure>


<p>So that's what a conditional type is! A kind of ternary type expression. It always has this form:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">A</span> <span class="kr">extends</span> <span class="nx">B</span> <span class="o">?</span> <span class="nx">C</span> : <span class="kt">D</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>A</code>, <code>B</code>, <code>C</code>, and <code>D</code> can be any old type expressions, but all the important stuff is happening on the left there.
In the <code>A extends B</code> condition.</p>

<a name="Assignability"></a>
<h2>Assignability</h2>

<p>This <code>extends</code> keyword is the heart of a conditional type. <code>A extends B</code> means precisely that any value of type <code>A</code>
can safely be assigned to a variable of type <code>B</code>. In type system jargon we can say that "A is <em>assignable</em> to B".</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kr">declare</span> <span class="kr">const</span> <span class="nx">a</span>: <span class="kt">A</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">b</span>: <span class="kt">B</span> <span class="o">=</span> <span class="nx">a</span>
</span><span class='line'><span class="c1">// type check succeeds only if A is assignable to B</span>
</span></code></pre></td></tr></table></div></figure>


<p>TypeScript decides which types are assignable to each other using an approach called 'structural typing'. This kind
of type system started appearing in mainstream languages relatively recently (in the last 10 years or so), and
might be a little counterintuitive if you come from a Java or C# background.</p>

<p>You may have heard of 'duck typing' in relation to dynamically-typed languages. The phrase 'duck typing' comes from
the proverb</p>

<blockquote><p>If it looks like a duck, swims like a duck, and quacks like a duck, then it probably is a duck.</p></blockquote>

<p>In duck typing, you judge a thing by how it behaves, rather than what it is called or who its parents are. It's a
kind of meritocracy. Structural typing is a way of applying that same idea to a static compile-time type system.</p>

<p>So TypeScript only cares about what types can do, not what they are called or where they exist in a type hierarchy.</p>

<p>Take this simple example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kr">class</span> <span class="nx">A</span> <span class="p">{}</span>
</span><span class='line'><span class="kr">class</span> <span class="nx">B</span> <span class="p">{}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">const</span> <span class="nx">b</span>: <span class="kt">B</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">()</span> <span class="c1">// ‚úî all good</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">a</span>: <span class="kt">A</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">B</span><span class="p">()</span> <span class="c1">// ‚úî all good</span>
</span><span class='line'>
</span><span class='line'><span class="k">new</span> <span class="nx">A</span><span class="p">()</span> <span class="k">instanceof</span> <span class="nx">B</span> <span class="c1">// =&gt; false</span>
</span></code></pre></td></tr></table></div></figure>


<p>TypeScript is happy treating two completely unrelated classes as equivalent because they have the same <em>structure</em>
and the same <em>capabilities</em>. Meanwhile, when checking the types at runtime, we discover that they are actually not
equivalent.</p>

<p>This is a notable example of where the semantics of TypeScript are at odds with JavaScript. It might seem like a
problem, but in practice structural typing is a lot more flexible than Java-esque 'nominal' typing, where names and
hierarchy matter. The two aren't mutually exclusive, however. Some languages, like Scala and Flow, allow you to mix
and match to suit particular problems.</p>

<p>Aside from that, the way that assignability works with structural typing is very intuitive.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kr">interface</span> <span class="nx">Shape</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">color</span>: <span class="kt">string</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kr">class</span> <span class="nx">Circle</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">color</span>: <span class="kt">string</span>
</span><span class='line'>  <span class="nx">radius</span>: <span class="kt">number</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ‚úî All good! Circles have a color</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">shape</span>: <span class="kt">Shape</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Circle</span><span class="p">()</span>
</span><span class='line'><span class="c1">// ‚úò Type error! Not all shapes have a radius!</span>
</span><span class='line'><span class="kr">const</span> <span class="nx">circle</span>: <span class="kt">Circle</span> <span class="o">=</span> <span class="nx">shape</span>
</span></code></pre></td></tr></table></div></figure>


<p>Speaking structurally we can say that <code>A extends B</code> is a lot like '<code>A</code> is a superset of <code>B</code>', or, to be more
verbose, '<code>A</code> has all of <code>B</code>'s properties, <em>and maybe some more</em>'.</p>

<p>There's one minor caveat though, and that's with 'literal' types. In TypeScript you can use literal values of
primitive types as types themselves.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kd">let</span> <span class="nx">fruit</span><span class="o">:</span> <span class="s2">&quot;banana&quot;</span> <span class="o">=</span> <span class="s2">&quot;banana&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Type Error! &quot;apple&quot; is not assignable to &quot;banana&quot;</span>
</span><span class='line'><span class="nx">fruit</span> <span class="o">=</span> <span class="s2">&quot;apple&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The string <code>"banana"</code> doesn't have more properties than any other <code>string</code>. But the type <code>"banana"</code> is
still more <em>specific</em> than the type <code>string</code>.</p>

<p>So another way to think of <code>A extends B</code> is like '<code>A</code> is a possibly-more-specific version of <code>B</code>'.</p>

<p>Which brings us to 'top' and 'bottom' types: the <em>least</em> and <em>most</em> specific types, respectively.</p>

<p>In type theory a 'top' type is one which all other types are assignable to. It is the type you use to say "I have
absolutely no information about what this value is". Think of it as the union of all possible types:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Top</span> <span class="o">=</span> <span class="kt">string</span> <span class="o">|</span> <span class="kt">number</span> <span class="o">|</span> <span class="p">{</span><span class="nx">foo</span>: <span class="kt">Bar</span><span class="p">}</span> <span class="o">|</span> <span class="nx">Baz</span><span class="p">[]</span> <span class="o">|</span> <span class="p">...</span> <span class="o">|</span> <span class="err">‚àû</span>
</span></code></pre></td></tr></table></div></figure>


<p>TypeScript has two top types: <code>any</code> and <code>unknown</code>.</p>

<ul>
<li>Using <code>any</code> is like saying "I have no idea what this value looks like. So, TypeScript, please assume I'm using it
correctly, and don't complain if anything I do seems dangerous".</li>
<li>Using <code>unknown</code> is like saying "I have no idea what this value looks like. So, TypeScript, please make sure I
check what it is capable of at run time."</li>
</ul>


<p>A 'bottom' type is one which no other types are assignable to, and that no values can be an instance of. Think of
it as the empty union type:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Bottom</span> <span class="o">=</span> <span class="err">‚àÖ</span>
</span></code></pre></td></tr></table></div></figure>


<p>TypeScript has one bottom type: <code>never</code>. That's a nice descriptive name because it literally means <em>this can never
happen</em>.</p>

<p>Top and bottom types are useful to know about when working with conditional types. <code>never</code> is especially useful
when using conditional types to refine unions...</p>

<a name="Refining.unions.with.distributive.conditional.types"></a>
<h2>Refining unions with distributive conditional types</h2>

<p>Conditional types let you filter out particular members of a union type. To illustrate, let's say we have a union
type called <code>Animal</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Animal</span> <span class="o">=</span> <span class="nx">Lion</span> <span class="o">|</span> <span class="nx">Zebra</span> <span class="o">|</span> <span class="nx">Tiger</span> <span class="o">|</span> <span class="nx">Shark</span>
</span></code></pre></td></tr></table></div></figure>


<p>And imagine that we needed to write a function that used only those animals which are also cats. We might write
some helper type called <code>ExtractCat</code> to do that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractCat</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">A</span> <span class="kr">extends</span> <span class="p">{</span> <span class="nx">meow</span><span class="p">()</span><span class="o">:</span> <span class="k">void</span> <span class="p">}</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">never</span>
</span><span class='line'>
</span><span class='line'><span class="nx">type</span> <span class="nx">Cat</span> <span class="o">=</span> <span class="nx">ExtractCat</span><span class="o">&lt;</span><span class="nx">Animal</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; Lion | Tiger</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>I know lions and tigers don't meow, but how cute would it be if they did</em> ^_^</p>

<p>This seemed vague and magical to me at first. Let's see what TypeScript is doing under the hood when it evaluates
<code>ExtractCat&lt;Animal&gt;</code>.</p>

<p>First, it applies <code>ExtractCat</code> recursively to all the members of <code>Animal</code>:</p>

<!-- prettier-ignore -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Cat</span> <span class="o">=</span>
</span><span class='line'>  <span class="o">|</span> <span class="nx">ExtractCat</span><span class="o">&lt;</span><span class="nx">Lion</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">|</span> <span class="nx">ExtractCat</span><span class="o">&lt;</span><span class="nx">Zebra</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">|</span> <span class="nx">ExtractCat</span><span class="o">&lt;</span><span class="nx">Tiger</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">|</span> <span class="nx">ExtractCat</span><span class="o">&lt;</span><span class="nx">Shark</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then it evaluates the conditional types:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Cat</span> <span class="o">=</span> <span class="nx">Lion</span> <span class="o">|</span> <span class="nx">never</span> <span class="o">|</span> <span class="nx">Tiger</span> <span class="o">|</span> <span class="nx">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then something fun happens... Remember that no values can ever be of type <code>never</code>? That makes it totally
meaningless to include <code>never</code> in a union type, so TypeScript just gets rid of it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Cat</span> <span class="o">=</span> <span class="nx">Lion</span> <span class="o">|</span> <span class="nx">Tiger</span>
</span></code></pre></td></tr></table></div></figure>


<p>The TypeScript jargon for this kind of conditional type is <strong>distributive conditional type</strong>.</p>

<p>That 'distribution', where the union is unrolled recursively, only happens when the thing on the left of the
<code>extends</code> keyword is a plain type variable. We'll see what that means and how to work around it in the next
section.</p>

<a name="A.real.use-case.for.distributive.conditional.types."></a>
<h2>A real use-case for distributive conditional types.</h2>

<p>A while ago I was building a Chrome extension. It had a 'background' script and a 'view' script that ran in
different execution contexts. They needed to communicate and share state, and the only way to do that is via
serializable message passing. I took inspiration from Redux and defined a global union of interfaces called
<code>Action</code> to model the messages that I wanted to be able to pass between the contexts.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Action</span> <span class="o">=</span>
</span><span class='line'>  <span class="o">|</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;INIT&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="o">|</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;SYNC&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="o">|</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;LOG_IN&quot;</span>
</span><span class='line'>      <span class="nx">emailAddress</span>: <span class="kt">string</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="o">|</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;LOG_IN_SUCCESS&quot;</span>
</span><span class='line'>      <span class="nx">accessToken</span>: <span class="kt">string</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="c1">// ...</span>
</span></code></pre></td></tr></table></div></figure>


<p>And then there was a global <code>dispatch</code> function that I could use directly to broadcast messages across contexts</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kr">declare</span> <span class="kd">function</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">action</span>: <span class="kt">Action</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dispatch</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;INIT&quot;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dispatch</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;LOG_IN&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">emailAddress</span><span class="o">:</span> <span class="s2">&quot;david.sheldrick@artsy.net&quot;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ...</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dispatch</span><span class="p">({</span>
</span><span class='line'>  <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;LOG_IN_SUCCESS&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">accessToken</span><span class="o">:</span> <span class="s2">&quot;038fh239h923908h&quot;</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p><a
  target="_blank"
  style="font-size: 0.8em"
  href="https://www.typescriptlang.org/play/#src=type%20Action%20%3D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22INIT%22%0D%0A%20%20%20%20%7D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22SYNC%22%0D%0A%20%20%20%20%7D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22LOG_IN%22%0D%0A%20%20%20%20%20%20emailAddress%3A%20string%0D%0A%20%20%20%20%7D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22LOG_IN_SUCCESS%22%0D%0A%20%20%20%20%20%20accessToken%3A%20string%0D%0A%20%20%20%20%7D%0D%0A%0D%0Adeclare%20function%20dispatch(action%3A%20Action)%3A%20void%0D%0A%0D%0Adispatch(%7B%0D%0A%20%20type%3A%20%22INIT%22%0D%0A%7D)%0D%0A%0D%0Adispatch(%7B%0D%0A%20%20type%3A%20%22LOG_IN%22%2C%0D%0A%20%20emailAddress%3A%20%22david.sheldrick%40artsy.net%22%0D%0A%7D)%0D%0A%0D%0Adispatch(%7B%0D%0A%20%20type%3A%20%22LOG_IN_SUCCESS%22%2C%0D%0A%20%20accessToken%3A%20%22038fh239h923908h%22%0D%0A%7D)">
<em>Try it in the TypeScript playground</em> </a></p>

<p>This API is typesafe and it plays well with my IDE's autocomplete and I could have left it there. I could have
moved on to other things.</p>

<p>But there's this little voice inside my head. I think most developers have this voice.</p>

<pre style="background: transparent; color: #333; border: 0; box-shadow: none; padding: 0;">
INT. HIPSTER CO-WORKING SPACE - DAY

DAVID sits on an oddly-shaped orange chair.
His MacBook rests askew on a lumpy reclaimed
wood desk. He stares at colorful text on a
dark screen.

A tiny whisper.

              VOICE (V.O.)
    Psst!

David looks around for a moment and then
stares back at the laptop.

              VOICE (V.O.)
    Psst! Hey!

Startled this time, David looks around
again. He speaks to nobody in particular.

              DAVID
    Is someone there?

              VOICE (V.O.)
    It's me, the DRY devil.

David heaves a painful sigh of recognition.

              DAVID
    Not you again! Leave me alone!

              DRY DEVIL (V.O.)
    DRY stands for "Don't Repeat Yourself"

              DAVID
    I know, you say that every time! Now
    get lost!

              DRY DEVIL (V.O.)
    I've noticed an issue with your code.

              DAVID
    Seriously, go away! I'm busy solving
    user problems to create business value.

              DRY DEVIL (V.O.)
    Every time you call `dispatch` you
    are typing 6 redundant characters.

              DAVID
    Oh snap! You're right! I must fix this.

MONTAGE

David spends the next 2 hours wrestling
with TypeScript, accumulating a pile of
empty coffee cups and protein ball wrappers.
</pre>


<p>We've all been there.</p>

<p>I wanted the dispatch function to work like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="c1">// first argument is the &#39;type&#39;</span>
</span><span class='line'><span class="c1">// second is any extra parameters</span>
</span><span class='line'><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;LOG_IN_SUCCESS&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">accessToken</span><span class="o">:</span> <span class="s2">&quot;038fh239h923908h&quot;</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Deriving the type for that first argument is easy enough.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ActionType</span> <span class="o">=</span> <span class="nx">Action</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
</span><span class='line'><span class="c1">// =&gt; &quot;INIT&quot; | &quot;SYNC&quot; | &quot;LOG_IN&quot; | &quot;LOG_IN_SUCCESS&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But the type of the second argument <em>depends on</em> the first argument. We can use a type variable to model that
dependency.</p>

<!-- prettier-ignore -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="kr">declare</span> <span class="kd">function</span> <span class="nx">dispatch</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kr">extends</span> <span class="nx">ActionType</span><span class="o">&gt;</span><span class="p">(</span>
</span><span class='line'>  <span class="nx">type</span>: <span class="kt">T</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">args</span>: <span class="kt">ExtractActionParameters</span><span class="o">&lt;</span><span class="nx">Action</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">)</span><span class="o">:</span> <span class="k">void</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Woah woah woah, what's this</em> <code>ExtractActionParameters</code> <em>voodoo?</em></p>

<p>It's a conditional type of course! Here's a first attempt at implementing it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractActionParameters</span><span class="o">&lt;</span><span class="nx">A</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">A</span> <span class="kr">extends</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">T</span> <span class="p">}</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a lot like the <code>ExtractCat</code> example from before, where we were were refining the <code>Animals</code> union by
searching for something that can <code>meow()</code>. Here, we're refining the <code>Action</code> union type by searching for an
interface with a particular <code>type</code> property. Let's see if it works:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">ExtractActionParameters</span><span class="o">&lt;</span><span class="nx">Action</span><span class="p">,</span> <span class="s2">&quot;LOG_IN&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; { type: &quot;LOG_IN&quot;, emailAddress: string }</span>
</span></code></pre></td></tr></table></div></figure>


<p>Almost there! We don't want to keep the <code>type</code> field after extraction because then we would still have to specify
it when calling <code>dispatch</code>. And that would somewhat defeat the purpose of this entire exercise.</p>

<p>We can omit the <code>type</code> field by combining a <strong>mapped type</strong> with a conditional type and the <code>keyof</code> operator.</p>

<p>A <strong>mapped type</strong> lets you create a new interface by 'mapping' over a union of keys. You can get a union of keys
from an existing interface by using the <code>keyof</code> operator. And finally, you can remove things from a union using a
conditional type. Here's how they play together (with some inline test cases for illustration):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExcludeTypeKey</span><span class="o">&lt;</span><span class="nx">K</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">K</span> <span class="kr">extends</span> <span class="s2">&quot;type&quot;</span> <span class="o">?</span> <span class="nx">never</span> : <span class="kt">K</span>
</span><span class='line'>
</span><span class='line'><span class="nx">type</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">ExcludeTypeKey</span><span class="o">&lt;</span><span class="s2">&quot;emailAddress&quot;</span> <span class="o">|</span> <span class="s2">&quot;type&quot;</span> <span class="o">|</span> <span class="s2">&quot;foo&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; &quot;emailAddress&quot; | &quot;foo&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// here&#39;s the mapped type</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">ExcludeTypeKey</span><span class="o">&lt;</span><span class="nx">keyof</span> <span class="nx">A</span><span class="o">&gt;</span><span class="p">]</span><span class="o">:</span> <span class="nx">A</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">type</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;LOG_IN&quot;</span><span class="p">;</span> <span class="nx">emailAddress</span>: <span class="kt">string</span> <span class="p">}</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; { emailAddress: string }</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we can use <code>ExcludeTypeField</code> to redefine <code>ExtractActionParameters</code>.</p>

<!-- prettier-ignore -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractActionParameters</span><span class="o">&lt;</span><span class="nx">A</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">A</span> <span class="kr">extends</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">T</span> <span class="p">}</span>
</span><span class='line'>  <span class="o">?</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">:</span> <span class="nx">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>And now the new version of <code>dipsatch</code> is typesafe!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="c1">// All clear! :)</span>
</span><span class='line'><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;LOG_IN_SUCCESS&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">accessToken</span><span class="o">:</span> <span class="s2">&quot;038fh239h923908h&quot;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;LOG_IN_SUCCESS&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// Type Error! :)</span>
</span><span class='line'>  <span class="nx">badKey</span><span class="o">:</span> <span class="s2">&quot;038fh239h923908h&quot;</span>
</span><span class='line'><span class="p">})</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Type Error! :)</span>
</span><span class='line'><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;BAD_TYPE&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">accessToken</span><span class="o">:</span> <span class="s2">&quot;038fh239h923908h&quot;</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p><a
  target="_blank"
  style="font-size: 0.8em"
  href="https://www.typescriptlang.org/play/#src=type%20Action%20%3D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22INIT%22%0D%0A%20%20%20%20%7D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22SYNC%22%0D%0A%20%20%20%20%7D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22LOG_IN%22%0D%0A%20%20%20%20%20%20emailAddress%3A%20string%0D%0A%20%20%20%20%7D%0D%0A%20%20%7C%20%7B%0D%0A%20%20%20%20%20%20type%3A%20%22LOG_IN_SUCCESS%22%0D%0A%20%20%20%20%20%20accessToken%3A%20string%0D%0A%20%20%20%20%7D%0D%0A%0D%0Atype%20ActionType%20%3D%20Action%5B%22type%22%5D%0D%0A%0D%0Adeclare%20function%20dispatch%3CT%20extends%20ActionType%3E(%0D%0A%20%20%20%20type%3A%20T%2C%0D%0A%20%20%20%20args%3A%20ExtractActionParameters%3CAction%2C%20T%3E%0D%0A)%3A%20void%0D%0A%0D%0Atype%20ExcludeTypeKey%3CK%3E%20%3D%20K%20extends%20%22type%22%20%3F%20never%20%3A%20K%0D%0A%0D%0Atype%20ExcludeTypeField%3CA%3E%20%3D%20%7B%20%5BK%20in%20ExcludeTypeKey%3Ckeyof%20A%3E%5D%3A%20A%5BK%5D%20%7D%0D%0A%0D%0Atype%20ExtractActionParameters%3CA%2C%20T%3E%20%3D%20A%20extends%20%7B%20type%3A%20T%20%7D%0D%0A%20%20%20%20%3F%20ExcludeTypeField%3CA%3E%0D%0A%20%20%20%20%3A%20never%0D%0A%20%20%0D%0A%2F%2F%20All%20clear!%20%3A)%0D%0Adispatch(%22LOG_IN_SUCCESS%22%2C%20%7B%0D%0A%20%20%20%20accessToken%3A%20%22038fh239h923908h%22%0D%0A%7D)%0D%0A%0D%0Adispatch(%22LOG_IN_SUCCESS%22%2C%20%7B%0D%0A%20%20%20%20%2F%2F%20Type%20Error!%20%3A)%0D%0A%20%20%20%20badKey%3A%20%22038fh239h923908h%22%0D%0A%7D)%0D%0A%0D%0A%2F%2F%20Type%20Error!%20%3A)%0D%0Adispatch(%22BAD_TYPE%22%2C%20%7B%0D%0A%20%20%20%20accessToken%3A%20%22038fh239h923908h%22%0D%0A%7D)">
<em>Try it in the TypeScript playground</em> </a></p>

<p>But there's one more very serious problem to address: If the action has no extra parameters, I still have to pass a
second empty argument.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span></code></pre></td></tr></table></div></figure>


<p>That's four whole wasted characters! Cancel my meetings and tell my partner not to wait up tonight! We need to
<em>fix. this</em>.</p>

<p>The na√Øve thing to do would be to make the second argument optional. That would be unsafe because, e.g. it would
allow us to dispatch a <code>"LOG_IN"</code> action without specifying an <code>emailAddress</code>.</p>

<p>Instead, let's overload the <code>dispatch</code> function.</p>

<!-- prettier-ignore -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="c1">// And let&#39;s say that any actions that don&#39;t require</span>
</span><span class='line'><span class="c1">// extra parameters are &#39;simple&#39; actions.</span>
</span><span class='line'><span class="kr">declare</span> <span class="kd">function</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">type</span>: <span class="kt">SimpleActionType</span><span class="p">)</span><span class="o">:</span> <span class="k">void</span>
</span><span class='line'><span class="c1">// this signature is just like before</span>
</span><span class='line'><span class="kr">declare</span> <span class="kd">function</span> <span class="nx">dispatch</span><span class="o">&lt;</span><span class="nx">T</span> <span class="kr">extends</span> <span class="nx">ActionType</span><span class="o">&gt;</span><span class="p">(</span>
</span><span class='line'>  <span class="nx">type</span>: <span class="kt">T</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">args</span>: <span class="kt">ExtractActionParameters</span><span class="o">&lt;</span><span class="nx">Action</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span>
</span><span class='line'><span class="p">)</span><span class="o">:</span> <span class="k">void</span>
</span><span class='line'>
</span><span class='line'><span class="nx">type</span> <span class="nx">SimpleActionType</span> <span class="o">=</span> <span class="nx">ExtractSimpleAction</span><span class="o">&lt;</span><span class="nx">Action</span><span class="o">&gt;</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>How can we define this <code>ExtractSimpleAction</code> conditional type? We know that if we remove the <code>type</code> field from an
action and the result is an empty interface, then that is a simple action. So something like this might work</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractSimpleAction</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="kr">extends</span> <span class="p">{}</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>Except that doesn't work. <code>ExcludeTypeField&lt;A&gt; extends {}</code> is always going to be true, because <code>{}</code> is like a top
type for interfaces. <em>Pretty much everything</em> is more specific than <code>{}</code>.</p>

<p>We need to swap the arguments around:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractSimpleAction</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{}</span> <span class="kr">extends</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now if <code>ExcludeTypeField&lt;A&gt;</code> is empty, the condition will be true, otherwise it will be false.</p>

<p>But this still doesn't work! On-the-ball readers might remember this:</p>

<blockquote><p>That 'distribution', where the union is unrolled recursively, only happens when the thing on the left of the
<code>extends</code> keyword is a plain type variable. We'll see what that means and how to work around it in the next
section.</p></blockquote>

<p>-- Me, in the previous section</p>

<p>Type variables are always defined in a generic parameter list, delimited by <code>&lt;</code> and <code>&gt;</code>. e.g.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Blah</span><span class="o">&lt;</span><span class="nx">These</span><span class="p">,</span> <span class="nx">Are</span><span class="p">,</span> <span class="nx">Type</span><span class="p">,</span> <span class="nx">Variables</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">blah</span><span class="o">&lt;</span><span class="nx">And</span><span class="p">,</span> <span class="nx">So</span><span class="p">,</span> <span class="nx">Are</span><span class="p">,</span> <span class="nx">These</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And if you want a conditional type to distribute over a union, the union a) needs to have been bound to a type
variable, and b) that variable needs to appear alone to the left of the <code>extends</code> keyword.</p>

<p>e.g. this is a distributive conditional type:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Blah</span><span class="o">&lt;</span><span class="nx">Var</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">Var</span> <span class="kr">extends</span> <span class="nx">Whatever</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">B</span>
</span></code></pre></td></tr></table></div></figure>


<p>and these are not:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Blah</span><span class="o">&lt;</span><span class="nx">Var</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">Foo</span><span class="o">&lt;</span><span class="nx">Var</span><span class="o">&gt;</span> <span class="kr">extends</span> <span class="nx">Whatever</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">B</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">Blah</span><span class="o">&lt;</span><span class="nx">Var</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">Whatever</span> <span class="kr">extends</span> <span class="nx">Var</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">B</span>
</span></code></pre></td></tr></table></div></figure>


<p>When I discovered this limitation I thought that it exposed a fundamental shortcoming in the way distributive
conditional types work under the hood. I thought it might be some kind of concession to algorithmic complexity. I
thought that my use case was too advanced, and that TypeScript had just thrown its hands up in the air and said,
"Sorry mate, you're on your own".</p>

<p>But it turns out I was wrong. It is just a pragmatic language design decision to avoid extra syntax, and you can
work around it easily:</p>

<!-- prettier-ignore -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractSimpleAction</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">A</span> <span class="kr">extends</span> <span class="nx">any</span>
</span><span class='line'>  <span class="o">?</span> <span class="p">{}</span> <span class="kr">extends</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">?</span> <span class="nx">A</span>
</span><span class='line'>    : <span class="kt">never</span>
</span><span class='line'>  <span class="o">:</span> <span class="nx">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>All we did is wrap the meat of our logic in a flimsy tortilla of inevitability, since the outer condition
<code>A extends any</code> will, of course, always be true.</p>

<p>And finally we can delete those four characters üéâüï∫üèºüíÉüèΩüéà</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>That's one yak successfully shaved ‚úî</p>

<hr />

<p>TypeScript provides a couple of built-in types that we could have used in this section:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="c1">// Exclude from U those types that are assignable to T</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">Exclude</span><span class="o">&lt;</span><span class="nx">U</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">U</span> <span class="kr">extends</span> <span class="nx">T</span> <span class="o">?</span> <span class="nx">never</span> : <span class="kt">U</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Extract from U those types that are assignable to T</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">Extract</span><span class="o">&lt;</span><span class="nx">U</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">U</span> <span class="kr">extends</span> <span class="nx">T</span> <span class="o">?</span> <span class="nx">U</span> : <span class="kt">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>e.g. instead of defining <code>ExcludeTypeField</code> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">ExcludeTypeKey</span><span class="o">&lt;</span><span class="nx">keyof</span> <span class="nx">A</span><span class="o">&gt;</span><span class="p">]</span><span class="o">:</span> <span class="nx">A</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>we could have done this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="nx">K</span> <span class="k">in</span> <span class="nx">Exclude</span><span class="o">&lt;</span><span class="nx">keyof</span> <span class="nx">A</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="o">&gt;</span><span class="p">]</span><span class="o">:</span> <span class="nx">A</span><span class="p">[</span><span class="nx">K</span><span class="p">]</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And instead of defining <code>ExtractActionParameters</code> like this:</p>

<!-- prettier-ignore -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractActionParameters</span><span class="o">&lt;</span><span class="nx">A</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">A</span> <span class="kr">extends</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">T</span> <span class="p">}</span>
</span><span class='line'>  <span class="o">?</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">:</span> <span class="nx">never</span>
</span></code></pre></td></tr></table></div></figure>


<p>we could have done this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">ExtractActionParameters</span><span class="o">&lt;</span><span class="nx">A</span><span class="p">,</span> <span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">ExcludeTypeField</span><span class="o">&lt;</span><span class="nx">Extract</span><span class="o">&lt;</span><span class="nx">A</span><span class="p">,</span> <span class="p">{</span> <span class="nx">type</span>: <span class="kt">T</span> <span class="p">}</span><span class="o">&gt;&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<a name="L.....Exercise.for.the.intrepid.reader"></a>
<h2>üí° Exercise for the intrepid reader</h2>

<p>Notice that this still works.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">dispatch</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span></code></pre></td></tr></table></div></figure>


<p>Use what you've learned so far to make it an error to supply a second argument for 'simple' actions.</p>

<a name="Destructuring.types.with..code.infer..code."></a>
<h2>Destructuring types with <code>infer</code></h2>

<p>Conditional types have another trick up their sleeve: the <code>infer</code> keyword. It can be used anywhere in the type
expression to the right of the <code>extends</code> keyword. It gives a name to whichever type would appear in that place.
e.g.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Unpack</span><span class="o">&lt;</span><span class="nx">A</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">A</span> <span class="kr">extends</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nx">infer</span> <span class="nx">E</span><span class="o">&gt;</span> <span class="o">?</span> <span class="nx">E</span> : <span class="kt">A</span>
</span><span class='line'>
</span><span class='line'><span class="nx">type</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">Unpack</span><span class="o">&lt;</span><span class="nx">Apple</span><span class="p">[]</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; Apple</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">Test</span> <span class="o">=</span> <span class="nx">Unpack</span><span class="o">&lt;</span><span class="nx">Apple</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; Apple</span>
</span></code></pre></td></tr></table></div></figure>


<p>It handles ambiguity gracefully:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Stairs</span> <span class="o">=</span> <span class="nx">Unpack</span><span class="o">&lt;</span><span class="nx">Apple</span><span class="p">[]</span> <span class="o">|</span> <span class="nx">Pear</span><span class="p">[]</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; Apple | Pear</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can even use <code>infer</code> multiple times.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="nx">type</span> <span class="nx">Flip</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="p">[</span><span class="nx">infer</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">infer</span> <span class="nx">B</span><span class="p">]</span> <span class="o">?</span> <span class="p">[</span><span class="nx">B</span><span class="p">,</span> <span class="nx">A</span><span class="p">]</span> <span class="o">:</span> <span class="nx">never</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">Stairs</span> <span class="o">=</span> <span class="nx">Flip</span><span class="o">&lt;</span><span class="p">[</span><span class="nx">Pear</span><span class="p">,</span> <span class="nx">Apple</span><span class="p">]</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; [Apple, Pear]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">type</span> <span class="nx">Union</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="p">[</span><span class="nx">infer</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">infer</span> <span class="nx">A</span><span class="p">]</span> <span class="o">?</span> <span class="nx">A</span> : <span class="kt">never</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">Stairs</span> <span class="o">=</span> <span class="nx">Union</span><span class="o">&lt;</span><span class="p">[</span><span class="nx">Apple</span><span class="p">,</span> <span class="nx">Pear</span><span class="p">]</span><span class="o">&gt;</span>
</span><span class='line'><span class="c1">// =&gt; Apple | Pear</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Other.built-in.conditional.types"></a>
<h2>Other built-in conditional types</h2>

<p>We've already seen <code>Exclude</code> and <code>Extract</code>, and TypeScript provides a few other conditional types out of the box.</p>

<!-- prettier-ignore -->


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ts'><span class='line'><span class="c1">// Exclude null and undefined from T</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">NonNullable</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span>
</span><span class='line'>  <span class="nx">T</span> <span class="kr">extends</span> <span class="kc">null</span> <span class="o">|</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="nx">never</span> : <span class="kt">T</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Obtain the parameters of a function type in a tuple</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">Parameters</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span>
</span><span class='line'>  <span class="nx">T</span> <span class="kr">extends</span> <span class="p">(...</span><span class="nx">args</span>: <span class="kt">infer</span> <span class="nx">P</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">any</span> <span class="o">?</span> <span class="nx">P</span> : <span class="kt">never</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Obtain the parameters of a constructor function type in a tuple</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">ConstructorParameters</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span>
</span><span class='line'>  <span class="nx">T</span> <span class="kr">extends</span> <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span>: <span class="kt">infer</span> <span class="nx">P</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">any</span> <span class="o">?</span> <span class="nx">P</span> : <span class="kt">never</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Obtain the return type of a function type</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">ReturnType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span>
</span><span class='line'>  <span class="nx">T</span> <span class="kr">extends</span> <span class="p">(...</span><span class="nx">args</span>: <span class="kt">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="nx">infer</span> <span class="nx">R</span> <span class="o">?</span> <span class="nx">R</span> : <span class="kt">any</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Obtain the return type of a constructor function type</span>
</span><span class='line'><span class="nx">type</span> <span class="nx">InstanceType</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span>
</span><span class='line'>  <span class="nx">T</span> <span class="kr">extends</span> <span class="k">new</span> <span class="p">(...</span><span class="nx">args</span>: <span class="kt">any</span><span class="p">[])</span> <span class="o">=&gt;</span> <span class="nx">infer</span> <span class="nx">R</span> <span class="o">?</span> <span class="nx">R</span> : <span class="kt">any</span>
</span></code></pre></td></tr></table></div></figure>


<a name="Further.reading"></a>
<h2>Further reading</h2>

<ul>
<li><a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html">TypeScript 2.8 release notes</a></li>
<li><a href="https://github.com/Microsoft/TypeScript/pull/21316">Microsoft/Typescript#21316</a> Conditional types pull request</li>
<li><a href="https://github.com/Microsoft/TypeScript/pull/21496">Microsoft/Typescript#21496</a> <code>infer</code> pull request</li>
<li><a href="https://github.com/Microsoft/TypeScript/blob/a2205ad53d8f65a129a552b752d1e06fee3d41fc/lib/lib.es5.d.ts#L1446">lib.es5.d.ts#L1446</a>
built-in conditional type definitions</li>
</ul>


        </article>

        <article class='post'>
          <p style="padding-bottom: 0; margin-bottom:0;">
            <a href="https://www.artsy.net/" style="background-image: none;">
              <svg viewBox="0 0 510 510" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
                <path transform="scale(1, -1) translate(0, -480)" d="M0 -32h512v512h-512v-512v0zM464 16h-80v80h-48v-80h-288v416h416v-416v0zM194 384h-40l-74 -186h38l20 52h72l19 -52h39l-74 186v0zM149 282l25 66l24 -66h-49v0z"></path>
              </svg>
            </a>
          <p/>
        </article>

      
        <article class='post'>
          <section id="comments" />

<script type="text/javascript">
  // Comes from https://stackoverflow.com/questions/3177836/how-to-format-time-since-xxx-e-g-4-minutes-ago-similar-to-stack-exchange-site
  function timeSince(date) {
    var seconds = Math.floor((new Date() - date) / 1000)
    var interval = Math.floor(seconds / 31536000)

    if (interval > 1) {
      return interval + " years"
    }
    interval = Math.floor(seconds / 2592000)
    if (interval > 1) {
      return interval + " months"
    }
    interval = Math.floor(seconds / 86400)
    if (interval > 1) {
      return interval + " days"
    }
    interval = Math.floor(seconds / 3600)
    if (interval > 1) {
      return interval + " hours"
    }
    interval = Math.floor(seconds / 60)
    if (interval > 1) {
      return interval + " minutes"
    }
    return Math.floor(seconds) + " seconds"
  }

  var writeToComment = function (element, html) {
    var element = document.createElement(element)
    element.innerHTML = html
    document.getElementById("comments").appendChild(element)
  }

  var addReactions = function (reactions, link) {
    var returnString = ""
    var emojiCode = {
      '+1': "<g-emoji alias='+1' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f44d.png' class='emoji'>üëç</g-emoji>",
      '-1': "<g-emoji alias='-1' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f44e.png' class='emoji'>üëé</g-emoji>",
      laugh: "<g-emoji alias='smile' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f604.png' class='emoji'>üòÑ</g-emoji>",
      hooray: "<g-emoji alias='tada' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f389.png' class='emoji'>üéâ</g-emoji>",
      confused: "<g-emoji alias='thinking_face' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f615.png' class='emoji'>üòï</g-emoji>",
      heart: "<g-emoji alias='framed_picture' fallback-src='https://assets-cdn.github.com/images/icons/emoji/unicode/1f5bc.png' class='emoji'>üñº</g-emoji>"
    }

    if (reactions.total_count > 0) {
      returnString += "<div class='comment-reactions'>"
      for (var key in reactions) {
        if (reactions.hasOwnProperty(key)) {
          if (reactions[key] > 0 && key !== "total_count") {
            returnString += "<a href='" + link + "' class='emoji-wrapper'>" + emojiCode[key] + reactions[key] + "</a>"
          }
        }
      }
      returnString += "</div>"
      return returnString
    } else {
      return "<div></div>"
    }
  }

  // Based on http://ivanzuzak.info/2011/02/18/github-hosted-comments-for-github-hosted-blogs.html
  // And http://donw.io/post/github-comments/

  var loadComments = function (data) {
    writeToComment("h2", "Comments")
    for (var i = 0; i < data.length; i++) {
      var cuser = data[i].user.login
      var cuserlink = data[i].user.html_url
      var clink = data[i].html_url
      var cbody = data[i].body_html
      var cavatarlink = data[i].user.avatar_url
      var cdate = new Date(data[i].created_at)
      var creactions = addReactions(data[i].reactions, clink)

      var commentHTML =
        "<div class='comment'>" +
        "<div class='comment-header'>" +
        "<a class='comment-username' href=\"" + cuserlink + '">' +
        '<img src="' + cavatarlink + '" alt="" width="40" height="40">' +
        cuser +
        "</a>" + " commented " +
        "<a class='comment-date' href=\"" + clink + '">' +
        timeSince(cdate) + " ago" +
        "</a>" +
        "</div>" +
        "<div class='comment-body'>"
        + cbody +
        "</div>" +
        creactions +
        "</div>"
      writeToComment("div", commentHTML)
    }

    var callToAction =
      "<hr/>" +
      "<p>" +
      "Our comments are using GitHub Issues on the Artsy Blog repo. You can post by replying to <a href='https://github.com/artsy/artsy.github.io/issues/500'>issue #500</a>." +
      "</p>"
    writeToComment("div", callToAction)
  }

  var writeFirstComment = function () {
    var callToAction =
      "<hr/>" +
      "<p>" +
      "This post has no comments, yet, you could be the first. Our comments are using GitHub Issues on the Artsy Blog repo. You can post by replying to <a href='https://github.com/artsy/artsy.github.io/issues/500'>issue #500</a>." +
      "</p>"
    writeToComment("div", callToAction)
  }

  if (window.fetch) {
    var url =
      "https://artsy-blog-gh-commentify.herokuapp.com/repos/artsy/artsy.github.io/issues/500/comments"
    window
      .fetch(url, { Accept: "application/vnd.github.v3.html+json" })
      .then(function (response) {
        return response.json()
      })
      .then(function (json) {
        if (json.length) {
          loadComments(json)
        } else {
          writeFirstComment()
        }
      })
  }

</script>
        </article>
      

      </section>

      <footer>
        <article>

          <section>
            <h4>Author</h4>
            <p> <a href="/author/david"/>David Sheldrick</a></p>
            <p></a></p>
          </section>

          <section>
            <h4>Post Meta</h4>
            <p>Nov 21, 2018</p>
            <p>Tagged: <a class='category' href='/blog/categories/programming/'>programming</a>, <a class='category' href='/blog/categories/typescript/'>typescript</a></p>
          </section>
          <br/>
          <section>
            <h4>Artsy OSS</h4>
            <ul>
              <li><a href='https://www.artsy.net'>Artsy.net</a></li>
              <li><a href='https://developers.artsy.net'>API</a></li>
              <li><a href='http://artsy.github.io/open-source/'>Featured OSS</a></li>
              <li><a href='https://www.artsy.net/jobs'>Careers</a></li>
            </ul>
          </section>

          <section>
            <h4>Blog</h4>
            <ul>
              <li><a href='http://artsy.github.io/blog/archives/'>Archives</a></li>
              <li><a href='http://artsy.github.io/search/'>Search</a></li>
              <li><a href='https://github.com/artsy/artsy.github.io'>Code on GitHub</a></li>
              <li><a href='https://github.com/artsy/artsy.github.io/edit/source/_posts/2018-11-21-conditional-types-in-typescript.markdown'>Fix typoes in this post</a></li>
            </ul>
          </section>

        </article>

        <article>
          <section>
            <h4>Post Series on the Blog</h4>
            <ul>
              
              <li><a href='/series/react-native-at-artsy/'>React Native at Artsy</a></li>
              
              <li><a href='/series/javascriptures/'>JavaScriptures</a></li>
              
              <li><a href='/series/stages-of-professional-growth/'>Stages of Professional Growth</a></li>
              
              <li><a href='/series/artsy-tech-stack/'>Artsy Tech Stack</a></li>
              
              <li><a href='/series/open-source-by-default/'>Open Source by Default</a></li>
              
            </ul>
          </section>

          <section>
          
          </section>
        </article>

      </footer>
    </div>
  </div>
</body>
