<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: native | Artsy Engineering]]></title>
  <link href="https://artsy.github.io/blog/categories/native/atom.xml" rel="self"/>
  <link href="https://artsy.github.io/"/>
  <updated>2024-08-06T19:48:16+00:00</updated>
  <id>https://artsy.github.io/</id>
  <author>
    <name><![CDATA[]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Augmenting Artworks: AR at Artsy]]></title>
    <link href="https://artsy.github.io/blog/2018/03/18/ar/"/>
    <updated>2018-03-18T00:00:00+00:00</updated>
    <id>https://artsy.github.io/blog/2018/03/18/ar</id>
    <content type="html"><![CDATA[<p>In 2017, Apple released ARKit to universal acclaim. It’s a solid foundation for application developers to build
Augmented Reality (AR) experiences without learning a whole new skillset in computer vision. Like a lot of Apple’s
technology, it’s a clever blend of existing projects: <a href="https://developer.apple.com/documentation/scenekit">SceneKit</a>, <a href="https://developer.apple.com/documentation/coremotion">CoreMotion</a>, <a href="https://developer.apple.com/documentation/coreml">CoreML</a> and some very
clever camera work. From the developer’s perspective, ARKit has an API which fits perfectly with the rest of Apple’s
APIs. You spend most of your time working with a few delegate functions and you’re good to go.</p>

<p>For the last 2 months, I’ve been working with ARKit on a replacement for our <a href="https://ortastuff.s3.amazonaws.com/vids/eigen-vir.mp4">View in Room</a> feature on modern
iOS devices to support a “View in <em>My</em> Room”. I’m going to try cover how we approached the project, the abstractions we
created and give you a run through of how it works.</p>

<p>We believe that our implementation is a solid improvement over similar features in other apps that allow users to place
artworks on walls, and we’re making <a href="https://github.com/artsy/eigen/tree/f897b3438bd07470bd88a790fc6d6a524f5756cb/Artsy/View_Controllers/ARVIR">the source code available</a> free and open-source under the MIT
license.</p>

<!-- more -->

<h2 id="how-does-arkit-work">How does ARKit work?</h2>

<p>You start up ARKit by creating an <a href="https://developer.apple.com/documentation/arkit/arsession">AR Session</a> and passing it to an view on your screen. This will trigger
ARKit to open your camera looking through the phone’s camera for reference points to determine where the phone is in the
world. Your app will use the reference points to attach SceneKit objects to places through the AR viewport. Let’s look
at this as a diagram:</p>

<article class="diagram">
<div style="flex:1;">
  <ol class="workflow" data-id="What-is-AR">
    <li>You have a phone in a room</li>
    <li>ARSession starts</li>
    <li>It detects some feature points</li>
    <li>You can then attach objects to those points</li>
  </ol>
</div>
<div style="flex:1"><?xml version="1.0" encoding="UTF-8"?>
<svg width="530px" height="460px" viewBox="0 0 530 460" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
    <title>What is AR</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <radialGradient cx="73.2212612%" cy="27.1693638%" fx="73.2212612%" fy="27.1693638%" r="207.875515%" id="radialGradient-1">
            <stop stop-color="#FFFFFF" offset="0%"></stop>
            <stop stop-color="#000000" offset="100%"></stop>
        </radialGradient>
        <path d="M5.24032834,2.21494006 L10.0175781,0.45921461 L10.0175781,0.45921461 C13.878629,-0.959791237 18.1589608,1.01987744 19.5779666,4.88092836 C19.8803845,5.7037938 20.0351562,6.57358786 20.0351562,7.45026573 L20.0351562,38.1425845 L20.0351562,38.1425845 C20.0351562,41.4875521 17.9540723,44.4794008 14.8180048,45.6429681 L10.0175781,47.4240584 L10.0175781,47.4240584 C6.16921751,48.8519059 1.89200567,46.8896924 0.464158083,43.0413318 C0.157173464,42.2139413 8.98985986e-15,41.3384898 8.8817842e-15,40.4559851 C5.28025569e-15,32.0110213 2.64012785e-15,23.5660575 0,15.1210938 C1.84503416e-15,13.3220232 3.69006831e-15,11.5229527 5.53510247e-15,9.72388222 L7.10542736e-15,9.72388222 C9.6736429e-15,6.36986699 2.09219005,3.37193766 5.24032834,2.21494006 Z" id="path-2"></path>
        <path d="M5.24032834,3.21494006 L10.0175781,1.45921461 L10.0175781,1.45921461 C13.878629,0.0402087634 18.1589608,2.01987744 19.5779666,5.88092836 C19.8803845,6.7037938 20.0351562,7.57358786 20.0351562,8.45026573 L20.0351562,39.1425845 L20.0351562,39.1425845 C20.0351562,42.4875521 17.9540723,45.4794008 14.8180048,46.6429681 L10.0175781,48.4240584 L10.0175781,48.4240584 C6.16921751,49.8519059 1.89200567,47.8896924 0.464158083,44.0413318 C0.157173464,43.2139413 8.98985986e-15,42.3384898 8.8817842e-15,41.4559851 C5.28025569e-15,33.0110213 2.64012785e-15,24.5660575 0,16.1210938 C1.84503416e-15,14.3220232 3.69006831e-15,12.5229527 5.53510247e-15,10.7238822 L7.10542736e-15,10.7238822 C9.6736429e-15,7.36986699 2.09219005,4.37193766 5.24032834,3.21494006 Z" id="path-3"></path>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="What-is-AR">
            <g id="0-4_room" transform="translate(18.000000, 14.000000)">
                <polyline id="Path-2" stroke="#BCEBED" stroke-width="2" transform="translate(250.949219, 301.207031) scale(1, -1) translate(-250.949219, -301.207031) " points="0 290.9375 198.996094 360.277344 501.898438 242.136719"></polyline>
                <path d="M200,0.5 L200,242.5" id="Path-3" stroke="#BCEBED" stroke-width="2"></path>
                <polygon id="Path" stroke="#80D7DA" stroke-width="4" points="1 64.6445313 200.320312 1 502.441406 112.097656 502.441406 360.867188 312.496094 433.988281 1 313.414062"></polygon>
            </g>
            <g id="0-4_balls" transform="translate(101.000000, 253.000000)" fill="url(#radialGradient-1)">
                <circle id="Oval" cx="28" cy="61" r="28"></circle>
                <circle id="Oval-Copy" cx="75.5" cy="18.5" r="18.5"></circle>
            </g>
            <g id="2-4_camera" transform="translate(60.000000, 41.000000)" fill-opacity="0.179630888" fill="#F5A623">
                <path d="M280.613281,208.308594 L228.488281,36.859375 L158.785156,0.5 L0.89453125,49.28125 L0.89453125,266.316406 L39.9960938,282.289063 C51.9153646,268.739583 60.2330729,263.415365 64.9492188,266.316406 C72.0234375,270.667969 79.0976562,285.667969 72.0234375,292.890625 C67.3072917,297.705729 75.7643229,303.733073 97.3945312,310.972656 L273.246094,253.71875 L280.613281,208.308594 Z" id="Path-5"></path>
            </g>
            <g id="3-4_features" transform="translate(108.000000, 211.000000)" fill="#E2D52A">
                <circle id="Oval-2" cx="45" cy="99" r="4"></circle>
                <circle id="Oval-2" cx="65" cy="61" r="4"></circle>
                <circle id="Oval-2" cx="83" cy="69" r="4"></circle>
                <circle id="Oval-2" cx="14" cy="85" r="4"></circle>
                <circle id="Oval-2" cx="25" cy="81" r="4"></circle>
                <circle id="Oval-2" cx="131.5" cy="94.5" r="3.5"></circle>
                <ellipse id="Path" cx="135.5" cy="79" rx="3.5" ry="4"></ellipse>
                <circle id="Oval-2" cx="29" cy="97" r="4"></circle>
                <circle id="Oval-2" cx="97" cy="60" r="3"></circle>
                <circle id="Oval-2" cx="105.5" cy="78.5" r="3.5"></circle>
                <circle id="Oval-2" cx="65" cy="117" r="4"></circle>
                <circle id="Oval-2" cx="113" cy="3" r="3"></circle>
                <circle id="Oval-2" cx="101" cy="23" r="3"></circle>
                <circle id="Oval-2-Copy" cx="84" cy="12" r="3"></circle>
                <circle id="Oval-2-Copy-2" cx="76" cy="48" r="3"></circle>
                <circle id="Oval-2-Copy-3" cx="64" cy="29" r="3"></circle>
                <circle id="Oval-2-Copy-4" cx="40" cy="39" r="3"></circle>
                <circle id="Oval-2-Copy-5" cx="48" cy="20" r="3"></circle>
                <circle id="Oval-2-Copy-6" cx="83" cy="29" r="3"></circle>
                <circle id="Oval-2-Copy-7" cx="25" cy="60" r="3"></circle>
                <circle id="Oval-2-Copy-8" cx="3" cy="58" r="3"></circle>
                <circle id="Oval-2" cx="121" cy="39" r="3"></circle>
                <circle id="Oval-2" cx="97" cy="42" r="3"></circle>
                <circle id="Oval-2" cx="37" cy="117" r="4"></circle>
            </g>
            <g id="1-4_phone" transform="translate(325.000000, 247.000000)">
                <g id="Rectangle">
                    <use fill="#3A3A3A" fill-rule="evenodd" xlink:href="#path-2"></use>
                    <path stroke="#979797" stroke-width="1" d="M5.41280781,2.68424895 C2.46142817,3.7689342 0.5,6.57949295 0.5,9.72388222 L0.5,40.4559851 C0.5,41.2791197 0.646599691,42.0956756 0.932932058,42.8674038 C2.26472184,46.4568677 6.2541862,48.2870742 9.84365009,46.9552844 L14.6440767,45.1741941 C17.58414,44.0833498 19.5351562,41.2784917 19.5351562,38.1425845 L19.5351562,7.45026573 C19.5351562,6.6324392 19.3907743,5.82103436 19.1086577,5.05340784 C17.7849097,1.45154906 13.7919164,-0.395224566 10.1900576,0.928523495 L5.41280781,2.68424895 Z"></path>
                </g>
                <g id="Rectangle">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-3"></use>
                    <path stroke="#979797" stroke-width="1" d="M5.41280781,3.68424895 C2.46142817,4.7689342 0.5,7.57949295 0.5,10.7238822 L0.5,41.4559851 C0.5,42.2791197 0.646599691,43.0956756 0.932932058,43.8674038 C2.26472184,47.4568677 6.2541862,49.2870742 9.84365009,47.9552844 L14.6440767,46.1741941 C17.58414,45.0833498 19.5351562,42.2784917 19.5351562,39.1425845 L19.5351562,8.45026573 C19.5351562,7.6324392 19.3907743,6.82103436 19.1086577,6.05340784 C17.7849097,2.45154906 13.7919164,0.604775434 10.1900576,1.92852349 L5.41280781,3.68424895 Z"></path>
                </g>
            </g>
            <g id="4-4_anchors" transform="translate(146.000000, 86.000000)">
                <path d="M26.1171875,153.894531 L26.1171875,75" id="Path-4" stroke="#000000" stroke-width="2" stroke-dasharray="2,2"></path>
                <polygon id="Path-6" stroke="#000000" points="0.359375 15.109375 44.578125 0.50390625 44.578125 67.8945313 0.359375 84.4160156"></polygon>
                <circle id="Oval-2-Copy-3" fill="#000000" cx="26" cy="153" r="3"></circle>
            </g>
        </g>
    </g>
</svg></div>
</article>

<p>With ARKit at release in iOS 11.0, if enough feature points are detected in a series horizontally, then ARKit will also
send you some information about the what it considers to be a horizontal plane.</p>

<p>Planes are what most AR apps use on iOS, the apps react to discovering a flat horizontal surface and then allows putting
3d objects on to it. You would then interact with these object by doing a hit test for the closest plane or feature
point to handle user interactions.</p>

<h3 id="quick-glossary">Quick glossary</h3>

<ul>
  <li>
    <p><a href="https://developer.apple.com/documentation/arkit/arframe/2887449-rawfeaturepoints">Feature Point</a> - A physical point of reference created by ARKit. A feature point is found in a frame of the
camera’s image. The point is converted into a 3D world coordinate space by image analysis that ARKit performs to track
the device’s position, orientation, and movement. Taken together, these points roughly correlate to real-world objects
through the view of the camera.</p>
  </li>
  <li>
    <p><a href="https://developer.apple.com/documentation/arkit/aranchor">Anchor</a> - An anchor is a developer tool for building on top of feature points. Anchors allow connections
between a real-world object and an augmented-reality object. Effectively, this provides the API to place objects in
“the room.”</p>
  </li>
  <li>
    <p><a href="https://developer.apple.com/documentation/arkit/arplaneanchor">Plane</a> - An anchor to a rectangle in 3D space. A set of feature points detected in a continuous direction. You
can request for ARKit to find these for you, and common examples are tables, floors and walls.</p>
  </li>
  <li>
    <p><a href="https://developer.apple.com/documentation/arkit/arskview/2875733-hittest">Hit Test</a> - Projects a line through the world from a location on the screen and oriented with the phone’s world
position and angle. This gives you a list of objects that intersect the line.</p>
  </li>
</ul>

<h2 id="ar-at-artsy">AR at Artsy</h2>

<p>We did some interesting work in the AR space already in 2017 with Microsoft, Studio Drift and the Armory Show using <a href="http://fortune.com/2017/03/02/microsoft-hololens-art-show/">the
Holo Lens</a>. When ARKit came out, we explored whether we could reliably place an artwork on a wall, but came
to the conclusion that the technology was a bit too immature for us to build it reliably. The core problem was that
ARKit at release could only be used to find horizontal planes.</p>

<p>Here’s how our original approach worked:</p>

<article class="desktop-only" style="display: flex; flex-flow:row; margin: 0px -60px;">
<div style="flex:1;">
  <ol class="workflow" data-id="v1">
    <li>Open up ARKit and let it discover the world</li>
    <li>Detect the edge of a floor by asking a user to point at the floor near the wall</li>
    <li>Find the edge furthest away</li>
    <li>Attach a work to the floor closest to the wall</li>
  </ol>
</div>
<div style="flex:1"><?xml version="1.0" encoding="UTF-8"?>
<svg width="530px" height="460px" viewBox="0 0 530 460" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
    <title>v1</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <path d="M15.5931447,21.0693125 L20.3703944,19.313587 L20.3703944,19.313587 C24.2314454,17.8945812 28.5117771,19.8742499 29.9307829,23.7353008 C30.2332008,24.5581662 30.3879726,25.4279603 30.3879726,26.3046382 L30.3879726,56.9969569 L30.3879726,56.9969569 C30.3879726,60.3419246 28.3068886,63.3337733 25.1708211,64.4973405 L20.3703944,66.2784308 L20.3703944,66.2784308 C16.5220338,67.7062784 12.244822,65.7440649 10.8169744,61.8957043 C10.5099898,61.0683138 10.3528163,60.1928622 10.3528163,59.3103575 C10.3528163,50.8653937 10.3528163,42.42043 10.3528163,33.9754662 C10.3528163,32.1763957 10.3528163,30.3773252 10.3528163,28.5782547 L10.3528163,28.5782547 C10.3528163,25.2242394 12.4450064,22.2263101 15.5931447,21.0693125 Z" id="path-1"></path>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="v1">
            <g id="0-4_room" transform="translate(18.000000, 14.000000)">
                <polyline id="Path-2" stroke="#BCEBED" stroke-width="2" transform="translate(250.949219, 301.207031) scale(1, -1) translate(-250.949219, -301.207031) " points="0 290.9375 198.996094 360.277344 501.898438 242.136719"></polyline>
                <path d="M200,0.5 L200,242.5" id="Path-3" stroke="#BCEBED" stroke-width="2"></path>
                <polygon id="Path" stroke="#80D7DA" stroke-width="4" points="1 64.6445313 200.320312 1 502.441406 112.097656 502.441406 360.867188 312.496094 433.988281 1 313.414062"></polygon>
            </g>
            <g id="2-4_camera" transform="translate(60.000000, 235.000000)">
                <polygon id="Path-5" fill-opacity="0.179630888" fill="#F5A623" points="228.488281 36.859375 158.785156 0.5 0.89453125 49.28125 0.89453125 76.3164063 29.2070312 95.1445313 131.007812 108.998047 220.933594 92.2890625"></polygon>
                <polygon id="Path-2" stroke="#E2D52A" stroke-width="2" fill-opacity="0.27100317" fill="#E2D52A" transform="translate(132.255859, 63.898437) scale(1, -1) translate(-132.255859, -63.898437) " points="38.3632813 58.0195312 158.996094 100.660156 226.148438 74.03125 98.1503906 27.1367187"></polygon>
            </g>
            <g id="2-4_features" transform="translate(89.000000, 260.000000)" fill="#E2D52A">
                <circle id="Oval-2" cx="66" cy="66" r="4"></circle>
                <circle id="Oval-2" cx="86" cy="28" r="4"></circle>
                <circle id="Oval-2" cx="104" cy="36" r="4"></circle>
                <circle id="Oval-2" cx="35" cy="52" r="4"></circle>
                <circle id="Oval-2" cx="46" cy="48" r="4"></circle>
                <circle id="Oval-2" cx="152.5" cy="61.5" r="3.5"></circle>
                <ellipse id="Path" cx="156.5" cy="46" rx="3.5" ry="4"></ellipse>
                <circle id="Oval-2" cx="50" cy="64" r="4"></circle>
                <circle id="Oval-2" cx="118" cy="27" r="3"></circle>
                <circle id="Oval-2" cx="126.5" cy="45.5" r="3.5"></circle>
                <circle id="Oval-2" cx="107" cy="69" r="4"></circle>
                <circle id="Oval-2" cx="83" cy="49" r="3"></circle>
                <circle id="Oval-2-Copy-2" cx="97" cy="15" r="3"></circle>
                <circle id="Oval-2-Copy-3" cx="71" cy="24" r="3"></circle>
                <circle id="Oval-2-Copy-4" cx="65" cy="32" r="3"></circle>
                <circle id="Oval-2-Copy-6" cx="130" cy="3" r="3"></circle>
                <circle id="Oval-2-Copy-7" cx="46" cy="27" r="3"></circle>
                <circle id="Oval-2-Copy-8" cx="16" cy="43" r="3"></circle>
                <circle id="Oval-2" cx="142" cy="6" r="3"></circle>
                <circle id="Oval-2" cx="118" cy="9" r="3"></circle>
                <circle id="Oval-2" cx="4" cy="53" r="4"></circle>
            </g>
            <g id="1-4_phone" transform="translate(257.431048, 288.284945) rotate(-37.000000) translate(-257.431048, -288.284945) translate(246.931048, 264.284945)"></g>
            <g id="0-4_person" transform="translate(238.000000, 241.000000)">
                <g id="Rectangle" transform="translate(20.370394, 42.799490) rotate(-29.000000) translate(-20.370394, -42.799490) ">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-1"></use>
                    <path stroke="#979797" stroke-width="1" d="M15.7656241,21.5386214 C12.8142445,22.6233066 10.8528163,25.4338654 10.8528163,28.5782547 L10.8528163,59.3103575 C10.8528163,60.1334921 10.999416,60.950048 11.2857484,61.7217762 C12.6175382,65.3112401 16.6070025,67.1414466 20.1964664,65.8096568 L24.996893,64.0285666 C27.9369564,62.9377223 29.8879726,60.1328641 29.8879726,56.9969569 L29.8879726,26.3046382 C29.8879726,25.4868116 29.7435906,24.6754068 29.4614741,23.9077803 C28.137726,20.3059215 24.1447327,18.4591479 20.5428739,19.7828959 L15.7656241,21.5386214 Z"></path>
                </g>
                <path d="M57.8662109,54.2951339 C57.2197037,47.2391468 56.4052506,43.8266412 55.4228516,44.0576172 C49.9941406,45.3339844 42.5444721,9.38688117 44.8359375,6.22265625 C48.6060532,1.01660156 83.0625,-7.31651228 81.84375,16.3310547 C81.03125,32.0960993 77.9322917,44.7507924 72.546875,54.2951339 C80.7701069,49.2018936 86.1395731,46.6552734 88.6552734,46.6552734 C92.428824,46.6552734 95.2041008,52.8013269 94.8476562,55.4792972 C94.6100265,57.2646107 93.5517583,70.7331002 91.6728516,95.8847656 C83.9235026,105.734375 75.6959635,110.609701 66.9902344,110.510742 C53.9316406,110.362305 41.5716684,104.533615 39.8232422,101.063477 C38.6576247,98.7500512 36.6400466,83.5553248 33.7705078,55.4792972 L36.8642578,46.6552734 L57.8662109,54.2951339 Z" id="Path-7" fill="#80D7DA"></path>
            </g>
            <g id="4-4_anchors" transform="translate(151.000000, 124.000000)">
                <path d="M26.1171875,153.894531 L26.1171875,75" id="Path-4" stroke="#000000" stroke-width="2" stroke-dasharray="2,2"></path>
                <path d="M26.1171875,153.894531 L89,153.894531" id="Path-4" stroke="#000000" stroke-width="2" stroke-dasharray="2,2"></path>
                <polygon id="Path-6" stroke="#000000" points="0.359375 15.109375 44.578125 0.50390625 44.578125 67.8945313 0.359375 84.4160156"></polygon>
                <circle id="Oval-2-Copy-3" fill="#000000" cx="26" cy="153" r="3"></circle>
            </g>
            <g id="3-4_line" transform="translate(98.000000, 263.000000)" stroke="#000000" stroke-width="2" stroke-dasharray="2,2">
                <path d="M0,39.7773437 L123,0" id="Path-4"></path>
            </g>
        </g>
    </g>
</svg></div>
</article>

<p>This could work, but it was hard to explain for a first time user. A user spent most of their time with their phone
pointed at the floor, then we had no way to know if feature points had been detected all the way to the floor edges.</p>

<p>From there, we experimented with using the location of the iPhone as a point of reference:</p>

<article class="desktop-only" style="display: flex; flex-flow:row; margin: 0px -60px;">
<div style="flex:1;">
  <ol class="workflow" data-id="v2">
  <li>Open up ARKit and let it discover the world</li>
  <li>Ask a user to put their phone against the wall</li>
  <li>When the camera is fully osbscured, use the last known point as an anchor</li>
  <li>When the user pulls back and reconnects, place the work</li>
  </ol>
</div>
<div style="flex:1"><?xml version="1.0" encoding="UTF-8"?>
<svg width="530px" height="460px" viewBox="0 0 530 460" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
    <title>v2</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <path d="M9.24616479,13.5906941 L14.0234146,11.8349687 L14.0234146,11.8349687 C17.8844655,10.4159628 22.1647972,12.3956315 23.5838031,16.2566824 C23.886221,17.0795478 24.0409927,17.9493419 24.0409927,18.8260198 L24.0409927,49.5183386 L24.0409927,49.5183386 C24.0409927,52.8633062 21.9599088,55.8551549 18.8238412,57.0187222 L14.0234146,58.7998124 L14.0234146,58.7998124 C10.175054,60.22766 5.89784212,58.2654465 4.46999453,54.4170859 C4.16300992,53.5896954 4.00583645,52.7142438 4.00583645,51.8317391 C4.00583645,43.3867753 4.00583645,34.9418116 4.00583645,26.4968478 C4.00583645,24.6977773 4.00583645,22.8987068 4.00583645,21.0996363 L4.00583645,21.0996363 C4.00583645,17.745621 6.0980265,14.7476917 9.24616479,13.5906941 Z" id="path-1"></path>
        <path d="M9.24616479,13.5906941 L14.0234146,11.8349687 L14.0234146,11.8349687 C17.8844655,10.4159628 22.1647972,12.3956315 23.5838031,16.2566824 C23.886221,17.0795478 24.0409927,17.9493419 24.0409927,18.8260198 L24.0409927,49.5183386 L24.0409927,49.5183386 C24.0409927,52.8633062 21.9599088,55.8551549 18.8238412,57.0187222 L14.0234146,58.7998124 L14.0234146,58.7998124 C10.175054,60.22766 5.89784212,58.2654465 4.46999453,54.4170859 C4.16300992,53.5896954 4.00583645,52.7142438 4.00583645,51.8317391 C4.00583645,43.3867753 4.00583645,34.9418116 4.00583645,26.4968478 C4.00583645,24.6977773 4.00583645,22.8987068 4.00583645,21.0996363 L4.00583645,21.0996363 C4.00583645,17.745621 6.0980265,14.7476917 9.24616479,13.5906941 Z" id="path-2"></path>
        <path d="M5.24032834,2.21494006 L10.0175781,0.45921461 L10.0175781,0.45921461 C13.878629,-0.959791237 18.1589608,1.01987744 19.5779666,4.88092836 C19.8803845,5.7037938 20.0351562,6.57358786 20.0351562,7.45026573 L20.0351562,38.1425845 L20.0351562,38.1425845 C20.0351562,41.4875521 17.9540723,44.4794008 14.8180048,45.6429681 L10.0175781,47.4240584 L10.0175781,47.4240584 C6.16921751,48.8519059 1.89200567,46.8896924 0.464158083,43.0413318 C0.157173464,42.2139413 8.98985986e-15,41.3384898 8.8817842e-15,40.4559851 C5.28025569e-15,32.0110213 2.64012785e-15,23.5660575 0,15.1210938 C1.84503416e-15,13.3220232 3.69006831e-15,11.5229527 5.53510247e-15,9.72388222 L7.10542736e-15,9.72388222 C9.6736429e-15,6.36986699 2.09219005,3.37193766 5.24032834,2.21494006 Z" id="path-3"></path>
        <path d="M5.24032834,2.21494006 L10.0175781,0.45921461 L10.0175781,0.45921461 C13.878629,-0.959791237 18.1589608,1.01987744 19.5779666,4.88092836 C19.8803845,5.7037938 20.0351562,6.57358786 20.0351562,7.45026573 L20.0351562,38.1425845 L20.0351562,38.1425845 C20.0351562,41.4875521 17.9540723,44.4794008 14.8180048,45.6429681 L10.0175781,47.4240584 L10.0175781,47.4240584 C6.16921751,48.8519059 1.89200567,46.8896924 0.464158083,43.0413318 C0.157173464,42.2139413 8.98985986e-15,41.3384898 8.8817842e-15,40.4559851 C5.28025569e-15,32.0110213 2.64012785e-15,23.5660575 0,15.1210938 C1.84503416e-15,13.3220232 3.69006831e-15,11.5229527 5.53510247e-15,9.72388222 L7.10542736e-15,9.72388222 C9.6736429e-15,6.36986699 2.09219005,3.37193766 5.24032834,2.21494006 Z" id="path-4"></path>
        <mask id="mask-5" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="20.0351562" height="47.8902345" fill="white">
            <use xlink:href="#path-4"></use>
        </mask>
        <path d="M5.24032834,2.21494006 L10.0175781,0.45921461 L10.0175781,0.45921461 C13.878629,-0.959791237 18.1589608,1.01987744 19.5779666,4.88092836 C19.8803845,5.7037938 20.0351562,6.57358786 20.0351562,7.45026573 L20.0351562,38.1425845 L20.0351562,38.1425845 C20.0351562,41.4875521 17.9540723,44.4794008 14.8180048,45.6429681 L10.0175781,47.4240584 L10.0175781,47.4240584 C6.16921751,48.8519059 1.89200567,46.8896924 0.464158083,43.0413318 C0.157173464,42.2139413 8.98985986e-15,41.3384898 8.8817842e-15,40.4559851 C5.28025569e-15,32.0110213 2.64012785e-15,23.5660575 0,15.1210938 C1.84503416e-15,13.3220232 3.69006831e-15,11.5229527 5.53510247e-15,9.72388222 L7.10542736e-15,9.72388222 C9.6736429e-15,6.36986699 2.09219005,3.37193766 5.24032834,2.21494006 Z" id="path-6"></path>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="v2">
            <g id="0-4_room" transform="translate(18.000000, 14.000000)">
                <polyline id="Path-2" stroke="#BCEBED" stroke-width="2" transform="translate(250.949219, 301.207031) scale(1, -1) translate(-250.949219, -301.207031) " points="0 290.9375 198.996094 360.277344 501.898438 242.136719"></polyline>
                <path d="M200,0.5 L200,242.5" id="Path-3" stroke="#BCEBED" stroke-width="2"></path>
                <polygon id="Path" stroke="#80D7DA" stroke-width="4" points="1 64.6445313 200.320312 1 502.441406 112.097656 502.441406 360.867188 312.496094 433.988281 1 313.414062"></polygon>
            </g>
            <g id="1-1_camera" transform="translate(47.000000, 93.000000)" fill-opacity="0.179630888" fill="#F5A623">
                <path d="M202.794922,125.993164 L193.664063,0.98828125 L0.509765625,63.03125 L13.8945312,218.316406 L42.2070312,237.144531 L144.007812,250.998047 L233.933594,234.289063 C246.292625,217.862243 249.991193,201.020446 245.029297,183.763672 C240.067401,166.506898 225.989276,147.250062 202.794922,125.993164 Z" id="Path-5"></path>
            </g>
            <g id="2-2_camera" transform="translate(100.000000, 157.000000)" fill-opacity="0.179630888" fill="#F5A623">
                <polygon id="Path-5" points="98.3828125 35.6894531 85.1152344 0.529296875 13.2519531 20.7773438 0.330078125 86.7519531 59.4433594 106.298828 79.1210937 101.582031 107.460937 104.070313"></polygon>
            </g>
            <g id="1-4_features" transform="translate(75.000000, 148.000000)" fill="#E2D52A">
                <circle id="Oval-2" cx="80" cy="178" r="4"></circle>
                <circle id="Oval-2" cx="100" cy="140" r="4"></circle>
                <circle id="Oval-2" cx="118" cy="148" r="4"></circle>
                <circle id="Oval-2" cx="49" cy="164" r="4"></circle>
                <circle id="Oval-2-Copy-10" cx="4" cy="64" r="4"></circle>
                <circle id="Oval-2" cx="60" cy="160" r="4"></circle>
                <circle id="Oval-2-Copy" cx="33" cy="72" r="4"></circle>
                <circle id="Oval-2-Copy-5" cx="67" cy="97" r="4"></circle>
                <circle id="Oval-2-Copy-9" cx="80" cy="80" r="4"></circle>
                <circle id="Oval-2" cx="166.5" cy="173.5" r="3.5"></circle>
                <circle id="Oval-2-Copy-13" cx="66.5" cy="60.5" r="3.5"></circle>
                <circle id="Oval-2-Copy-14" cx="22.5" cy="118.5" r="3.5"></circle>
                <ellipse id="Path" cx="170.5" cy="158" rx="3.5" ry="4"></ellipse>
                <circle id="Oval-2" cx="64" cy="176" r="4"></circle>
                <circle id="Oval-2" cx="132" cy="139" r="3"></circle>
                <circle id="Oval-2" cx="140.5" cy="157.5" r="3.5"></circle>
                <circle id="Oval-2" cx="121" cy="181" r="4"></circle>
                <circle id="Oval-2-Copy-12" cx="133" cy="4" r="4"></circle>
                <circle id="Oval-2" cx="97" cy="161" r="3"></circle>
                <circle id="Oval-2-Copy-2" cx="111" cy="127" r="3"></circle>
                <circle id="Oval-2-Copy-3" cx="85" cy="136" r="3"></circle>
                <circle id="Oval-2-Copy-4" cx="79" cy="144" r="3"></circle>
                <circle id="Oval-2-Copy-6" cx="144" cy="115" r="3"></circle>
                <circle id="Oval-2-Copy-7" cx="60" cy="139" r="3"></circle>
                <circle id="Oval-2-Copy-8" cx="30" cy="155" r="3"></circle>
                <circle id="Oval-2" cx="156" cy="118" r="3"></circle>
                <circle id="Oval-2" cx="132" cy="121" r="3"></circle>
                <circle id="Oval-2" cx="18" cy="165" r="4"></circle>
                <circle id="Oval-2-Copy-11" cx="64" cy="34" r="4"></circle>
            </g>
            <g id="1-2_phone" transform="translate(257.431048, 288.284945) rotate(-37.000000) translate(-257.431048, -288.284945) translate(246.931048, 264.284945)"></g>
            <g id="4-4_anchors" transform="translate(140.000000, 173.000000)" stroke="#000000">
                <path d="M26.1171875,45 L26.1171875,75" id="Path-4" stroke-width="2" stroke-dasharray="2,2"></path>
                <polygon id="Path-6" points="0.359375 15.109375 44.578125 0.50390625 44.578125 67.8945313 0.359375 84.4160156"></polygon>
            </g>
            <g id="4-5_person" transform="translate(252.000000, 241.000000)">
                <g id="Rectangle">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-1"></use>
                    <path stroke="#979797" stroke-width="1" d="M9.41864427,14.060003 C6.46726462,15.1446882 4.50583645,17.955247 4.50583645,21.0996363 L4.50583645,51.8317391 C4.50583645,52.6548737 4.65243614,53.4714297 4.93876851,54.2431578 C6.27055829,57.8326217 10.2600226,59.6628282 13.8494865,58.3310384 L18.6499132,56.5499482 C21.5899765,55.4591039 23.5409927,52.6542457 23.5409927,49.5183386 L23.5409927,18.8260198 C23.5409927,18.0081932 23.3966108,17.1967884 23.1144942,16.4291619 C21.7907461,12.8273031 17.7977528,10.9805295 14.1958941,12.3042775 L9.41864427,14.060003 Z"></path>
                </g>
                <path d="M43.8662109,54.2951339 C43.2197037,47.2391468 42.4052506,43.8266412 41.4228516,44.0576172 C35.9941406,45.3339844 28.5444721,9.38688117 30.8359375,6.22265625 C34.6060532,1.01660156 69.0625,-7.31651228 67.84375,16.3310547 C67.03125,32.0960993 63.9322917,44.7507924 58.546875,54.2951339 C66.7701069,49.2018936 72.1395731,46.6552734 74.6552734,46.6552734 C78.428824,46.6552734 81.2041008,52.8013269 80.8476562,55.4792972 C80.6100265,57.2646107 79.5517583,70.7331002 77.6728516,95.8847656 C69.9235026,105.734375 61.6959635,110.609701 52.9902344,110.510742 C39.9316406,110.362305 27.5716684,104.533615 25.8232422,101.063477 C24.6576247,98.7500512 22.6400466,83.5553248 19.7705078,55.4792972 L22.8642578,46.6552734 L43.8662109,54.2951339 Z" id="Path-7" fill="#80D7DA"></path>
            </g>
            <g id="0-1_person" transform="translate(252.000000, 241.000000)">
                <g id="Rectangle">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-2"></use>
                    <path stroke="#979797" stroke-width="1" d="M9.41864427,14.060003 C6.46726462,15.1446882 4.50583645,17.955247 4.50583645,21.0996363 L4.50583645,51.8317391 C4.50583645,52.6548737 4.65243614,53.4714297 4.93876851,54.2431578 C6.27055829,57.8326217 10.2600226,59.6628282 13.8494865,58.3310384 L18.6499132,56.5499482 C21.5899765,55.4591039 23.5409927,52.6542457 23.5409927,49.5183386 L23.5409927,18.8260198 C23.5409927,18.0081932 23.3966108,17.1967884 23.1144942,16.4291619 C21.7907461,12.8273031 17.7977528,10.9805295 14.1958941,12.3042775 L9.41864427,14.060003 Z"></path>
                </g>
                <path d="M43.8662109,54.2951339 C43.2197037,47.2391468 42.4052506,43.8266412 41.4228516,44.0576172 C35.9941406,45.3339844 28.5444721,9.38688117 30.8359375,6.22265625 C34.6060532,1.01660156 69.0625,-7.31651228 67.84375,16.3310547 C67.03125,32.0960993 63.9322917,44.7507924 58.546875,54.2951339 C66.7701069,49.2018936 72.1395731,46.6552734 74.6552734,46.6552734 C78.428824,46.6552734 81.2041008,52.8013269 80.8476562,55.4792972 C80.6100265,57.2646107 79.5517583,70.7331002 77.6728516,95.8847656 C69.9235026,105.734375 61.6959635,110.609701 52.9902344,110.510742 C39.9316406,110.362305 27.5716684,104.533615 25.8232422,101.063477 C24.6576247,98.7500512 22.6400466,83.5553248 19.7705078,55.4792972 L22.8642578,46.6552734 L43.8662109,54.2951339 Z" id="Path-7" fill="#80D7DA"></path>
            </g>
            <g id="2-3_person" transform="translate(183.000000, 203.000000)" fill="#80D7DA">
                <path d="M24.0957031,53.8487582 C23.4491959,46.7927711 22.6347428,43.3802655 21.6523438,43.6112415 C16.2236328,44.8876087 8.77396432,8.94050549 11.0654297,5.77628056 C14.8355454,0.570225875 49.2919922,-7.76288797 48.0732422,15.884679 C47.2607422,31.6497236 44.1617839,44.3044167 38.7763672,53.8487582 C46.9995991,48.7555179 52.3690653,46.2088977 54.8847656,46.2088977 C58.6583162,46.2088977 61.433593,52.3549512 61.0771484,55.0329215 C60.8395187,56.818235 59.7812505,70.2867245 57.9023438,95.4383899 C50.1529948,105.287999 41.9254557,110.163325 33.2197266,110.064366 C20.1611328,109.915929 7.80116056,104.087239 6.05273438,100.617101 C4.88711692,98.3036755 2.86953879,83.1089491 0,55.0329215 L3.09375,46.2088977 L24.0957031,53.8487582 Z" id="Path-7"></path>
            </g>
            <g id="3-3_temp-phone" transform="translate(155.000000, 195.000000)">
                <g id="Rectangle">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-3"></use>
                    <path stroke="#979797" stroke-width="1" d="M5.41280781,2.68424895 C2.46142817,3.7689342 0.5,6.57949295 0.5,9.72388222 L0.5,40.4559851 C0.5,41.2791197 0.646599691,42.0956756 0.932932058,42.8674038 C2.26472184,46.4568677 6.2541862,48.2870742 9.84365009,46.9552844 L14.6440767,45.1741941 C17.58414,44.0833498 19.5351562,41.2784917 19.5351562,38.1425845 L19.5351562,7.45026573 C19.5351562,6.6324392 19.3907743,5.82103436 19.1086577,5.05340784 C17.7849097,1.45154906 13.7919164,-0.395224566 10.1900576,0.928523495 L5.41280781,2.68424895 Z"></path>
                </g>
            </g>
            <g id="4-4_wall" transform="translate(155.000000, 195.000000)" stroke="#000000" stroke-width="2" stroke-dasharray="2">
                <use id="Rectangle" mask="url(#mask-5)" xlink:href="#path-4"></use>
            </g>
            <g id="2-2_phone" transform="translate(163.000000, 203.000000)">
                <g id="Rectangle">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-6"></use>
                    <path stroke="#979797" stroke-width="1" d="M5.41280781,2.68424895 C2.46142817,3.7689342 0.5,6.57949295 0.5,9.72388222 L0.5,40.4559851 C0.5,41.2791197 0.646599691,42.0956756 0.932932058,42.8674038 C2.26472184,46.4568677 6.2541862,48.2870742 9.84365009,46.9552844 L14.6440767,45.1741941 C17.58414,44.0833498 19.5351562,41.2784917 19.5351562,38.1425845 L19.5351562,7.45026573 C19.5351562,6.6324392 19.3907743,5.82103436 19.1086577,5.05340784 C17.7849097,1.45154906 13.7919164,-0.395224566 10.1900576,0.928523495 L5.41280781,2.68424895 Z"></path>
                </g>
            </g>
        </g>
    </g>
</svg></div>
</article>

<p>We got this to a point where it was working most of the time. One of the core issues was that there’s a lot of
guess-work at the end of the process. The artwork would usually be at the position of your phone, but it was rarely
oriented correctly. We experimented by placing the artwork a meter away, but in user testing very few people could do
that roughly in their head, and we opted to use the exact position of the phone. This meant that you had to move to
touch the wall, then come back to see if the artwork was placed correctly.</p>

<p>This user flow was hard to explain, and it felt like we weren’t setting people up to win. It was quite a debate about
whether we could ship with this or not because we wanted to ship <a href="https://github.com/artsy/meta/blob/master/meta/what_is_artsy.md#quality-worthy-of-art">Quality worthy of Art</a>. Then we read about the
upcoming changes in ARKit 1.5. <strong>Vertical plane detection</strong>. Or, <em>mostly</em> wall detection. The debate over whether our
initial approach was good enough became moot.</p>

<p>With the advent of vertical wall detection, we could change our flow to be a lot like what someone would have thought it
should be:</p>

<article class="desktop-only" style="display: flex; flex-flow:row; margin: 0px -60px;">
<div style="flex:1;">
  <ol class="workflow" data-id="v3">
    <li>Open up ARKit and let it discover the world</li>
    <li>Ask a user to point at a wall</li>
    <li>Use the feature detection to detect a plane</li>
    <li>Use that plane to place an artwork</li>
  </ol>
</div>
<div style="flex:1"><?xml version="1.0" encoding="UTF-8"?>
<svg width="530px" height="460px" viewBox="0 0 530 460" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
    <title>v3</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <path d="M15.5931447,21.0693125 L20.3703944,19.313587 L20.3703944,19.313587 C24.2314454,17.8945812 28.5117771,19.8742499 29.9307829,23.7353008 C30.2332008,24.5581662 30.3879726,25.4279603 30.3879726,26.3046382 L30.3879726,56.9969569 L30.3879726,56.9969569 C30.3879726,60.3419246 28.3068886,63.3337733 25.1708211,64.4973405 L20.3703944,66.2784308 L20.3703944,66.2784308 C16.5220338,67.7062784 12.244822,65.7440649 10.8169744,61.8957043 C10.5099898,61.0683138 10.3528163,60.1928622 10.3528163,59.3103575 C10.3528163,50.8653937 10.3528163,42.42043 10.3528163,33.9754662 C10.3528163,32.1763957 10.3528163,30.3773252 10.3528163,28.5782547 L10.3528163,28.5782547 C10.3528163,25.2242394 12.4450064,22.2263101 15.5931447,21.0693125 Z" id="path-1"></path>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="v3">
            <g id="0-4_room" transform="translate(18.000000, 14.000000)">
                <polyline id="Path-2" stroke="#BCEBED" stroke-width="2" transform="translate(250.949219, 301.207031) scale(1, -1) translate(-250.949219, -301.207031) " points="0 290.9375 198.996094 360.277344 501.898438 242.136719"></polyline>
                <path d="M200,0.5 L200,242.5" id="Path-3" stroke="#BCEBED" stroke-width="2"></path>
                <polygon id="Path" stroke="#80D7DA" stroke-width="4" points="1 64.6445313 200.320312 1 502.441406 112.097656 502.441406 360.867188 312.496094 433.988281 1 313.414062"></polygon>
            </g>
            <g id="2-4_camera" transform="translate(55.000000, 117.000000)" fill-opacity="0.179630888" fill="#F5A623">
                <polygon id="Path-5" points="218.78125 80.3027344 174.591797 0.3046875 0.55859375 24 5.89453125 194.316406 34.2070313 213.144531 136.007813 226.998047 225.933594 210.289063"></polygon>
            </g>
            <g id="2-4_features" transform="translate(89.000000, 169.000000)" fill="#E2D52A">
                <circle id="Oval-2" cx="66" cy="157" r="4"></circle>
                <circle id="Oval-2" cx="86" cy="119" r="4"></circle>
                <circle id="Oval-2" cx="104" cy="127" r="4"></circle>
                <circle id="Oval-2" cx="35" cy="143" r="4"></circle>
                <circle id="Oval-2" cx="46" cy="139" r="4"></circle>
                <circle id="Oval-2" cx="152.5" cy="152.5" r="3.5"></circle>
                <ellipse id="Path" cx="156.5" cy="137" rx="3.5" ry="4"></ellipse>
                <circle id="Oval-2" cx="50" cy="155" r="4"></circle>
                <circle id="Oval-2" cx="118" cy="118" r="3"></circle>
                <circle id="Oval-2-Copy-13" cx="93" cy="45" r="3"></circle>
                <circle id="Oval-2-Copy-14" cx="42" cy="42" r="3"></circle>
                <circle id="Oval-2-Copy-15" cx="57" cy="88" r="3"></circle>
                <circle id="Oval-2-Copy-16" cx="108" cy="68" r="3"></circle>
                <circle id="Oval-2-Copy-17" cx="121" cy="33" r="3"></circle>
                <circle id="Oval-2-Copy-18" cx="117.5" cy="2.5" r="2.5"></circle>
                <circle id="Oval-2-Copy-19" cx="113.5" cy="27.5" r="2.5"></circle>
                <circle id="Oval-2-Copy-20" cx="118.5" cy="56.5" r="2.5"></circle>
                <circle id="Oval-2-Copy-21" cx="66.5" cy="61.5" r="2.5"></circle>
                <circle id="Oval-2" cx="126.5" cy="136.5" r="3.5"></circle>
                <circle id="Oval-2" cx="107" cy="160" r="4"></circle>
                <circle id="Oval-2" cx="83" cy="140" r="3"></circle>
                <circle id="Oval-2-Copy" cx="7" cy="94" r="3"></circle>
                <circle id="Oval-2-Copy-5" cx="19" cy="68" r="3"></circle>
                <circle id="Oval-2-Copy-9" cx="7" cy="39" r="3"></circle>
                <circle id="Oval-2-Copy-10" cx="46" cy="62" r="3"></circle>
                <circle id="Oval-2-Copy-11" cx="46" cy="16" r="3"></circle>
                <circle id="Oval-2-Copy-23" cx="22" cy="54" r="3"></circle>
                <circle id="Oval-2-Copy-12" cx="77" cy="74" r="3"></circle>
                <circle id="Oval-2-Copy-2" cx="97" cy="106" r="3"></circle>
                <circle id="Oval-2-Copy-3" cx="71" cy="115" r="3"></circle>
                <circle id="Oval-2-Copy-4" cx="65" cy="123" r="3"></circle>
                <circle id="Oval-2-Copy-22" cx="22" cy="25" r="3"></circle>
                <circle id="Oval-2-Copy-6" cx="130" cy="94" r="3"></circle>
                <circle id="Oval-2-Copy-7" cx="46" cy="118" r="3"></circle>
                <circle id="Oval-2-Copy-8" cx="16" cy="134" r="3"></circle>
                <circle id="Oval-2" cx="142" cy="97" r="3"></circle>
                <circle id="Oval-2" cx="118" cy="100" r="3"></circle>
                <circle id="Oval-2" cx="4" cy="144" r="4"></circle>
            </g>
            <g id="1-4_phone" transform="translate(257.431048, 288.284945) rotate(-37.000000) translate(-257.431048, -288.284945) translate(246.931048, 264.284945)"></g>
            <g id="0-4_person" transform="translate(238.000000, 241.000000)">
                <g id="Rectangle">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-1"></use>
                    <path stroke="#979797" stroke-width="1" d="M15.7656241,21.5386214 C12.8142445,22.6233066 10.8528163,25.4338654 10.8528163,28.5782547 L10.8528163,59.3103575 C10.8528163,60.1334921 10.999416,60.950048 11.2857484,61.7217762 C12.6175382,65.3112401 16.6070025,67.1414466 20.1964664,65.8096568 L24.996893,64.0285666 C27.9369564,62.9377223 29.8879726,60.1328641 29.8879726,56.9969569 L29.8879726,26.3046382 C29.8879726,25.4868116 29.7435906,24.6754068 29.4614741,23.9077803 C28.137726,20.3059215 24.1447327,18.4591479 20.5428739,19.7828959 L15.7656241,21.5386214 Z"></path>
                </g>
                <path d="M57.8662109,54.2951339 C57.2197037,47.2391468 56.4052506,43.8266412 55.4228516,44.0576172 C49.9941406,45.3339844 42.5444721,9.38688117 44.8359375,6.22265625 C48.6060532,1.01660156 83.0625,-7.31651228 81.84375,16.3310547 C81.03125,32.0960993 77.9322917,44.7507924 72.546875,54.2951339 C80.7701069,49.2018936 86.1395731,46.6552734 88.6552734,46.6552734 C92.428824,46.6552734 95.2041008,52.8013269 94.8476562,55.4792972 C94.6100265,57.2646107 93.5517583,70.7331002 91.6728516,95.8847656 C83.9235026,105.734375 75.6959635,110.609701 66.9902344,110.510742 C53.9316406,110.362305 41.5716684,104.533615 39.8232422,101.063477 C38.6576247,98.7500512 36.6400466,83.5553248 33.7705078,55.4792972 L36.8642578,46.6552734 L57.8662109,54.2951339 Z" id="Path-7" fill="#80D7DA"></path>
            </g>
            <g id="4-4_work" transform="translate(136.000000, 165.000000)" stroke="#000000">
                <polygon id="Path-6" points="0.359375 15.109375 44.578125 0.50390625 44.578125 67.8945313 0.359375 84.4160156"></polygon>
            </g>
            <g id="3-4-plane" transform="translate(86.000000, 151.000000)" stroke-width="2" stroke="#E2D52A" fill-opacity="0.27100317" fill="#E2D52A">
                <polygon id="Path-2" transform="translate(64.065430, 59.840820) scale(1, -1) translate(-64.065430, -59.840820) " points="0.537109375 81.3066406 127.59375 119.625 127.59375 40.6816406 5.53710938 0.056640625"></polygon>
            </g>
        </g>
    </g>
</svg></div>
</article>

<p>This seems almost perfect, except that it only works in theory. In practice, you don’t get enough feature points on a
blank wall. Recommending user point their phone at a blank wall (the kind of wall you’d place an artwork on) is likely
to end up in frustration. So instead, our user flow is:</p>

<article class="desktop-only" style="display: flex; flex-flow:row; margin: 0px -60px;">
<div style="flex:1;">
  <ol class="workflow" data-id="v4">
    <li>Open up ARKit and let it discover the world</li>
    <li>Ask a user to point at an existing object on a wall</li>
    <li>Expand the discovered plane in all directions</li>
    <li>Use the extended plane to place an artwork</li>
  </ol>
</div>
<div style="flex:1"><?xml version="1.0" encoding="UTF-8"?>
<svg width="530px" height="460px" viewBox="0 0 530 460" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 47.1 (45422) - http://www.bohemiancoding.com/sketch -->
    <title>v4</title>
    <desc>Created with Sketch.</desc>
    <defs>
        <path d="M15.5931447,21.0693125 L20.3703944,19.313587 L20.3703944,19.313587 C24.2314454,17.8945812 28.5117771,19.8742499 29.9307829,23.7353008 C30.2332008,24.5581662 30.3879726,25.4279603 30.3879726,26.3046382 L30.3879726,56.9969569 L30.3879726,56.9969569 C30.3879726,60.3419246 28.3068886,63.3337733 25.1708211,64.4973405 L20.3703944,66.2784308 L20.3703944,66.2784308 C16.5220338,67.7062784 12.244822,65.7440649 10.8169744,61.8957043 C10.5099898,61.0683138 10.3528163,60.1928622 10.3528163,59.3103575 C10.3528163,50.8653937 10.3528163,42.42043 10.3528163,33.9754662 C10.3528163,32.1763957 10.3528163,30.3773252 10.3528163,28.5782547 L10.3528163,28.5782547 C10.3528163,25.2242394 12.4450064,22.2263101 15.5931447,21.0693125 Z" id="path-1"></path>
    </defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="v4">
            <g id="0-4_room" transform="translate(18.000000, 14.000000)">
                <polyline id="Path-2" stroke="#BCEBED" stroke-width="2" transform="translate(250.949219, 301.207031) scale(1, -1) translate(-250.949219, -301.207031) " points="0 290.9375 198.996094 360.277344 501.898438 242.136719"></polyline>
                <path d="M200,0.5 L200,242.5" id="Path-3" stroke="#BCEBED" stroke-width="2"></path>
                <polygon id="Path" stroke="#80D7DA" stroke-width="4" points="1 64.6445313 200.320312 1 502.441406 112.097656 502.441406 360.867188 312.496094 433.988281 1 313.414062"></polygon>
                <polygon id="Path-9" stroke="#BCEBED" points="140 143.699219 140 220.496094 176.507812 208.332031 176.507812 132"></polygon>
            </g>
            <g id="1-4_camera" transform="translate(55.000000, 117.000000)" fill-opacity="0.179630888" fill="#F5A623">
                <polygon id="Path-5" points="218.78125 80.3027344 174.591797 0.3046875 0.55859375 24 5.89453125 194.316406 34.2070313 213.144531 136.007813 226.998047 225.933594 210.289063"></polygon>
            </g>
            <g id="1-4_features" transform="translate(89.000000, 156.000000)" fill="#E2D52A">
                <circle id="Oval-2" cx="66" cy="170" r="4"></circle>
                <circle id="Oval-2" cx="86" cy="132" r="4"></circle>
                <circle id="Oval-2" cx="104" cy="140" r="4"></circle>
                <circle id="Oval-2" cx="35" cy="156" r="4"></circle>
                <circle id="Oval-2" cx="46" cy="152" r="4"></circle>
                <circle id="Oval-2" cx="152.5" cy="165.5" r="3.5"></circle>
                <ellipse id="Path" cx="156.5" cy="150" rx="3.5" ry="4"></ellipse>
                <circle id="Oval-2" cx="50" cy="168" r="4"></circle>
                <circle id="Oval-2" cx="118" cy="131" r="3"></circle>
                <circle id="Oval-2-Copy-13" cx="93" cy="58" r="3"></circle>
                <circle id="Oval-2-Copy-14" cx="100" cy="66" r="3"></circle>
                <circle id="Oval-2-Copy-15" cx="57" cy="101" r="3"></circle>
                <circle id="Oval-2-Copy-16" cx="108" cy="81" r="3"></circle>
                <circle id="Oval-2-Copy-17" cx="81" cy="34" r="3"></circle>
                <circle id="Oval-2-Copy-18" cx="77.5" cy="3.5" r="2.5"></circle>
                <circle id="Oval-2-Copy-19" cx="73.5" cy="28.5" r="2.5"></circle>
                <circle id="Oval-2-Copy-20" cx="118.5" cy="69.5" r="2.5"></circle>
                <circle id="Oval-2-Copy-21" cx="66.5" cy="74.5" r="2.5"></circle>
                <circle id="Oval-2" cx="126.5" cy="149.5" r="3.5"></circle>
                <circle id="Oval-2" cx="107" cy="173" r="4"></circle>
                <circle id="Oval-2" cx="83" cy="153" r="3"></circle>
                <circle id="Oval-2-Copy" cx="65" cy="81" r="3"></circle>
                <circle id="Oval-2-Copy-5" cx="101" cy="40" r="3"></circle>
                <circle id="Oval-2-Copy-9" cx="89" cy="11" r="3"></circle>
                <circle id="Oval-2-Copy-10" cx="46" cy="75" r="3"></circle>
                <circle id="Oval-2-Copy-11" cx="104" cy="3" r="3"></circle>
                <circle id="Oval-2-Copy-23" cx="104" cy="26" r="3"></circle>
                <circle id="Oval-2-Copy-12" cx="77" cy="87" r="3"></circle>
                <circle id="Oval-2-Copy-2" cx="97" cy="119" r="3"></circle>
                <circle id="Oval-2-Copy-3" cx="71" cy="128" r="3"></circle>
                <circle id="Oval-2-Copy-4" cx="65" cy="136" r="3"></circle>
                <circle id="Oval-2-Copy-22" cx="80" cy="49" r="3"></circle>
                <circle id="Oval-2-Copy-6" cx="130" cy="107" r="3"></circle>
                <circle id="Oval-2-Copy-7" cx="46" cy="131" r="3"></circle>
                <circle id="Oval-2-Copy-8" cx="16" cy="147" r="3"></circle>
                <circle id="Oval-2" cx="142" cy="110" r="3"></circle>
                <circle id="Oval-2" cx="118" cy="113" r="3"></circle>
                <circle id="Oval-2" cx="4" cy="157" r="4"></circle>
            </g>
            <g id="1-4_phone" transform="translate(257.431048, 288.284945) rotate(-37.000000) translate(-257.431048, -288.284945) translate(246.931048, 264.284945)"></g>
            <g id="0-4_person" transform="translate(238.000000, 241.000000)">
                <g id="Rectangle">
                    <use fill="#353535" fill-rule="evenodd" xlink:href="#path-1"></use>
                    <path stroke="#979797" stroke-width="1" d="M15.7656241,21.5386214 C12.8142445,22.6233066 10.8528163,25.4338654 10.8528163,28.5782547 L10.8528163,59.3103575 C10.8528163,60.1334921 10.999416,60.950048 11.2857484,61.7217762 C12.6175382,65.3112401 16.6070025,67.1414466 20.1964664,65.8096568 L24.996893,64.0285666 C27.9369564,62.9377223 29.8879726,60.1328641 29.8879726,56.9969569 L29.8879726,26.3046382 C29.8879726,25.4868116 29.7435906,24.6754068 29.4614741,23.9077803 C28.137726,20.3059215 24.1447327,18.4591479 20.5428739,19.7828959 L15.7656241,21.5386214 Z"></path>
                </g>
                <path d="M57.8662109,54.2951339 C57.2197037,47.2391468 56.4052506,43.8266412 55.4228516,44.0576172 C49.9941406,45.3339844 42.5444721,9.38688117 44.8359375,6.22265625 C48.6060532,1.01660156 83.0625,-7.31651228 81.84375,16.3310547 C81.03125,32.0960993 77.9322917,44.7507924 72.546875,54.2951339 C80.7701069,49.2018936 86.1395731,46.6552734 88.6552734,46.6552734 C92.428824,46.6552734 95.2041008,52.8013269 94.8476562,55.4792972 C94.6100265,57.2646107 93.5517583,70.7331002 91.6728516,95.8847656 C83.9235026,105.734375 75.6959635,110.609701 66.9902344,110.510742 C53.9316406,110.362305 41.5716684,104.533615 39.8232422,101.063477 C38.6576247,98.7500512 36.6400466,83.5553248 33.7705078,55.4792972 L36.8642578,46.6552734 L57.8662109,54.2951339 Z" id="Path-7" fill="#80D7DA"></path>
            </g>
            <g id="4-4_work" transform="translate(94.000000, 166.000000)" stroke="#000000">
                <polygon id="Path-6" points="0.359375 15.109375 44.578125 0.50390625 44.578125 67.8945313 0.359375 84.4160156"></polygon>
            </g>
            <g id="2-4-plane" transform="translate(154.000000, 144.000000)" stroke-width="2" stroke="#E2D52A" fill-opacity="0.27100317" fill="#E2D52A">
                <polygon id="Path-2" transform="translate(22.351563, 46.503906) scale(1, -1) translate(-22.351563, -46.503906) " points="0.724609375 81.4941406 43.9785156 92.9433594 43.9785156 14.2070312 0.724609375 0.064453125"></polygon>
            </g>
            <g id="3-4-extended-plane" transform="translate(10.000000, 106.000000)" stroke="#7ED321" stroke-dasharray="2">
                <polygon id="Path-10" points="0.57421875 76.140625 288.720703 0.248046875 288.720703 94.5058594 0.57421875 187.464844"></polygon>
            </g>
        </g>
    </g>
</svg></div>
</article>

<p>🎉 - you have the Artsy workflow for putting a work on the wall.</p>

<h2 id="abstractions">Abstractions</h2>

<p>While we were not initially sure about how well ARKit would work out for us, we thought the best way to get our feet wet
would be to work with a contractor. We knew <a href="http://www.lazerwalker.com">@lazerwalker</a> through the iOS dev community and asked if he
was interested in prototyping it out. He built out a demo application of the first design iteration, you can <a href="https://github.com/lazerwalker/art-on-walls-prototype">see it
here</a> as it’s MIT licensed.</p>

<p>I took his prototype and <a href="https://github.com/artsy/eigen/pull/2501">merged it into our app</a> Eigen. From there, I started to turn the prototype into
production code. We effectively had two state machines: one that was handling the internal state of the AR world, and
another which handled the user interface from the UIKit world. We kept these in sync by having two protocols:
<code class="language-plaintext highlighter-rouge">ARVIRInteractive</code> and <code class="language-plaintext highlighter-rouge">ARVIRDelegate</code>.</p>

<p>They didn’t end up being that complex, you can see them in <a href="https://github.com/artsy/eigen/blob/f897b3438bd07470bd88a790fc6d6a524f5756cb/Artsy/View_Controllers/ARVIR/AR/ARAugmentedVIRInteractionController.h"><code class="language-plaintext highlighter-rouge">ARAugmentedVIRInteractionController.h</code></a>. In fact,
the story of AR at Artsy is that most of this is not too complex. Which I think is a testament to how well thought-out
ARKit is.</p>

<p>So to make it work, we have a reasonably complicated UIViewController subclass,
<a href="https://github.com/artsy/eigen/blob/f897b3438bd07470bd88a790fc6d6a524f5756cb/Artsy/View_Controllers/Core/ARViewInRoomViewController.m"><code class="language-plaintext highlighter-rouge">ARAugmentedVIRViewController.m</code></a> which handles presenting a user interface above the camera, then an
interaction controller <a href="https://github.com/artsy/eigen/blob/f897b3438bd07470bd88a790fc6d6a524f5756cb/Artsy/View_Controllers/ARVIR/AR/ARAugmentedVIRInteractionController.m"><code class="language-plaintext highlighter-rouge">ARAugmentedVIRInteractionController.m</code></a> which handles all of the interactions inside
AR. By using protocols to communicate between two, I could test out different AR interactions by duplicating the
existing interaction controller and iterating on a new object for a while. This made it possible to prototype a few
ideas, then switch between them - saving on dev time as this project wasn’t a good fit for <a href="http://artsy.github.io/series/react-native-at-artsy/">React Native</a>.</p>

<p>React Native is really great for <a href="http://artsy.github.io/blog/2018/03/17/two-years-of-react-native/">nearly every screen we deal with</a> typically. We tend to basically build pretty
screens of JSON. This experience is far from that. It requires constantly changing states between two very separate but
linked worlds. One of the biggest advantages to doing it in React Native would have been using it for cross-platform
work, but that’s speculative as only ARKit supports vertical plane detection today. We’d have had to either use <a href="https://github.com/react-native-ar/react-native-arkit">a
dependency</a>, or build our own simpler bridge from ARKit to JS and maintain that. It just felt like a lot of work
for a one-off section of the app.</p>

<p>Testing this code turned out to not be too valuable, I have tests that <a href="https://github.com/artsy/eigen/tree/master/Artsy_Tests/View_Controller_Tests/ARVIR">cover a lot of the UIKit level</a> work but
I avoided writing tests for ARKit code. It was changing too often, and was often exploratory. Also, our tests run on iOS
10, which doesn’t support ARKit anyway. So those tests would not run on CI.</p>

<h2 id="demo">Demo</h2>

<p>Wonder what it looks like in production? Click through for a video of it in action in my “cosy” manhattan bedroom:</p>

<center>
<a href="http://files.artsy.net/videos/eigen-arvir-demo.mp4">
<img src="/images/ar/ar-vir-demo.png" width="325" />
</a>
</center>

<p>We explicitly aimed to try and have this project as free as possible from dependencies so that others could re-use this
code. It’s not <em>quite</em> generic enough to warrant making it’s own CocoaPod, but it’s MIT licensed and most of the
dependencies are to do with user-interface styling and testing, which should be easily replaced in another codebase. Let
us know if you’ve explored adding something it to your app or have questions!</p>

<style type="text/css">
.workflow li {
  width: 230px;
  padding: 20px;
  list-style:none;
  color: #80D7DA;
  border: 1px solid #80D7DA;
  margin-top:-1px;
}
.workflow li.active {
  border-left: 1px solid black;
  border-right: 1px solid black;
  color: black;
}
.diagram {
  display: flex; 
  flex-flow:row; 
  margin: 0px -60px;
}
ol {
  padding-left: 0;
  margin-top: -20px;
}
@media screen and (min-width: 900px) {
  body > div {
    background-image: url(/images/ar/cover.svg);
    background-repeat: no-repeat;
    background-position: 0px 00px;
  }
}
</style>

<script>
  $(() => {
    // When hovering on an .workflow li, use it's index
    // to disable groups in a correlating SVG. Groups in the SVG
    // all are prefixed with `start-end_name`.
    $(".workflow li").hover(function() {
        var thisIndex = $(this).index()  + 1
        var parentDataID = $(this).parent().data("id")
        $(this).parent().children().removeClass('active')
        $(this).addClass('active')

        $('g#' + parentDataID +' g').toArray().forEach(g => {
          if (!g.id.includes("-")) { return }

          var before = parseInt(g.id.split("-")[0])
          var after = parseInt(g.id.split("-")[1].split("_")[0])
          var shouldShow = before <= thisIndex && thisIndex <= after

          g.style.display = shouldShow ? "block" : "none"
        })
    });
    
    // Select the first item in every SVG li
    $(".workflow li:first-child").mouseenter()
})</script>

]]></content>
  </entry>
  
</feed>
