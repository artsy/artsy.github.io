<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Artsy Engineering</title>
    <description></description>
    <link>http://artsy.github.io/</link>
    <atom:link href="http://artsy.github.io/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Fri, 21 Aug 2020 17:43:39 +0000</pubDate>
    <lastBuildDate>Fri, 21 Aug 2020 17:43:39 +0000</lastBuildDate>
    <generator>Jekyll v2.5.3</generator>
    
      <item>
        <title>Servers for Everyone: Review Apps @ Artsy</title>
        <description>&lt;p&gt;This blog post is going to motivate and describe Artsy&#39;s adoption and evolution
of the usage of review apps.&lt;/p&gt;

&lt;p&gt;This first part of this post covers a couple of common problems where
topic-specific servers (i.e. review apps) are useful.&lt;/p&gt;

&lt;p&gt;The rest of the post describes Artsy&#39;s history with review app automation via
incremental problem solving and the composition of a few well-known technologies.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;a name=&quot;Problem.1.0:.A.Single.Shared.Staging.Environment&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Problem 1.0: A Single Shared Staging Environment&lt;/h2&gt;

&lt;p&gt;At Artsy, we have a sizable engineering organization: ~40 engineers organized
across many teams. Engineers on those teams work on many codebases, some are
exclusive to a team, but many codebases are worked on by engineers across many
teams. Artsy&#39;s website (www.artsy.net), &lt;a href=&quot;https://github.com/artsy/force&quot;&gt;Force&lt;/a&gt;, is a good example of such a shared
service.&lt;/p&gt;

&lt;p&gt;These different teams of developers working on a shared service have (mostly
hidden) dependencies upon each other, most visible when a shared service is being
deployed to production.&lt;/p&gt;

&lt;p&gt;Let&#39;s work the following example:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Team A is hard at work finishing up a new feature (say a new search
page for a list of art auctions) on Service S and is now doing a final round
of QA before deploying to production&lt;/li&gt;
&lt;li&gt;Team B is fixing a bug in an unrelated part of Service S&lt;/li&gt;
&lt;li&gt;Team B confirms that the bug was squashed on staging&lt;/li&gt;
&lt;li&gt;Team B deploys Service S to production&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Artsy&#39;s production deployment flow is rooted in a GitHub Pull Request, meaning
that the commits that differ between staging (on the &lt;code&gt;staging&lt;/code&gt; Git branch) and
production (on the &lt;code&gt;release&lt;/code&gt; Git branch) are clear to whomever is managing a
deploy (&lt;a href=&quot;https://github.com/artsy/force/pull/6106&quot;&gt;example&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;While it&#39;s great that our deploys are easy to understand, ensuring that a deploy
of a service is safe &lt;em&gt;requires communicating with the teams that contributed
code to ensure that their work is &quot;safe to deploy&quot;&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&quot;Safe to deploy&quot; might mean different things depending on the nature of the
work.&lt;/p&gt;

&lt;p&gt;For example, Team A&#39;s new list of art auctions might require an API endpoint in
another Service Z to be deployed for their part of the deploy of Service S to
be safe to deploy. Team B&#39;s bugfix might just requires a quick visual confirmation.&lt;/p&gt;

&lt;p&gt;Suffice to say, it&#39;s &lt;em&gt;hard to independently confirm that another team&#39;s work is
safe to deploy&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Despite the mitigation strategies discussed next, there&#39;s risk of deploying unsafe
code whenever a single staging environment is used across many teams.&lt;/p&gt;

&lt;a name=&quot;Shared.Staging.Mitigation.Strategies&quot;&gt;&lt;/a&gt;
&lt;h4&gt;Shared Staging Mitigation Strategies&lt;/h4&gt;

&lt;p&gt;There are a couple of ways Artsy mitigates against the possible pitfalls of a
shared staging environment:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Having a culture of quickly deploying code to production&lt;/p&gt;

&lt;p&gt; By building a culture that views frequent deploys positively, there&#39;s, on average,
less diff in every deploy, mitigating the risk of unintentionally deploying code
that&#39;s not safe to deploy.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Using automated quality processes geared towards a stable staging environment&lt;/p&gt;

&lt;p&gt; We do our best to feel as confident as possible in a change &lt;em&gt;before it is deployed
 to staging&lt;/em&gt; by creating automated tests for changes, sharing visual changes over
 Slack and in PRs, and other strategies relevant to the work at hand.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Communicating deploys&lt;/p&gt;

&lt;p&gt; When deploying a service, Artsy engineers typically send a message to our #dev
Slack channel notifying of their plan to deploy a particular service, cc&#39;ing the
engineers that are involved in other PRs that are part of the deploy. In the example
above, an engineer on Team B would notify relevant stakeholders of Team A, giving
that team the opportunity to flag if their work is not yet safe to deploy.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;While these strategies are impactful:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Semi-unstructured communication is prone to breakdown: the notified engineers
on Team A might be pairing or in a meeting and Team B deploys anyways.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Without a true continuous delivery model, it&#39;s a challenge to operationalize
very frequent production deploys. Moreover, the problem compounds as the team
grows and the velocity of work increases.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Particularly when working in a large distributed system, automated testing at
the individual service level can only provide a certain level of safety for a
change. Visual changes which require correctness on different viewports and devices
are, pragmatically, often best to test manually.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If only there was a way to allow Team A and B to work without risking stepping
on each other toes!&lt;/p&gt;

&lt;p&gt;We&#39;ll discuss how review apps provide this safety, but first another related
problem.&lt;/p&gt;

&lt;a name=&quot;Problem.2.0:.Complex.Work.Needs.Many.Eyes&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Problem 2.0: Complex Work Needs Many Eyes&lt;/h2&gt;

&lt;p&gt;But before it gets better, it&#39;s going to get a bit worse.&lt;/p&gt;

&lt;p&gt;While working on any mature distributed system is a challenge, some work is
particularly challenging or risky. Generally, risk is reduced when many
skilled eyes can review the risky thing in an environment that closely mimics
the production environment.&lt;/p&gt;

&lt;p&gt;This class of work might include changes to authorization flows, page
redesigns or infrastructural upgrades (e.g. a NodeJS upgrade).&lt;/p&gt;

&lt;p&gt;For example, to feel safe deploying &lt;a href=&quot;https://github.com/artsy/force/pull/5697&quot;&gt;a major version upgrade of Artsy&#39;s design
system in Force&lt;/a&gt; the most pragmatic way forward was
to deploy that PR to a server where other engineers could collaborate on QA.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;If a single shared staging environment is the only non-production server to
deploy to, the chances that work lands on staging in an unsafe state is high&lt;/em&gt;. While
staging being unsafe isn&#39;t &lt;em&gt;itself&lt;/em&gt; a bad thing, many bad things can result:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;[Bad] Blocked Deploys&lt;/p&gt;

&lt;p&gt; If staging is unsafe and this dangerous state is discovered, then top priority
is getting a service back into a safe state. While working to get a service
back to a healthy state, new features can&#39;t be delivered.&lt;/p&gt;

&lt;p&gt;  In aggregate, this can be a sizeable productivity loss.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;[Worse] Unsafe Deploys&lt;/p&gt;

&lt;p&gt; If staging is unsafe and this dangerous state is not discovered before a production
deploy (for example, the unsafe code might be from another team, as described above),
then end-users might interact with a service that just isn&#39;t working. No good.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;[Terrible] Fear&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Fear is the mind-killer.
 &lt;a href=&quot;https://www.goodreads.com/quotes/2-i-must-not-fear-fear-is-the-mind-killer-fear-is&quot;&gt;Dune&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt; Alright, a bit over the top, but the risk of unsafe or blocked deploys can
implicitly or explicitly result in teams shying away from complex work.&lt;/p&gt;

&lt;p&gt;  This avoidable fear might result in increased technical debt or not taking on
certain projects.&lt;/p&gt;

&lt;p&gt;  It&#39;s generally bad for business and does not lead to a pleasant work environment!&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;a name=&quot;Problem.Recap..amp..Review.App.Introduction&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Problem Recap &amp;amp; Review App Introduction&lt;/h2&gt;

&lt;p&gt;To recap, there is an increased risk of unsafe or blocked deploys whenever there
is a single staging environment for a shared service. Certain types of
(incredibly useful) changes require interactive review on a live server
before we feel comfortable with those changes, which magnifies the risk of a unsafe or
blocked deploy.&lt;/p&gt;

&lt;p&gt;Review apps are simply other staging environments that are easy to spin up and
are deployed with the version of the service that you are working on.&lt;/p&gt;

&lt;p&gt;By QA-ing on a review app instead of a shared staging environment, teams can
take their time ensuring the safety of their changes, removing the risks
detailed above.&lt;/p&gt;

&lt;p&gt;Larger infrastructure upgrades (including upgrades to the
underlying K8s configuration, in addition to app-level changes) can sit on a
server for hours or days, allowing any slow-moving issue to show itself in a
lower risk environment.&lt;/p&gt;

&lt;p&gt;Artsy has iterated on its review app tooling to the point where Team A and Team B
can each deploy their changes to isolated servers of our main website, Force,
on a single &lt;code&gt;git push&lt;/code&gt; to a branch matching a naming convention.&lt;/p&gt;

&lt;p&gt;The rest of this post describes Artsy&#39;s evolution of its review app tooling
and areas for continued improvement.&lt;/p&gt;

&lt;a name=&quot;Review.App.Tooling&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Review App Tooling&lt;/h2&gt;

&lt;a name=&quot;Heroku.Days&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Heroku Days&lt;/h3&gt;

&lt;p&gt;In the beginning, Artsy deployed most services on Heroku. There were fewer engineers
and teams, so the engineering organization was less impacted by the problems described above.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://devcenter.heroku.com/articles/github-integration-review-apps&quot;&gt;Heroku review apps&lt;/a&gt; were used on some teams sparingly.&lt;/p&gt;

&lt;a name=&quot;Enter.Kubernetes.and.Hokusai&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Enter Kubernetes and Hokusai&lt;/h3&gt;

&lt;p&gt;For many reasons outside of the scope of this post, Artsy began migrating
services off of Heroku and onto an AWS-backed Kubernetes (K8s) deployment model
starting in &lt;a href=&quot;https://github.com/artsy/force/pull/953&quot;&gt;February 2017&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In order to allow application engineers to reasonably interface with K8s-backed
services, Artsy developed a command line interface,
&lt;a href=&quot;https://github.com/artsy/hokusai&quot;&gt;&lt;code&gt;hokusai&lt;/code&gt;&lt;/a&gt;, to provide a Heroku CLI-like interface for
configuring and deploying these services.&lt;/p&gt;

&lt;p&gt;Check out some &lt;a href=&quot;https://artsy.github.io/blog/2019/10/18/kubernetes-and-hokusai/&quot;&gt;prior&lt;/a&gt; &lt;a href=&quot;https://artsy.github.io/blog/2018/01/24/kubernetes-and-hokusai/&quot;&gt;posts&lt;/a&gt; discussing the experience of working with Kubernetes
and &lt;code&gt;hokusai&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;About a year after &lt;code&gt;hokusai&lt;/code&gt;&#39;s initial release, the tool released &lt;a href=&quot;https://github.com/artsy/hokusai/pull/62&quot;&gt;its initial
support for review apps&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Via subcommands within the &lt;code&gt;hokusai review_app&lt;/code&gt; namespace, developers were able to:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Create the needed K8s YAML configuration file from an existing staging configuration file&lt;/li&gt;
&lt;li&gt;Execute this configuration: creating a running server within a dedicated namespace&lt;/li&gt;
&lt;li&gt;Perform other server management tasks: re-deploying to the server, setting ENV variables, etc&lt;/li&gt;
&lt;/ul&gt;


&lt;a name=&quot;Problem:.More.Steps.Needed&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Problem: More Steps Needed&lt;/h3&gt;

&lt;p&gt;While &lt;code&gt;hokusai&lt;/code&gt;&#39;s official review app feature handles much of the core infrastructure
needed to get a service deployed to a new server, additional tasks are required
to have a working review app, which can be categorized into:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Service Agnostic Tasks&lt;/p&gt;

&lt;p&gt; These include:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Pushing a Docker image of the Git revision in question to the appropriate
Docker registry&lt;/li&gt;
&lt;li&gt;Editing the generated YAML configuration file to reference this Docker image&lt;/li&gt;
&lt;li&gt;Sourcing the appropriate ENV variables (typically from the shared staging
server)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Check out &lt;a href=&quot;https://github.com/artsy/hokusai/blob/master/docs/Review_Apps.md&quot;&gt;&lt;code&gt;hokusai&lt;/code&gt;&#39;s review app docs&lt;/a&gt; for more
 details.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Service Specific Tasks&lt;/p&gt;

&lt;p&gt; In addition, certain services have service-specific operational requirements that
 need to be met before a review app is fully functional.&lt;/p&gt;

&lt;p&gt; For example, in Force, we need to:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Publish front-end assets to S3 for the specific revision being deployed, and&lt;/li&gt;
&lt;li&gt;Tweak some ENV variables from the values copied over from the shared staging
server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;strong&gt;Impact&lt;/strong&gt;: Due to the manual labor required to (re)-learn and execute the
commands needed to build a review app, they were used sparingly by a few engineers
that already invested time in learning up on them.&lt;/p&gt;

&lt;a name=&quot;Solution:.A.bash.script&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Solution: A bash script&lt;/h3&gt;

&lt;p&gt;While these tasks described above are tedious, they don&#39;t really require a
decision-making human behind the computer and can be automated.&lt;/p&gt;

&lt;p&gt;In August 2019, we &lt;a href=&quot;https://github.com/artsy/force/pull/4412&quot;&gt;automated&lt;/a&gt; these tasks via a Bash script.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Impact&lt;/strong&gt;: A developer is able take a Force commit and get it deployed to K8s
by running a single script on their laptop. Folks became excited about review
apps and started to use them more for Force development.&lt;/p&gt;

&lt;a name=&quot;Problem:.Depending.upon.a.developer.s.laptop.doesn.t.scale&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Problem: Depending upon a developer&#39;s laptop doesn&#39;t scale&lt;/h3&gt;

&lt;p&gt;The increased excitement and usage of review apps in Force revealed a new problem:&lt;/p&gt;

&lt;p&gt;Building and pushing &gt;2 GB Docker image across home WiFi networks can be incredibly
slow, decreasing the usefulness and adoption of the Bash script.&lt;/p&gt;

&lt;a name=&quot;Solution:.Run.the.bash.script.on.CI&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Solution: Run the bash script on CI&lt;/h3&gt;

&lt;p&gt;After discussions within Artsy&#39;s Platform Practice, a possible solution
emerged: build the review app by running this Bash script on CircleCI upon push
to a branch starting with &lt;code&gt;review-app&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This means that a developer&#39;s laptop is then only responsible for pushing a
commit to a branch and CircleCI does all the heavy lifting.&lt;/p&gt;

&lt;p&gt;Moreover, the process of centralizing the review app creation into CI helped us realize
the subsequent requirement: updating, not creating, review apps when a review app
already exists for a given branch.&lt;/p&gt;

&lt;p&gt;Check out the &lt;a href=&quot;https://github.com/artsy/force/pull/5370&quot;&gt;pull request&lt;/a&gt; for the nitty gritty on how
we leveraged CircleCI branch filtering and more Bash to move this workload into
CircleCI and intelligently determine when to update or create a review app.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Impact&lt;/strong&gt;: Any developer can spin up a Force review app in ~15 minutes on a &lt;code&gt;git push&lt;/code&gt;.
Review app are being used often for major and minor changes alike.&lt;/p&gt;

&lt;a name=&quot;Future.Iterations&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Future Iterations&lt;/h2&gt;

&lt;p&gt;Artsy has come far with its tooling for review applications, but, as always,
there&#39;s areas for us for to grow in, including:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Automating the de-provisioning of review apps that no
longer useful.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Automating the creation of DNS CNAME records within Cloudflare, removing one
final manual step.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;While the improvements to review app infrastructure has sparked similar
investments in other codebases, there&#39;s a lot of work we could do to bring
this Git-CircleCI-Bash based approach to other shared services we deploy at
Artsy.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;a name=&quot;On.Incremental.Improvement&quot;&gt;&lt;/a&gt;
&lt;h2&gt;On Incremental Improvement&lt;/h2&gt;

&lt;p&gt;One of Artsy&#39;s Engineering Principles is &lt;a href=&quot;https://github.com/artsy/README/blob/master/culture/engineering-principles.md#incremental-revolution&quot;&gt;&quot;Incremental
Revolution&quot;&lt;/a&gt;, which begins with:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Introduce new technologies slowly and incrementally.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think Artsy&#39;s approach to review apps is a great example of this principle
implemented.&lt;/p&gt;

&lt;p&gt;As opposed to finding a silver bullet technology or strategy, our approach has
been to build off of a working current state, layering on a new component to
solve the next problem.&lt;/p&gt;

&lt;p&gt;At each point along our solution journey, we&#39;re left with a working and more valuable
solution to the problem at hand.&lt;/p&gt;

&lt;p&gt;Thanks for reading!&lt;/p&gt;
</description>
        <pubDate>Thu, 20 Aug 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/08/20/review-apps-post/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/08/20/review-apps-post/</guid>
        
        
        <category>communication</category>
        
        <category>devops</category>
        
        <category>hokusai</category>
        
        <category>kubernetes</category>
        
      </item>
    
      <item>
        <title>Improve Pull Requests By Including Valuable Context</title>
        <description>&lt;p&gt;Code review is an engineering process that has benefited greatly from a move toward asynchronous communication.
Long ago, engineering teams would sit in a room with code on a projector to review changes together. ðŸ˜± For many
teams this led to batching code reviews or even skipping them altogether. ðŸ˜±ðŸ˜±&lt;/p&gt;

&lt;p&gt;Today, most engineering teams use incredible tools like GitHub or GitLab to review changes through Pull Requests
(PRs). The greatest advantage of PRs is that the review can happen when it&#39;s convenient for the reviewer:
asynchronously. Asynchronous communication isn&#39;t all sunshine and unicorns, though. Notably, it lacks the ability
to course-correct when context is misunderstood.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;When you&#39;re in a synchronous conversation with someone, it doesn&#39;t take much time for them to let you know you&#39;ve
forgotten to include context. Their brow furrows. They look confused. You notice this and quickly add the missing
context to keep the conversation moving forward. It takes a lot longer to identify missing context when
communicating asynchronously. The non-verbal cues are missing.&lt;/p&gt;

&lt;p&gt;Worse, lack of context when &lt;em&gt;reviewing code&lt;/em&gt; asynchronously has a reverb effect. I create my PR when it&#39;s
convenient for me, you ask a clarifying question when it&#39;s convenient for you, I respond when it&#39;s convenient for
me, etc. Suddenly my PR has been open for three days and we haven&#39;t yet made it to a common understanding of why
I&#39;ve made these changes.&lt;/p&gt;

&lt;p&gt;It&#39;s extremely important to include all available context when drafting a PR. It saves incredible amounts of time
by cutting out slow round-trip conversations to clarify.&lt;/p&gt;

&lt;p&gt;I&#39;m personally proud of and impressed by the job we do at Artsy in including context in our PRs. We start early, by
giving our engineers
&lt;a href=&quot;https://github.com/artsy/README/blob/master/playbooks/engineer-workflow.md#pull-requests&quot;&gt;some reading about how we work with PRs during their onboarding&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;But beyond that our engineers lead by example. This article presents a handful of examples from Artsy repositories
demonstrating how you can add context to your PRs to avoid unnecessary clarifying conversation.&lt;/p&gt;

&lt;a name=&quot;Explain.Your.Reasoning&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Explain Your Reasoning&lt;/h2&gt;

&lt;p&gt;You&#39;ve been thinking a lot about the problem you&#39;re solving - probably significantly more than your reviewers.
You&#39;ll save everyone time by describing the problem and sharing how you&#39;re thinking about it.&lt;/p&gt;

&lt;a name=&quot;Define.the.problem.and.solution&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Define the problem and solution&lt;/h3&gt;

&lt;p&gt;Why does this PR exist? Explain the problem it solves and describe your solution, as
&lt;a href=&quot;https://github.com/sweir27&quot;&gt;Sarah&lt;/a&gt; does &lt;a href=&quot;https://github.com/artsy/force/pull/3095&quot;&gt;in this PR&lt;/a&gt;. For bonus points,
include alternative approaches you considered.&lt;/p&gt;

&lt;p&gt;As you are writing up the problem and solution, you might find that you&#39;ve missed on the scope of your PR. Are
there &lt;em&gt;many&lt;/em&gt; problems this PR is solving? Maybe this should be broken into smaller PRs. Is it hard to describe the
problem because it requires multiple other PRs? Maybe those should be consolidated into one cohesive set of
changes.&lt;/p&gt;

&lt;a name=&quot;Explain.interesting.lines.of.code&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Explain interesting lines of code&lt;/h3&gt;

&lt;p&gt;The reviewers aren&#39;t the only ones who can comment on lines of code.
&lt;a href=&quot;https://github.com/artsy/emission/pull/2085#discussion_r378228269&quot;&gt;Give them&lt;/a&gt; some
&lt;a href=&quot;https://github.com/artsy/emission/pull/2085#discussion_r378230196&quot;&gt;additional information&lt;/a&gt; about
&lt;a href=&quot;https://github.com/artsy/emission/pull/2085#discussion_r378231974&quot;&gt;why a particular line was written&lt;/a&gt;, as
&lt;a href=&quot;https://github.com/ds300&quot;&gt;David&lt;/a&gt; does &lt;a href=&quot;https://github.com/artsy/emission/pull/2085&quot;&gt;in this PR&lt;/a&gt;. Maybe you want
feedback focused on that line or maybe the line has side-effects and implications that aren&#39;t obvious.&lt;/p&gt;

&lt;a name=&quot;Give.a.guided.tour.of.the.changes&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Give a guided tour of the changes&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/dblandin&quot;&gt;Devon&lt;/a&gt; takes the idea of adding context to individual lines to the next level
&lt;a href=&quot;https://github.com/artsy/reaction/pull/2774#pullrequestreview-288095754&quot;&gt;in this PR&lt;/a&gt;. He takes advantage of
markdown to give us a virtual tour of the changes, at each stop providing helpful information and a link to the
next change. It&#39;s like he&#39;s sitting next to you!&lt;/p&gt;

&lt;a name=&quot;Show.Your.Work&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Show Your Work&lt;/h2&gt;

&lt;p&gt;If your PR contains work that is beyond trivial, show your reviewers how you thought about the problem. Demonstrate
the effects of the changes. Give them confidence that you&#39;ve worked through this problem thoroughly, and you&#39;ve
brought receipts.&lt;/p&gt;

&lt;a name=&quot;Make.small..self-contained.commits&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Make small, self-contained commits&lt;/h3&gt;

&lt;p&gt;A good PR starts with good commits. Good commits are small, self-contained, and leave the codebase always in a
working state. With good commits, reviewers can see exactly how you worked through the problem you were solving.
&lt;a href=&quot;https://github.com/artsy/convection/pull/645&quot;&gt;Here&#39;s a PR&lt;/a&gt; from &lt;a href=&quot;https://github.com/jonallured&quot;&gt;Jon&lt;/a&gt; that
demonstrates the use of small, self-contained commits to describe his approach to refactoring code before fixing a
bug.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Bonus tip&lt;/em&gt;: it can be easier to review PRs with many small commits via the
&lt;a href=&quot;https://github.com/artsy/convection/pull/645/commits&quot;&gt;&lt;em&gt;Commits&lt;/em&gt;&lt;/a&gt; tab instead of the
&lt;a href=&quot;https://github.com/artsy/convection/pull/645/files&quot;&gt;&lt;em&gt;Files changed&lt;/em&gt;&lt;/a&gt; tab.&lt;/p&gt;

&lt;a name=&quot;Demonstrate.the.results&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Demonstrate the results&lt;/h3&gt;

&lt;p&gt;Pictures are a worth a thousand words. Animated gifs are worth a thousand pictures (uhhhh, in file size too ðŸ˜¬). An
animated gif showing the outcome of your PR gives reviewers a demo, and confidence that you&#39;ve verified your
changes.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/artsy/force/pull/5817&quot;&gt;Here&#39;s a PR&lt;/a&gt; from &lt;a href=&quot;https://github.com/ashleyjelks&quot;&gt;Ashley&lt;/a&gt; that includes
animated gifs of the changes she&#39;s made. The effects of the changes might not be obvious by looking only at the
code, but seeing them in action makes it clear.&lt;/p&gt;

&lt;a name=&quot;Document.the.unseen&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Document the unseen&lt;/h3&gt;

&lt;p&gt;Sometimes a PR&#39;s changes have effects outside of the UI. There are still ways to give reviewers proof that the
changes have the desired effects.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/artsy/eigen/pull/3206&quot;&gt;Here&#39;s a PR&lt;/a&gt; from &lt;a href=&quot;https://github.com/yuki24&quot;&gt;Yuki&lt;/a&gt; that not only
demonstrates what&#39;s happening in the UI, but also assures me that the back-end data is getting updated properly
through a Rails console.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/xtina-starr&quot;&gt;Christina&lt;/a&gt; authored &lt;a href=&quot;https://github.com/artsy/reaction/pull/3441&quot;&gt;this PR&lt;/a&gt; which
shows the UI changes in addition to some output from her browser console, demonstrating that analytics tracking
calls are firing correctly.&lt;/p&gt;

&lt;a name=&quot;Share.your.progress&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Share your progress&lt;/h3&gt;

&lt;p&gt;One mistake many engineers make with non-trivial pull requests is to wait to open them until they&#39;re &quot;done&quot;. If
there are changes you&#39;d like to get people&#39;s eyes on quickly, open a WIP PR before the work is done: mark it as a
draft in GitHub, or put &lt;code&gt;WIP&lt;/code&gt; in the title. Extra work up front avoids rework by starting early discussions about
your approach.&lt;/p&gt;

&lt;p&gt;Let reviewers know in the body that your work isn&#39;t complete. As you continue your work, use a &lt;code&gt;TODO:&lt;/code&gt; list in the
body to illustrate your progress, as in &lt;a href=&quot;https://github.com/artsy/palette/pull/464&quot;&gt;this PR&lt;/a&gt; from
&lt;a href=&quot;https://github.com/sepans&quot;&gt;Sepand&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Is this PR part of a larger scope of work? Is there followup work that will need to be done after it&#39;s merged? Are
there PRs in other systems that need to merge in a specific sequence? Any migration details or timing that should
be known before merging? Call these details out to avoid another round-trip conversation.&lt;/p&gt;

&lt;a name=&quot;Spread.knowledge&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Spread knowledge&lt;/h2&gt;

&lt;p&gt;Pull requests should not be one-sided - they aren&#39;t just about collecting feedback from the reviewer. They&#39;re also
an opportunity to spread knowledge from the author.&lt;/p&gt;

&lt;a name=&quot;Share.your.learnings&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Share your learnings&lt;/h3&gt;

&lt;p&gt;Maybe you learned some things about the system you&#39;re working with, or you learned a new feature of the language.
Share this new information with your team. &lt;a href=&quot;https://github.com/anandaroop&quot;&gt;Roop&lt;/a&gt; shares some findings about
disabled tests &lt;a href=&quot;https://github.com/artsy/metaphysics/pull/2130&quot;&gt;in this PR&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We introduced a new state management library shortly before &lt;a href=&quot;https://github.com/pepopowitz&quot;&gt;I&lt;/a&gt; opened
&lt;a href=&quot;https://github.com/artsy/eigen/pull/3526&quot;&gt;this PR&lt;/a&gt;, and I had to do some reading about how to add types to
something. I &lt;a href=&quot;https://github.com/artsy/eigen/pull/3526#discussion_r451161406&quot;&gt;shared my learnings with the team&lt;/a&gt;.&lt;/p&gt;

&lt;a name=&quot;Share.development.tips&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Share development tips&lt;/h3&gt;

&lt;p&gt;Did you learn a new technique while building this feature? Share it with your team!&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://github.com/artsy/reaction/pull/3279#discussion_r395461329&quot;&gt;this PR&lt;/a&gt;,
&lt;a href=&quot;https://github.com/damassi&quot;&gt;Chris&lt;/a&gt; shared with us his technique for grabbing fixture data from his locally running
environment.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;When your team embraces the pull request process, you reap rewards that extend far beyond the lines of code.
Providing context up-front shortens the feedback loop and surfaces important discussions sooner, allowing you to
ship changes more quickly. Sharing knowledge in PRs grows individuals and spreads expertise across your team. Every
PR becomes an artifact for retracing history. You can look back and see not only &lt;em&gt;which&lt;/em&gt; decisions were made, but
&lt;em&gt;why&lt;/em&gt; they were made.&lt;/p&gt;

&lt;p&gt;If you&#39;d like to know more about how we work with pull requests at Artsy, take a look at our
&lt;a href=&quot;https://github.com/artsy/README/blob/master/playbooks/engineer-workflow.md#pull-requests&quot;&gt;&quot;Engineer workflow&quot; playbook&lt;/a&gt;,
or poke around &lt;a href=&quot;https://github.com/artsy&quot;&gt;our GitHub repositories&lt;/a&gt;. Check out
&lt;a href=&quot;https://github.com/artsy/artsy.github.io/pull/619&quot;&gt;the PR that created this article&lt;/a&gt;. And if you&#39;ve got examples
of great PRs to share with the rest of us, leave a comment!&lt;/p&gt;
</description>
        <pubDate>Tue, 11 Aug 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/08/11/improve-pull-requests-by-including-valuable-context/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/08/11/improve-pull-requests-by-including-valuable-context/</guid>
        
        
        <category>community</category>
        
        <category>engineering</category>
        
        <category>github</category>
        
        <category>team</category>
        
        <category>tools</category>
        
      </item>
    
      <item>
        <title>From engineering to product management, and back again</title>
        <description>&lt;p&gt;A year and a half ago I decided to become a product manager after 5 years as a software engineer. This past June,
however, I decided to switch back into engineering.&lt;/p&gt;

&lt;p&gt;What happened, and what did I learn?&lt;/p&gt;

&lt;!-- more --&gt;


&lt;a name=&quot;Why.I.became.a.product.manager&quot;&gt;&lt;/a&gt;
&lt;h1&gt;Why I became a product manager&lt;/h1&gt;

&lt;p&gt;When I started at Artsy, I hadn&#39;t planned on becoming a product manager. As I onboarded and worked on projects like
building Artsy&#39;s ecommerce backend &lt;a href=&quot;https://www.github.com/artsy/exchange&quot;&gt;Exchange&lt;/a&gt;, I found myself wanting to be
involved in the &quot;what&quot; and &quot;why&quot; of our product and not just the &quot;how.&quot; &lt;a href=&quot;https://willdoenlen.com&quot;&gt;I&#39;m an artist&lt;/a&gt;,
and so art and the art market are special topics for me. I felt like I would have more impact as a product manager,
and I definitely wanted to have greater impact on the art world.&lt;/p&gt;

&lt;p&gt;My previous job had me doing a blend of product management and engineering work, and so I had already had a taste
of PMing. I spoke with our VP of Product at the time and she agreed to let me try it out. And just like that, in
January 2019 I became the product manager for the Auctions team.&lt;/p&gt;

&lt;a name=&quot;Becoming.a.product.manager&quot;&gt;&lt;/a&gt;
&lt;h1&gt;Becoming a product manager&lt;/h1&gt;

&lt;p&gt;Product management is a surprisingly difficult job to define. Everyone agrees on one thing: product managers lead
the product development process. However, what product development actually entails differs from company to company
because of differences in resources, culture and priorities. In practice, product managers may find themselves
doing a lot of things that on the surface have nothing to do with product development.&lt;/p&gt;

&lt;p&gt;Product management can be distilled down into two tasks:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Ensuring that the right feature / product is being built for your users, and&lt;/li&gt;
&lt;li&gt;Doing whatever it takes to make (1) happen.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;A product manager&#39;s sole job is to do whatever it takes to make sure your users are getting the right product.
That&#39;ll almost certainly involve talking to users to understand their needs, analyzing product usage data and
working with your team and stakeholders to create the next great feature, but there&#39;s nothing in those two tasks
that says you need to do any of that. You can do this job any way you&#39;d like as long as you get results. If I knew
that I could have built a better product for my users by pogo sticking across the Brooklyn Bridge then you would
have found me out there pogo sticking all day, every day.&lt;/p&gt;

&lt;p&gt;All that to say, the job is highly ambiguous by design. &lt;strong&gt;Any problem could be your problem&lt;/strong&gt;, and it&#39;s up to you
to judge whether or not that&#39;s the best use of your time for your users.&lt;/p&gt;

&lt;a name=&quot;Redefining.work&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Redefining work&lt;/h2&gt;

&lt;p&gt;Compared to engineering, this ambiguity was a huge shift for me. As an engineer, my thinking was previously limited
to our systems and our codebase, and I largely thought about &lt;em&gt;how&lt;/em&gt; to use them to build products. The &quot;how&quot; was now
largely abstracted away from me. It took me a long time to get out of that mindset, largely because I was
uncomfortable with how ambiguous PMing was.&lt;/p&gt;

&lt;p&gt;There are a few reasons why the ambiguity was uncomfortable. The first was that the actual output of a product
manager didn&#39;t &lt;em&gt;feel&lt;/em&gt; like work. As an engineer, you can write code and instantly see the results of your work.
There&#39;s a clear pipeline of progress, from initial commit to opening a pull request and deploying your code.&lt;/p&gt;

&lt;p&gt;As a product manager, though, your output is much more amorphous. You might spend your time reading up on user
feedback, or you might make docs or comment on other docs. You might spend your whole day in meetings talking about
the same thing over and over again with different groups of people. You might get interrupted repeatedly throughout
the day with questions and problems. Days would fly by and I would have no idea what I did even though I was busy
all day. I just couldn&#39;t get that feeling of progress.&lt;/p&gt;

&lt;p&gt;I worked through that by keeping a detailed journal. For the first three or four months I recorded what I was doing
every hour of every day. That practice gradually transformed into a more manageable daily journal as I got used to
the work style. No one ever saw those notes -- it was just so I could keep track of what I was doing, what I was
thinking about and feel some accomplishment by writing things down. It helped bridge the gap, and it&#39;s a practice I
still maintain.&lt;/p&gt;

&lt;p&gt;Another thing that helped me with the &quot;feeling&quot; of work was reading the perspectives of other managers. Andrew
Grove&#39;s &lt;em&gt;High Output Management&lt;/em&gt; was especially useful. Somewhere along the line I read the phrase &quot;the meeting
&lt;em&gt;is&lt;/em&gt; the work,&quot; and it clicked for me. A core output of my job was to communicate with others (more on that later).
As an engineer, it&#39;s counterintuitive. The more time you spend in a meeting, the less time you spend writing code.
Product managers need quiet thinking time too, but a significant portion of the job is working with others.
Meetings are how the work gets done. That framing helped me feel more productive.&lt;/p&gt;

&lt;p&gt;Compounding the problem of not knowing what work &quot;felt&quot; like was not really even knowing what my work was. Here&#39;s a
great journal entry from my second or third week as a PM:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What I donâ€™t have clarity on:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Am I taking on too much for the first quarter?&lt;/li&gt;
&lt;li&gt;How do I narrow down the work that I want to do next?&lt;/li&gt;
&lt;li&gt;How do I organize everything?&lt;/li&gt;
&lt;li&gt;What am I supposed to be doing?&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;It felt as existential as it looked!&lt;/p&gt;

&lt;p&gt;Before I understood that part of my job was to systemtically remove any and every roadblock getting in the way of
shipping a great product, I tended to focus my energies solely on going through the product development cycle. I
could prioritize and propose a feature, but if something wasn&#39;t possible it just wasn&#39;t possible. As my
understanding evolved, though, I began to see that a lot of what wasn&#39;t possible actually &lt;em&gt;was&lt;/em&gt; possible. It just
depended on me creating change.&lt;/p&gt;

&lt;p&gt;Knowing that felt both enormously empowering and terrifying. If I was unclear before on what my job was, I felt
even less clear now that any problem could be my problem. But I got used to it, and over time and with coaching
from my manager I was able to suss out what not only &lt;em&gt;could&lt;/em&gt; be my problem but what &lt;em&gt;should&lt;/em&gt; be my problem. There
are some things nobody can change, but there&#39;s a surprising amount a single person can do. In the end, I think this
expansive view of work is the right framing for not only product management but really any job.&lt;/p&gt;

&lt;a name=&quot;From.data.paralyzed.to.data.informed&quot;&gt;&lt;/a&gt;
&lt;h2&gt;From data paralyzed to data informed&lt;/h2&gt;

&lt;p&gt;I studied a hard science in school and have always valued rigorous, quantitative reasoning. That kind of reasoning
is valuable in science and engineering, but when faced with the fuzzy world of business it can only take you so
far. The data you might want to make a decision frequently doesn&#39;t exist, and even if you can get it you probably
don&#39;t have the time to get it. I found myself initially in loops of analysis paralysis, struggling to find a
rigorous justification for why we should build what we were building.&lt;/p&gt;

&lt;p&gt;I found my way out of that loop by focusing on finding the best possible &lt;em&gt;outcome&lt;/em&gt;. Instead of getting caught up
trying to maximize my quantitative understanding of an opportunity, I focused on getting just enough information to
understand the relative upside and downside profiles of the opportunities in front of me. I used a rule of thumb
that 70% confidence is usually good enough to make a call. I didn&#39;t always know what the exact impact of a feature
would be, but I knew enough to know that whatever we were doing had the highest impact out of anything on the
table. That allowed me to make decisions with confidence.&lt;/p&gt;

&lt;p&gt;With that frame of mind, my quantitative skills turned into a huge asset instead of a hindrance. I feel confident
navigating Artsy&#39;s database and running my own SQL queries, which helped me work alongside our Data team to analyze
performance and potential impact for a new feature. And when that work was impossible, I was able to take the data
we had and still make an informed decision with it.&lt;/p&gt;

&lt;a name=&quot;Learning.to.focus.on.users&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Learning to focus on users&lt;/h2&gt;

&lt;p&gt;That style of thinking didn&#39;t just extend to &lt;em&gt;why&lt;/em&gt; we should build a feature, but also &lt;em&gt;what&lt;/em&gt; we should build. When
considering a feature, I found myself jumping immediately to how the feature would work on a systems level rather
than what the user experience should be. That was a double-edged sword. While it made discussions with the
engineers on my team seamless, I sometimes would rule out features in my head because I knew they &quot;weren&#39;t
possible.&quot; Of course, that did an injustice to both our users and the engineers on my team. Our users deserve the
best experience on Artsy, even if it feels impossible to me. And the engineers on my team could really find a
creative solution for just about anything I threw at them.&lt;/p&gt;

&lt;p&gt;Similar to my data paralysis, part of the problem here was that creating a great user experience was fuzzy for me,
and I subconsciously rejected fuzzy things because they didn&#39;t align with my version of rigorous knowledge. It was
easier for me think about systems than it was to think about creating a truly delightful user experience, and so I
thought about systems.&lt;/p&gt;

&lt;p&gt;That changed as I really dug into user needs. I cultivated user empathy to an entirely new level by immersing
myself in user feedback and user research. I began to really &lt;em&gt;feel&lt;/em&gt; that the choices we made impacted the
livelihoods and passions of collectors, institutions and artists. And that helped snap me out of it: our users
needed a better product, not better systems, and so I began to focus much more on how to make a better product.&lt;/p&gt;

&lt;p&gt;To understand how to build a better product, I spent a lot of time examining other products to understand what made
them compelling. How did a product meet users&#39; needs? How did it delight them? Where did it fall short? What would
I do to improve it? Doing this over and over again sharpened my product sense and made it easier to think through
how we could build a better experience for Artsy&#39;s users.&lt;/p&gt;

&lt;a name=&quot;Influence.and.communication&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Influence and communication&lt;/h2&gt;

&lt;p&gt;Influence is the currency of product managers. Good product managers work to expand their influence within an
organization so that they can quickly mobilize the organization towards the right goals. Since product managers
don&#39;t make anything themselves, a product manager that nobody listens to simply can&#39;t be effective.&lt;/p&gt;

&lt;p&gt;The interpersonal skills I had built up and practiced as a software engineer didn&#39;t directly translate to the
skills I needed to build influence. As a baseline, engineering communication requires precision and clarity of
thought. Since you&#39;re typically talking with other engineers, you have shared language and set of tools to help get
your point across. For example, if you can&#39;t succinctly express your idea in words you can just write that thought
out in code and other engineers will get it.&lt;/p&gt;

&lt;p&gt;Product managers work with a lot of different kinds of people: engineers, designers, marketers, sales people,
operations, executives, users, enterprise customers, vendors... the list goes on and on. Each person has a
different perspective, both from their organizational role and their own life experiences. You have to meet them
wherever they are, so your communication style needs to be highly adaptive.&lt;/p&gt;

&lt;p&gt;Good communication feels seamless but is typically accompanied by a lot of planning and foresight. There was a lot
I needed to learn to be an effective communicator and, in turn, an effective leader. How to write a good document,
how to run a meeting, how to craft a compelling story, how to be just the right amount of direct, how to be just
the right amount of concise... and, as a fairly verbal person how to draw good diagrams and pictures to communicate
my ideas. There&#39;s no shortcut to improving these skills. Getting better is a matter of practice and feedback.&lt;/p&gt;

&lt;a name=&quot;Learning.to.say.no&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Learning to say no&lt;/h2&gt;

&lt;p&gt;One of the most difficult things for me to learn was how and when to say &quot;no.&quot; As an engineer, I prided myself on
having a can-do attitude and making seemingly impossible things happen. As a product manager, though, I have to
make sure that we&#39;re always building the right thing for our users. Since my job is to make sure we&#39;re doing that,
I usually have conviction that we&#39;re currently doing the right thing. That means that, on average, when someone
requests product resources or proposes a new feature, I have to say no.&lt;/p&gt;

&lt;p&gt;I like to be helpful, and so I was terrible at saying no at first. I wanted to help anyone and everyone who came to
me because, like when I was an engineer, I wanted solve everyone&#39;s problems. But as I focused more and more on user
needs, it became clear what we should be working on to have the best impact on our users. That gave me the
conviction I needed to start saying no.&lt;/p&gt;

&lt;p&gt;That still didn&#39;t make it easier to &lt;em&gt;say&lt;/em&gt; no. Prioritization decisions can have a big impact on other teams, and
it&#39;s hard to see your coworkers feel disappointed when something they want won&#39;t be prioritized. Learning how to
say no kindly and empathetically is an art form. But in general, it&#39;s best done by clearly communicating priorities
and correctly setting expectations in the first place so that people don&#39;t come with requests that won&#39;t get
fulfilled. Doing that involves educating your coworkers on how the product prioritization process works,
socializing your product roadmap and spending lots of time to answer questions. It also may involve looping
stakeholders into the prioritization process so that their voices are clearly heard and they feel ownership over
the roadmap. It&#39;s much easier to get things done when everyone is in alignment from the beginning.&lt;/p&gt;

&lt;a name=&quot;Coming.back.to.engineering&quot;&gt;&lt;/a&gt;
&lt;h1&gt;Coming back to engineering&lt;/h1&gt;

&lt;p&gt;After the first six months of working as a product manager I felt like I had gained my &quot;product legs.&quot; I had
launched some successful features, had weathered major organizational change and had a clear idea of what our users
needed and what the future ought to look like. Over the next year I continued to hone my skills and expand my scope
as a product manager. Overall, things were going well.&lt;/p&gt;

&lt;p&gt;I never stopped coding, though. I did small projects here and there, both inside and outside of work, but I never
really had the time to do anything big. After a year of being out of engineering I started to get an itch to build
and do technical work. I even had a few dreams where I was coding! I have dreams about all sorts of weird things
and don&#39;t dwell on them, but something about my surreal dream edition of Visual Studio Code stuck with me.&lt;/p&gt;

&lt;p&gt;I reflected on this more and looked through my personal journal to remember my prior experiences as an engineer,
when I&#39;ve felt happy and why I wanted to transition into product management. One thing I realized is that, as an
engineer, I didn&#39;t always feel empowered. I felt like my role was just to code. But having worked as a product
manager, I knew that it didn&#39;t have to be that way. I worked with engineers who had solid product skillsets and saw
how empowering and useful it could be. Being actively involved in coding and defining the right user experience
felt exciting to me.&lt;/p&gt;

&lt;p&gt;I also reflected on what kind of work I wanted to have and how I wanted to spend my time. In general, my favorite
days at work have been when I do a blend of people / business work and creative technical work. I enjoyed the
strategic and people-focused work of product management but I missed making things and technical problem solving.
While I did get to exercise technical thinking as a product manager it was rarely a good use of my time to go deep.
I realized I could achive that balance better as an empowered engineer rather than as a product manager.&lt;/p&gt;

&lt;p&gt;After a lot of thought, I decided that my longer term career direction made more sense as an engineering leader
rather than as a product leader. Fortunately, Artsy&#39;s leadership agreed to let me transition back into engineering,
and at the beginning of June I was re-minted as a software engineer.&lt;/p&gt;

&lt;a name=&quot;Onboarding.the.second.time&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Onboarding the second time&lt;/h2&gt;

&lt;p&gt;At this point, I&#39;m six weeks back into engineering and my experience feels very different than before. I&#39;ve spent
most of my time ramping up and onboarding for the second time. Relearning our stack has been both a humbling and
rewarding experience. I&#39;ve forgotten a lot of the details of the frameworks we use, but this time instead of racing
to get through tickets I&#39;ve decided to really slow down and take the time to read the docs and do tutorials to make
sure I fully understand what&#39;s going on. While it comes at the expense of speed in the short-term, it&#39;ll make me a
stronger engineer down the road, and I know that tradeoff is worth it. I also can&#39;t speak highly enough of my
fellow engineers, who have been incredibly supportive while I learn.&lt;/p&gt;

&lt;a name=&quot;Provide.value..not.code&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Provide value, not code&lt;/h2&gt;

&lt;p&gt;I&#39;ve also found my perspective is very different than before. While previously I would have seen my role as writing
great code, now I see my role as leveraging technology to provide value to users. What&#39;s the difference? In the
former, I&#39;m doing a &lt;em&gt;task&lt;/em&gt; while in the latter I&#39;m driving &lt;em&gt;outcomes&lt;/em&gt;. It feels much more empowering as a mental
model for what I should do as an engineer. It&#39;s also helped me shed any hint of perfectionism I had before since
writing &quot;perfect&quot; code or building the &quot;perfect&quot; system usually isn&#39;t relevant to providing value to our users.&lt;/p&gt;

&lt;a name=&quot;Developer.experience.is.a.product&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Developer experience is a product&lt;/h2&gt;

&lt;p&gt;Working as a product manager really taught me the value of engineering, which is frequently the bottleneck in
delivering value to your users. Creating the right strategy and vision for a product is critical work, but none of
that work matters if you can&#39;t quickly get it to market. The faster you can move the more quickly you can create
the ideal product your users want, which in turn dictates how successful your product will be. Gains in engineering
efficiency snowball into massive benefits for users over time.&lt;/p&gt;

&lt;p&gt;That&#39;s led me to start seeing our developer experience as part of our product. It&#39;s much more than just our
toolchain -- it&#39;s the end-to-end cycle of working with a designer and product manager to understand product
requirements to building the feature to shipping it and monitoring in production. What does the ideal process look
like? Where are our bottlenecks? What investments will result in the best outcome for our users? These are
questions I&#39;m asking myself as I ramp up, and I&#39;m excited to dig into this more.&lt;/p&gt;

&lt;a name=&quot;Should.you.be.a.product.manager.&quot;&gt;&lt;/a&gt;
&lt;h1&gt;Should you be a product manager?&lt;/h1&gt;

&lt;p&gt;If you&#39;re an engineer wondering whether to make the jump to product management, my advice is to try it out. Product
management and engineering are complementary skillsets that build off of each other. Knowing how to do one role
absolutely helps with the other. You may find that you love being a product manager and continue on that track, or
you may discover instead that you love being an engineer empowered with a product skillset. In either case, it&#39;ll
turn out great.&lt;/p&gt;
</description>
        <pubDate>Thu, 23 Jul 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/07/23/from-engineering-to-product-management-and-back-again/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/07/23/from-engineering-to-product-management-and-back-again/</guid>
        
        
        <category>culture</category>
        
        <category>engineering</category>
        
        <category>people</category>
        
        <category>product management</category>
        
      </item>
    
      <item>
        <title>Team Working Agreements</title>
        <description>&lt;p&gt;Good team culture strives for cohesion. Once organizations get large enough, a tension emerges between the culture
of individual teams and the culture of the larger organization. How do you achieve team cohesion across small teams
&lt;em&gt;and&lt;/em&gt; the larger organizations they comprise?&lt;/p&gt;

&lt;p&gt;The culture at Artsy is driven by every team member, not mandated or handed down from above. This adds another
level of tension, between individuals and their smaller teams. Team working agreements embrace that tension to
provide a framework for converting tension into healthy culture.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;Artsy Engineering is part of a larger organization we call PDDE (Product, Design, Data, and Engineering). PDDE is
divided into several product teams, and each team contains at least one representative from product, design, data,
and engineering. Each PDDE team delivers product solutions targeted to a specific product need.&lt;/p&gt;

&lt;p&gt;Until recently, those teams could expect a significant change in team members at the start of every quarter, as we
encouraged engineers to explore other teams. The purpose of this practice was to spread knowledge throughout the
organization, and give folks the opportunity to keep themselves aligned with projects they found most interesting.&lt;/p&gt;

&lt;p&gt;The downside of this practice was that it made teams feel short-lived, impermanent, and unstable. Some teams were
hit harder than others - they&#39;d see their team completely turn over every quarter. This was felt most strongly by
our product managers who would take the time to learn the skills and strengths of each engineer on their team over
the course of a quarter, just to have to start the process all over again, making it difficult to plan projects or
set goals for the following quarter.&lt;/p&gt;

&lt;p&gt;To address these challenges, PDDE decided to set the expectation that engineers would stay on the same team each
quarter, with the option to request a team change, when necessary, to fill a skill, capacity, or growth need
elsewhere. This effectively ended the practice of shuffling teams every quarter. It was too much change, too often.&lt;/p&gt;

&lt;p&gt;As a result, our teams feel more stable and long-lived. We&#39;re able to build deeper team identity. We&#39;ve found one
tool particularly helpful in finding and building team identity: team working agreements.&lt;/p&gt;

&lt;a name=&quot;How.did.team.working.agreements.come.about.at.Artsy.&quot;&gt;&lt;/a&gt;
&lt;h2&gt;How did team working agreements come about at Artsy?&lt;/h2&gt;

&lt;p&gt;The current breakdown of our PDDE organization is relatively new; it&#39;s also an on-going process. We are still
feeling out how these teams will/should work together. One of the core beliefs at Artsy is that when you are a part
of something - a process, a team, a culture - you are empowered to make impactful changes to it.&lt;/p&gt;

&lt;p&gt;&lt;aside class=&quot;dialogue&quot;&gt;
  &lt;div class=&quot;answer&quot;&gt;
    &lt;img src=&quot;/images/dialogue/adam.jpg&quot;&gt;
    &lt;p class=&quot;intro&quot;&gt;Adam Iskounen says...&lt;/p&gt;
    &lt;p&gt;
      Team cohesion and unity was a common theme that kept surfacing during the retrospective meeting that led to
      PDDE ending the quarterly shuffling of teams. During my onboarding, I noticed in retros that teams were
      strong on &quot;what went well&quot; and light on &quot;what could be improved.&quot; We&#39;d have 1 or 2 &quot;didn&#39;t go well&quot; tickets,
      but they were usually something light-hearted/benign like &quot;team lunch was cancelled&quot;. One team in particular
      seemed like they were dancing around each other a bit, and important things like &quot;not getting stuff done&quot;
      wasn&#39;t being brought up.
    &lt;/p&gt;
    &lt;p&gt;I remembered that team working agreements were a tool used by
      a scrum master at my previous job to help a particular team that was struggling to gel, and brought it up
      without really knowing what was involved in the process. Fortunately my product manager - who was eager to
      form a team where each member felt empowered and excited to take ownership of our work - encouraged me to
      research and share the process for coming up with a team working agreement. At first I was nervous that some
      team members, especially those who I perceived to be more interested in technical challenges than on team-building,
      would not be interested in this and find that it was a waste of time. I was pleasantly surprised that not only did
      everyone on the team participate, but that those team members ended up being some of the more enthusiastic
      proponents for following-up on the team working agreement after our initial brainstorm.
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/aside&gt;&lt;/p&gt;

&lt;p&gt;Since being pioneered by Adam&#39;s team, team working agreements have spread to most of our engineering teams. They&#39;ve
been a learning opportunity for all of us, and a chance for our team members to share experiences and practices
with each other.&lt;/p&gt;

&lt;a name=&quot;What.s.a.team.working.agreement.&quot;&gt;&lt;/a&gt;
&lt;h2&gt;What&#39;s a team working agreement?&lt;/h2&gt;

&lt;p&gt;A team working agreement is a written set of guidelines for an engineering team. It enumerates the habits and
practices that the team requires to be productive and successful. The agreement is a living document, and every
member of the team has a part in shaping it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Tuckman%27s_stages_of_group_development&quot;&gt;According to Bruce Tuckman, a team moves through four phases of development: forming, storming, norming, and performing&lt;/a&gt;.
Team working agreements can help a team move more quickly through the stages. A team in the &quot;forming&quot; stage will
quickly uncover areas of disagreement and move to &quot;storming&quot; when they attempt to align on a working agreement. A
&quot;storming&quot; team might move to &quot;norming&quot; more quickly when their points of friction are arbitrated in a working
agreement.&lt;/p&gt;

&lt;p&gt;Examples of habits or practices on a team working agreement might include:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Any change to the sprint backlog requires product manager approval.&lt;/li&gt;
&lt;li&gt;Everyone owns the backlog and should add tickets for untracked work.&lt;/li&gt;
&lt;li&gt;Update the backlog before each dayâ€™s standup.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We&#39;ve been using a fairly consistent process to develop team working agreements at Artsy.&lt;/p&gt;

&lt;a name=&quot;Step.1:.Educate.the.team.about.team.working.agreements&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Step 1: Educate the team about team working agreements&lt;/h3&gt;

&lt;p&gt;We want every team member to recognize the importance of creating an agreement.&lt;/p&gt;

&lt;p&gt;Each team reviews
&lt;a href=&quot;https://github.com/artsy/README/blob/master/playbooks/agile/team-working-agreement.md&quot;&gt;our docs on the process of creating a working agreement&lt;/a&gt;
before creating one. They might also review an existing working agreement.&lt;/p&gt;

&lt;a name=&quot;Step.2:.Conduct.a.brainstorming.meeting&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Step 2: Conduct a brainstorming meeting&lt;/h3&gt;

&lt;p&gt;The team meets for an hour to brainstorm ideas that promote success from each individual or the team as a whole.
Some of our teams have met fully in-person and used physical sticky notes for brainstorming; many have used an
online tool like &lt;a href=&quot;https://miro.com/&quot;&gt;Miro&lt;/a&gt; to include remote members.&lt;/p&gt;

&lt;p&gt;It&#39;s vital that &lt;em&gt;all&lt;/em&gt; members of the team attend the brainstorm. For us, that includes engineers and product
managers, but also designers and data analysts. This is a discussion of how the entire team works together -
everyone&#39;s voice should be heard.&lt;/p&gt;

&lt;p&gt;A sample brainstorm agenda is
&lt;a href=&quot;https://github.com/artsy/README/blob/master/playbooks/agile/team-working-agreement.md#sample-meeting-agenda&quot;&gt;shared in our docs&lt;/a&gt;.
The output of the brainstorm is a set of ideas that everyone has contributed to.&lt;/p&gt;

&lt;a name=&quot;Step.3:.Distill.brainstorming.ideas.into.discrete..digestible.habits&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Step 3: Distill brainstorming ideas into discrete, digestible habits&lt;/h3&gt;

&lt;p&gt;The ideas from the brainstorming process can be sorted into themes. Within themes, we work to condense ideas into
habits and practices that are agreeable to the entire team. We have found success in keeping the language for these
habits small, discrete, and slogan-like.&lt;/p&gt;

&lt;p&gt;The distillation step might take several round-trips of gathering feedback and wordsmith-ing.&lt;/p&gt;

&lt;a name=&quot;Step.4:.Commit.the.most.important.habits.to.a..Team.Working.Agreement..document&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Step 4: Commit the most important habits to a &quot;Team Working Agreement&quot; document&lt;/h3&gt;

&lt;p&gt;The team votes on which habits should be included in the agreement and a document is circulated.&lt;/p&gt;

&lt;p&gt;It&#39;s not done, though. Remember: it&#39;s a living document.&lt;/p&gt;

&lt;a name=&quot;Step.5:.Revisit.the.working.agreement&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Step 5: Revisit the working agreement&lt;/h3&gt;

&lt;p&gt;As a team, decide how often the agreement should be revisited, and what &quot;revisiting the agreement&quot; means. When
should we amend it? When should we do another brainstorm? It probably doesn&#39;t make sense to scrap the old agreement
when one new team member joins, but how much change on a team would inspire us to recreate our agreement?&lt;/p&gt;

&lt;a name=&quot;Why.establish.a.team.working.agreement.&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Why establish a team working agreement?&lt;/h2&gt;

&lt;a name=&quot;The.brainstorm.itself.is.incredibly.valuable.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;The brainstorm itself is incredibly valuable.&lt;/h3&gt;

&lt;p&gt;Dedicated time to talk about values, habits, and processes is incredibly helpful to a team, yet rarely scheduled.
The brainstorm for a team working agreement can fill this void.&lt;/p&gt;

&lt;p&gt;During the team agreement brainstorm the team looks at &lt;em&gt;how&lt;/em&gt; they work, instead of looking at &lt;em&gt;what&lt;/em&gt; work they&#39;re
doing. It&#39;s similar to what you might get out of a retro but at a higher level. It offers time to discuss &quot;soft&quot;
skills that you don&#39;t often discuss, in a context that you don&#39;t usually discuss them - with other individual
contributors, and with your closest collaborators.&lt;/p&gt;

&lt;p&gt;&lt;aside class=&quot;dialogue&quot;&gt;
  &lt;div class=&quot;answer&quot;&gt;
    &lt;img src=&quot;/images/dialogue/steve.jpg&quot;&gt;
    &lt;p class=&quot;intro&quot;&gt;Steve Hicks says...&lt;/p&gt;
    &lt;p&gt;
      When joining a new team, there&#39;s often a period of &quot;feeling it out&quot; - where I&#39;m afraid to verbalize an
      opinion because I&#39;m not sure how the team feels about it. The team working agreement process has definitely
      helped lessen this feeling.
    &lt;/p&gt;
    &lt;p&gt;
      There&#39;s a &lt;a href=&quot;https://www.youtube.com/watch?v=FxTXf6qyaGk&quot;&gt;great talk by Katherine Wu named &quot;Ask vs Guess Culture&quot;&lt;/a&gt;.
      &quot;Guess&quot; culture is when you try to guess what a person wants or is thinking; &quot;Ask&quot; culture is when you flat out
      ask them. Team agreement brainstorms are a really neat way to &lt;em&gt;ask&lt;/em&gt; your team how they want to work, instead of
      spending many sprints trying to guess.
    &lt;/p&gt;
    &lt;p&gt;
      So far, I have seen the most value out of &lt;em&gt;the actual brainstorm&lt;/em&gt; than the working agreement itself. My teams
      have learned so much about each others&#39; habits and values.
    &lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&quot;answer&quot;&gt;
    &lt;img src=&quot;/images/dialogue/adam.jpg&quot;&gt;
    &lt;p class=&quot;intro&quot;&gt;Adam Iskounen says...&lt;/p&gt;
    &lt;p&gt;
      The process has helped confirm that the team shared interest in team dynamics &amp;amp; the process of collaboration
      across the team. As a new member it&#39;s nice to know that information.
    &lt;/p&gt;
    &lt;p&gt;
      It&#39;s been great to see teammates bring up the team agreement in different contexts. It wasn&#39;t just a one-hour
      brainstorm, it&#39;s something our team is living. Hearing our slogan-like habits recited during team meetings
      long after the brainstorm is a testament to the value of the agreement.
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/aside&gt;&lt;/p&gt;

&lt;a name=&quot;It.can.lead.to.better.engagement.in.sprint.activities.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;It can lead to better engagement in sprint activities.&lt;/h3&gt;

&lt;p&gt;One of our teams established in their working agreement that sprint meetings were valuable. This might seem too
obvious to put in a team working agreement, but it portrays clearly to everyone that they should attend all sprint
meetings and be actively engaged.&lt;/p&gt;

&lt;p&gt;The same team got a lot out of making slogans for the items in their working agreement. Phrases like &quot;Pair by
default&quot; and &quot;Incremental improvement over consistency&quot; were introduced during the brainstorm. They&#39;ve since become
mantras for the team to refer to during sprint work and ceremonies. Team values and habits solidify through this
kind of repetition.&lt;/p&gt;

&lt;a name=&quot;The.team.working.agreement.provides.on-boarding.documentation.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;The team working agreement provides on-boarding documentation.&lt;/h3&gt;

&lt;p&gt;When new members join a team, it takes time for them to adjust. A team working agreement provides an up-to-date
reference on the team&#39;s preferred methods of working. The working agreement isn&#39;t set in stone, and as the team
changes it&#39;s important to update it... but having it in writing helps new members acclimate quickly.&lt;/p&gt;

&lt;a name=&quot;What.are.some.challenges.with.team.working.agreements.&quot;&gt;&lt;/a&gt;
&lt;h2&gt;What are some challenges with team working agreements?&lt;/h2&gt;

&lt;a name=&quot;Uncertainty.about.what.the.team.agreement.should.include.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Uncertainty about what the team agreement should include.&lt;/h3&gt;

&lt;p&gt;Some teams have struggled to identify what belongs on a team working agreement. Should it describe our team values?
Habits? Procedures? Rules? Favorite afternoon snacks?&lt;/p&gt;

&lt;p&gt;It likely varies from team to team what you want here. Some teams might require guidance around working with JIRA;
others might be more focused on taking ownership of problems. These differences are likely a reflection of the
problems the team is currently facing or has recently faced.&lt;/p&gt;

&lt;p&gt;It&#39;s definitely important that you identify what you&#39;re looking for up front, and make it clear heading into the
brainstorm. Suggest categories, sample habits, &amp;amp; questions to ask heading into the brainstorm, and keep them
visible during the meeting.&lt;/p&gt;

&lt;p&gt;Take notice of known problem areas: are they addressed or avoided in the agreement? It is easy for a team to avoid
confrontation at their own expense.&lt;/p&gt;

&lt;p&gt;Also be cautious about introducing individual bias.&lt;/p&gt;

&lt;p&gt;&lt;aside class=&quot;dialogue&quot;&gt;
  &lt;div class=&quot;answer&quot;&gt;
    &lt;img src=&quot;/images/dialogue/steve.jpg&quot;&gt;
    &lt;p class=&quot;intro&quot;&gt;Steve Hicks says...&lt;/p&gt;
    &lt;p&gt;
      During my first team agreement brainstorm, I felt like we spent a lot of time talking about details
      related to specific incidents. On my next team, I made a strong effort to constrain the suggestions
      to avoid this. To me, team values were really important for this new team - and I did such a good
      job of encouraging those types of suggestions that it&#39;s pretty much all we ended up with.
    &lt;/p&gt;
    &lt;p&gt;
      As a result, our initial working agreement lacked important procedural and tactical definition. We&#39;ve
      been adding things like JIRA hygiene and responsibilities of project leaders as they come up, but I would
      not push a working agreement brainstorm so strongly in one direction again.
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/aside&gt;&lt;/p&gt;

&lt;p&gt;Remember that the working agreement is a living document. If the team learns that it missed something in the
brainstorm, don&#39;t hesitate to update the agreement. Team retros are a great time to make updates.&lt;/p&gt;

&lt;a name=&quot;Working.agreements.are.hard.to.define.for.teams.without.a.well-established.identity.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Working agreements are hard to define for teams without a well-established identity.&lt;/h3&gt;

&lt;p&gt;For a team that has a strong and cohesive identity, the agreement is likely to affirm many things the team is
already believing and doing. For a less cohesive team the agreement is harder to pin down. Many opinions will
surface, and they may be in conflict with each other.&lt;/p&gt;

&lt;p&gt;While this is indeed challenging, it is also important to note that teams that lack identity benefit &lt;em&gt;greatly&lt;/em&gt; from
the team agreement brainstorm. Provided there is
&lt;a href=&quot;https://github.com/artsy/README/blob/master/culture/engineering-principles.md#psychological-safety&quot;&gt;psychological safety&lt;/a&gt;,
this is a really great time for the team to learn about what matters to each other, and move toward establishing an
identity.&lt;/p&gt;

&lt;a name=&quot;Facilitating.the.brainstorm.can.be.difficult.on.a.distributed.team.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Facilitating the brainstorm can be difficult on a distributed team.&lt;/h3&gt;

&lt;p&gt;Some of our teams were able to brainstorm with everyone on-site. They were able to rely on post-it notes and
in-person conversations, and read each other&#39;s non-verbal communication. Other teams have a mix of on-site and
remote members, and used tools like &lt;a href=&quot;http://miro.com/&quot;&gt;Miro&lt;/a&gt; to facilitate. This &lt;em&gt;can&lt;/em&gt; present a challenge...but if
you&#39;re already a distributed team, they are likely the same types of challenges you&#39;ve worked to overcome for &lt;em&gt;all&lt;/em&gt;
meetings.&lt;/p&gt;

&lt;p&gt;The differences are worth noting, though. The importance of reading each other&#39;s non-verbal communication is
magnified when you&#39;re having conversations about identity. It&#39;s quicker to organize and re-organize real-life
post-its than virtual post-its in an online tool. These are all opportunities to get better at being a distributed
team.&lt;/p&gt;

&lt;a name=&quot;It.takes.effort.to.make.sure.one.person.isn.t.introducing.their.bias.into.the.working.agreement.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;It takes effort to make sure one person isn&#39;t introducing their bias into the working agreement.&lt;/h3&gt;

&lt;p&gt;It&#39;s important for the team agreement brainstorm to provide an environment in which every team member is heard.
Even if your team is successful at this, there are still opportunities for individual bias to affect the working
agreement.&lt;/p&gt;

&lt;p&gt;We saw earlier how bias can appear when the examples provided for the brainstorm are too narrowly scoped.&lt;/p&gt;

&lt;p&gt;We recognized another bias vector in the distillation of the brainstorm into an actual agreement. If this is
handled by a single person, it&#39;s very possible for them to produce a working agreement that misrepresents &lt;em&gt;the
rest&lt;/em&gt; of the team. To counter this, we&#39;ve had multiple team members pair on the distillation process. Feedback on
the initial draft of the agreement is also important to ensure it does not misrepresent the team&#39;s ideas.&lt;/p&gt;

&lt;p&gt;The problem of introducing bias to the distillation process is most challenging with topics that are disputed
across the team. One of our teams spent a lot of time talking about meetings in their brainstorm, but struggled to
come to consensus on them. No single person, or even a pair, could add a disputed topic like this to the working
agreement without introducing their personal bias. In this specific case, the team chose to leave meetings off the
working agreement until they could reach consensus. Topics that are disputed across the team are important to talk
about at &lt;em&gt;some&lt;/em&gt; point, but the brainstorm is probably not the time.&lt;/p&gt;

&lt;a name=&quot;Team.health.is.easy.to.postpone.when.you.have.important.product.work.to.do.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;Team health is easy to postpone when you have important product work to do.&lt;/h3&gt;

&lt;p&gt;One of our teams put the act of distilling the brainstorm notes into an agreement on one person. That person became
busier than expected, didn&#39;t have time to write the agreement, and the team&#39;s agreement stalled.&lt;/p&gt;

&lt;p&gt;Just as personal self-care gets put on the back burner during stressful times, creating a working agreement is easy
to bump down the backlog during intense periods of sprint work. The longer a team drags out the working agreement
process, the more context is lost from the original brainstorm. We recommend not letting your working agreement
linger.&lt;/p&gt;

&lt;p&gt;It&#39;s also important to revisit the working agreement often. It is a living document, not one-and-done. Review the
agreement as a team occasionally; update the agreement as your team learns how to collaborate better; cultivate the
agreement. If an agreement gets stale, it will become inaccurate, meaningless, and unused.&lt;/p&gt;

&lt;a name=&quot;What.does.it.even.mean.to.have.a.team.working.agreement.&quot;&gt;&lt;/a&gt;
&lt;h3&gt;What does it even mean to have a team working agreement?&lt;/h3&gt;

&lt;p&gt;A team working agreement is a neat artifact. The brainstorm process has great value. But there is non-obvious work
involved in turning a team working agreement into the team culture. We have many questions that we aren&#39;t sure how
to answer:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;How do you enforce the agreement?&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Should&lt;/em&gt; you enforce the agreement?&lt;/li&gt;
&lt;li&gt;How do you get the entire team to embrace it?&lt;/li&gt;
&lt;li&gt;What happens when the agreement is violated or disrespected?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If you&#39;re using working agreements on your team and you&#39;ve got answers for us, or you want to start using them and
have more questions, we&#39;d love to hear from you!&lt;/p&gt;
</description>
        <pubDate>Wed, 01 Apr 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/04/01/team-working-agreements/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/04/01/team-working-agreements/</guid>
        
        
        <category>culture</category>
        
        <category>people</category>
        
        <category>process</category>
        
        <category>team</category>
        
      </item>
    
      <item>
        <title>iOS Deploys: Super Weird And Totally Normal</title>
        <description>&lt;p&gt;Software deploys! What a concept. You have some code running somewhere, and you need to get it running somewhere
else. What could possibly go wrong? While web developers have become accustom to some &lt;em&gt;really slick&lt;/em&gt; deploy
processes, iOS developers have to work within some very different constraints.&lt;/p&gt;

&lt;p&gt;Today I want to explore the differences between deploying iOS software and front-end/back-end web software. Some of
these differences are inherent to how the code gets executed, and some of the differences are incidental to choices
that Apple has made. These are constraints that iOS developers need to work within. As Artsy has adopted React
Native over the past four years, we have had more and more of our web engineering colleagues contributing to our
iOS app. For these web engineers, getting familiar with the iOS deploy constraints is as important as getting to
know Xcode and CocoaPods.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;a name=&quot;A.Release.Case.Study&quot;&gt;&lt;/a&gt;
&lt;h2&gt;A Release Case Study&lt;/h2&gt;

&lt;p&gt;We&#39;re going to use a case study to frame today&#39;s discussion. Artsy&#39;s Mobile Experience team recently got a ticket
from our Platform team. The nature of the ticket itself doesn&#39;t matter, but it involved a change we were making to
our API. I fixed the bug and submitted a pull request, which quickly got merged. We tested the bug fix in our next
beta deploy, and everything looked fine. Great so far.&lt;/p&gt;

&lt;p&gt;Artsy releases iOS software on a two-week release cadence, and this bug fix was scheduled to be released to users
the following week. But our back-end team wanted to quickly deploy that API change, which would require the app bug
fix to get released to users &lt;em&gt;first&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;So... what to do?&lt;/p&gt;

&lt;p&gt;Do we release off-cadence? Or do we push back on our Platform team and ask them to hold off until the scheduled
release?&lt;/p&gt;

&lt;p&gt;Let&#39;s actually pause for a moment and consider one of the assumptions we made above. If you&#39;re a web engineer, the
idea of releasing only every two weeks might seem pretty strange! I mean, why not release continuously? For
example, Artsy&#39;s website gets deployed to our staging environment after every merged pull request, and staging then
gets promoted to production several times a day. This process is generally referred to as &quot;continuous delivery&quot;,
and &lt;a href=&quot;https://www.thoughtworks.com/insights/blog/case-continuous-delivery&quot;&gt;it has a lot of advantages&lt;/a&gt;. That&#39;s why
it&#39;s so common among web engineering teams. So why not use continuous delivery on iOS apps?&lt;/p&gt;

&lt;a name=&quot;The.Executable.Problem&quot;&gt;&lt;/a&gt;
&lt;h2&gt;The Executable Problem&lt;/h2&gt;

&lt;p&gt;There are two reasons we can&#39;t use continuous delivery on iOS. First, continuous delivery is only really possible
when you control where the software gets executed (or, in the case of web front-ends, where the client-side code
gets served from). Artsy controls our own servers, so we can deliver web software continuously. The next time a
user makes a web request, they&#39;ll get the updated code. However, the Artsy iOS app runs on our users&#39; devices,
instead. We can&#39;t push out updates to users&#39; iPhones or iPads in the same way we can push updates to our servers.&lt;/p&gt;

&lt;p&gt;iOS apps are binary executables that are distributed through Apple&#39;s App Store, and updates to apps have to be
pulled down by devices. Even if &lt;em&gt;most&lt;/em&gt; users have automatic updates turned on, those updates are typically
installed overnight. Consequently, there&#39;s quite a lag between when we deploy an iOS update and when users run the
code. While it only takes about a week for 80% of our users to update to the latest version, there&#39;s a very long
tail after that.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2020-03-02-ios-deploys-super-weird-totally-normal/graph.png&quot; alt=&quot;Graph of in-use versions of Artsy&#39;s app, illustrating both the quick adoption of new updates by most users and the long tail of old versions that are never updated&quot; /&gt;&lt;/p&gt;

&lt;p&gt;iOS software is executed in an environment that we don&#39;t control, that we can&#39;t push updates to, and most
importantly, that we can&#39;t roll back deploys on. If we ship a version of our app with a bug, but then ship an
updated version with a fix right away, there is absolutely no guarantee that users will install that update.
&lt;em&gt;Ever&lt;/em&gt;. That means that &lt;em&gt;every&lt;/em&gt; deploy we make to our iOS software requires a lot of confidence in that code. In
contrast, rolling back a web deploy is quite painless. If we ship a bug to the web, no problem: just roll back the
deploy, fix the bug, and re-deploy with the fix.&lt;/p&gt;

&lt;p&gt;(Note: some readers might be wondering why we don&#39;t take advantage of over-the-air updates to our React Native
JavaScript bundle. This is definitely possible, but our app is brownfield with some native code and some React
Native code and we haven&#39;t yet built out the infrastructure for this. As more and more code shifts to React Native,
we plan to investigate OTA updates to JavaScript bundles.)&lt;/p&gt;

&lt;a name=&quot;Apple.s.Platform..Apple.s.Rules&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Apple&#39;s Platform, Apple&#39;s Rules&lt;/h2&gt;

&lt;p&gt;The second reason to deploy iOS software on a schedule, rather than with continuous delivery, depends on the App
Store review process. This is another big difference that takes web engineers a while to get used to. Whenever we
ship a version of our iOS app, we ship it to Apple for review, and then Apple ships it to our users. I&#39;m not going
to debate the utility of Apple as an intermediary â€“ the fact is that they own the iOS platform and these are the
rules they have chosen. If you want to ship iOS software, then you have to abide by Apple&#39;s rules.&lt;/p&gt;

&lt;p&gt;App Store review isn&#39;t exactly QA. I mean, if we were to ship an app update and it crashes upon launch, Apple isn&#39;t
likely to approve that update. But if we have a small bug buried somewhere in the app, we can&#39;t expect Apple to
find it. Apple is only testing for adherence to their
&lt;a href=&quot;https://developer.apple.com/app-store/review/guidelines/&quot;&gt;App Store Review Guidelines&lt;/a&gt;. Apple is looking for
things like: is the app trying to steal user data? Is the app displaying objectionable material, given its age
rating? Is the app&#39;s description and App Store metadata correct? That kind of stuff.&lt;/p&gt;

&lt;p&gt;So not only do iOS software developers need a lot of confidence in every deploy, but they also need to abide by
Apple&#39;s guidelines.&lt;/p&gt;

&lt;p&gt;Alright. Let&#39;s return to the case study from earlier.&lt;/p&gt;

&lt;a name=&quot;Case.Study.Resolution&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Case Study Resolution&lt;/h2&gt;

&lt;p&gt;We had a bug fix in our app, and getting it deployed was blocking an important change to our back-end API. First,
we had to consider that some users simply wouldn&#39;t get the update. We had to ask ourselves if this would block the
back-end change entirely â€“ through open discussions with the team, we decided to move forward. Second, we had to
consider the other work that had been merged since our last release. Were we confident in deploying that work
as-is? And what amount of QA would need to be done to ship those changes as well?&lt;/p&gt;

&lt;p&gt;That last point is really interesting because there was actually another option. Rather than deploy the app based
off the current &lt;code&gt;master&lt;/code&gt; branch (with the bug fix &lt;em&gt;and&lt;/em&gt; other work included), we did something a bit clever.
&lt;a href=&quot;https://fastlane.tools&quot;&gt;fastlane&lt;/a&gt;, the tool we use to automate our iOS deploys, will tag each commit that we
submit to the App Store. So rather than deploy the current &lt;code&gt;master&lt;/code&gt; branch, which would require very rigorous QA,
we checked out the previous release tag. We then used
&lt;a href=&quot;https://www.atlassian.com/git/tutorials/cherry-pick&quot;&gt;&lt;code&gt;git cherry-pick&lt;/code&gt;&lt;/a&gt; to apply &lt;em&gt;only&lt;/em&gt; the bug fix changes, and
deployed from there.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2020-03-02-ios-deploys-super-weird-totally-normal/slack.png&quot; alt=&quot;Screenshot from Slack where I detailed my plan to cherry-pick the commits&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This isolated the changes we were making to the app and minimized the amount of QA we needed to feel confident in
our release. Even still, we ran through our usual QA script. As I hope I&#39;ve demonstrated above, it&#39;s always better
to be safe than be sorry when it comes to deploying iOS software.&lt;/p&gt;

&lt;p&gt;This &lt;code&gt;git cherry-pick&lt;/code&gt; approach has its own trade-offs, but it is very effective in the right circumstance. It&#39;s an
approach I&#39;ve only had to use a few times during my time at Artsy, but it&#39;s a good approach to be familiar with.
This situation also highlights a benefit of automating iOS deploys: we know &lt;em&gt;exactly&lt;/em&gt; which commit each version of
our app is running, making it easy to &lt;code&gt;git cherry-pick&lt;/code&gt; with confidence.&lt;/p&gt;

&lt;p&gt;I hope I&#39;ve illustrated how iOS software is a bit different from web software, both inherently and incidentally.
Many of these same quirks apply to Android deploys as well. Mobile software feels closer to software sold in
shrink-wrapped boxes than it does to Docker images shipped to Kubernetes clusters. And that&#39;s okay. Different
platforms will always have different constraints. Hopefully by understanding these constraints, mobile and web
engineers can gain a greater empathy for one another and, ideally, share ideas and solutions so we can all learn
and grown together.&lt;/p&gt;
</description>
        <pubDate>Mon, 02 Mar 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/03/02/ios-deploys-super-weird-totally-normal/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/03/02/ios-deploys-super-weird-totally-normal/</guid>
        
        
        <category>continuous deployment</category>
        
        <category>deployment</category>
        
        <category>fastlane</category>
        
        <category>ios</category>
        
      </item>
    
      <item>
        <title>Deploying canaries with auto</title>
        <description>&lt;p&gt;Coordinating changes across many packages in the node ecosystem can be quite the challenge. You can use &lt;code&gt;npm link&lt;/code&gt;
or &lt;code&gt;yarn link&lt;/code&gt; to create a symlink of the package you&#39;re developing on into another package, but it
&lt;a href=&quot;https://github.com/yarnpkg/yarn/issues/1761#issuecomment-259706202&quot;&gt;has some drawbacks&lt;/a&gt;. If you&#39;re doing local
development and need to rapidly see updates and &lt;code&gt;yarn link&lt;/code&gt; isn&#39;t working out there&#39;s always tools like
&lt;a href=&quot;https://github.com/whitecolor/yalc#yalc&quot;&gt;yalc&lt;/a&gt; to help you out. That&#39;s really only for local development though.&lt;/p&gt;

&lt;p&gt;What if you need to test packages together in a staging environment? Generally the approach would to be to deploy a
&lt;a href=&quot;https://martinfowler.com/bliki/CanaryRelease.html&quot;&gt;canary&lt;/a&gt; version to npm that you can use in your staging
environment. I&#39;ll go over how to do that and how Artsy automates it.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;Publishing a canary isn&#39;t necessarily very hard. It&#39;s just a regular publish to npm with a few more steps.&lt;/p&gt;

&lt;p&gt;For example, if we were wanting to publish a canary version of &lt;code&gt;@artsy/reaction&lt;/code&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Update &lt;code&gt;package.json&lt;/code&gt;, set version to a canary version, e.g. &lt;code&gt;2.0.0-canary-&amp;lt;PR#&amp;gt;&lt;/code&gt;, &lt;code&gt;3.1.5-canary-&amp;lt;PR#&amp;gt;&lt;/code&gt;, ...&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;npm publish --tag canary&lt;/code&gt; in &lt;code&gt;reaction&lt;/code&gt; to publish the package under the canary tag&lt;/li&gt;
&lt;li&gt;Run &lt;code&gt;yarn add @artsy/reaction@canary&lt;/code&gt; to install canary package in the consuming system&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;em&gt;Tip: Running &lt;code&gt;npm dist-tag ls&lt;/code&gt; can be helpful to see what tagged packages are available&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;For a lot of people, that&#39;d be enough. End blog post. Here at Artsy, we like things to be a little more
frictionless.&lt;/p&gt;

&lt;p&gt;We&#39;re already big fans of &lt;a href=&quot;https://github.com/intuit/auto&quot;&gt;Auto&lt;/a&gt;, Intuit&#39;s tool for automatically deploying
releases on PR merges. Orta wrote an awesome blog post on how we
&lt;a href=&quot;https://artsy.github.io/blog/2019/01/03/label-based-prs/&quot;&gt;migrated to auto&lt;/a&gt; from semantic-release a while back.&lt;/p&gt;

&lt;p&gt;As a short recap, &lt;code&gt;Auto&lt;/code&gt; makes the deployable units of a package be a PR instead of a commit. It uses labels like
&lt;code&gt;Version: Major&lt;/code&gt;, &lt;code&gt;Version: Minor&lt;/code&gt;, etc to determine how the PR will affect the package version. When a PR is
merged it&#39;ll automatically cut a released based on that label.&lt;/p&gt;

&lt;p&gt;As a testament to how awesome &lt;code&gt;Auto&lt;/code&gt; is, it already supports
&lt;a href=&quot;https://intuit.github.io/auto/pages/generated/canary.html&quot;&gt;canary deployments&lt;/a&gt; out of the box!&lt;/p&gt;

&lt;p&gt;Essentially when we&#39;re on a branch that isn&#39;t master our CI runs this command:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;&#39;&gt;&lt;span class=&#39;line&#39;&gt;auto canary&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;and auto takes care of publishing a canary version to NPM &lt;em&gt;and&lt;/em&gt; updating the PR description with the version and
instructions on how to use it.&lt;/p&gt;

&lt;p&gt;You can &lt;a href=&quot;https://github.com/artsy/reaction/pull/3168&quot;&gt;check out the PR&lt;/a&gt; where I enabled it on reaction to see it in
action. The CI configuration itself is layered behind some
&lt;a href=&quot;https://circleci.com/docs/2.0/orb-intro/&quot;&gt;CircleCI Orb&lt;/a&gt;s. You can find all that configuration in
&lt;a href=&quot;https://github.com/artsy/orbs&quot;&gt;artsy/orbs&lt;/a&gt; if you&#39;re curious.&lt;/p&gt;

&lt;p&gt;Ultimately the culmination of this work means that every PR to a library at Artsy gets a canary. It&#39;s incredibly
simple to test changes in another system now.&lt;/p&gt;

&lt;p&gt;There is, however, one caveat. Being as canaries are being deployed to NPM, they need our NPM token. We can&#39;t just
share that with everyone, so this functionality doesn&#39;t work on forks. Given how CircleCI works, this includes
forks from folks who even have write access to the repository. We&#39;re thinking about how to solve that problem but
that&#39;ll be another blog post for another day.&lt;/p&gt;
</description>
        <pubDate>Thu, 20 Feb 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/02/20/deploying-canaries-with-auto/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/02/20/deploying-canaries-with-auto/</guid>
        
        
        <category>node</category>
        
        <category>npm</category>
        
        <category>packages</category>
        
        <category>road and bridges</category>
        
        <category>tools</category>
        
      </item>
    
      <item>
        <title>Effortless Pagination with GraphQL and Relay? Really!</title>
        <description>&lt;p&gt;It&#39;s the year 2020. You use a modern front-end stack of &lt;a href=&quot;https://relay.dev/&quot;&gt;Relay&lt;/a&gt;,
&lt;a href=&quot;https://graphql.org/&quot;&gt;GraphQL&lt;/a&gt;, &lt;a href=&quot;https://reactjs.org/&quot;&gt;React&lt;/a&gt; and &lt;a href=&quot;https://www.typescriptlang.org/&quot;&gt;TypeScript&lt;/a&gt;.
You can build an infinite scroll &#39;feed&#39; type UI totally out of the box with these tools, by mostly putting together
boilerplate (proper &lt;a href=&quot;https://facebook.github.io/relay/graphql/connections.htm#sec-Connection-Types&quot;&gt;connections&lt;/a&gt;,
along with a &lt;a href=&quot;https://relay.dev/docs/en/pagination-container&quot;&gt;pagination container&lt;/a&gt;). You have a design system, and
are rapidly building up a component library. Things are great!&lt;/p&gt;

&lt;p&gt;Then you take a look at the latest design comps for a &#39;browse&#39; type page, and you see that the
&lt;a href=&quot;https://medium.com/simple-human/7-reasons-why-infinite-scrolling-is-probably-a-bad-idea-a0139e13c96b&quot;&gt;controversial&lt;/a&gt;
infinite scroll has been replaced by a more traditional pagination bar.&lt;/p&gt;

&lt;p&gt;You know the one. Like the following, from &lt;a href=&quot;https://www.amazon.com&quot;&gt;Amazon&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2020-01-21-graphql-relay-windowed-pagination/amazon.png&quot;&gt;&lt;/p&gt;

&lt;p&gt;You start to realize that the cursor-based setup of a connection, along with a Relay pagination container, does not
lend itself to this more traditional UI. For one thing, a user can arbitrarily &#39;jump&#39; to any page by including a
&lt;code&gt;?page=X&lt;/code&gt; query param (typically). For another, the user can only actually see the current page of content, versus
a feed. As you go to sleep and dream of REST, Rails controllers, &lt;a href=&quot;https://github.com/kaminari/kaminari&quot;&gt;kaminari&lt;/a&gt;,
&lt;a href=&quot;https://github.com/mislav/will_paginate&quot;&gt;will_paginate&lt;/a&gt;, and a simpler time, you start to have a vision...&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;To get a good primer of what a GraphQL connection is and why they&#39;re so useful, read this
&lt;a href=&quot;https://blog.apollographql.com/explaining-graphql-connections-c48b7c3d6976&quot;&gt;excellent Apollo blogpost&lt;/a&gt;. Seriously.
It&#39;s one of the best writeups on this subject out there. I&#39;ll assume basic familiarity with connection types from
this point forward.&lt;/p&gt;

&lt;p&gt;We prefer to use connections in place of lists almost always. Not only do they provide a preferred cursor-based
pagination API for clients, but their type specification (a map vs a list) is naturally forward-looking. Even if
you do no pagination, a pure list type can&#39;t accomodate returning other metadata (such as a &lt;code&gt;totalCount&lt;/code&gt;) alongside
the list. Additionally, if your data is very relational and better represented as nodes connected by edges (which
would contain data about the &#39;join&#39; of the two nodes), the connection type gives one more flexibility than a simple
list. This (and more) is all covered in the aforementioned blog post.&lt;/p&gt;

&lt;p&gt;So, let&#39;s start by taking a look at our desired pagination UI, and think about what kind of schema/components make
sense.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2020-01-21-graphql-relay-windowed-pagination/pagination.png&quot;&gt;&lt;/p&gt;

&lt;p&gt;There looks to be several types of appearances we want to show, based on the total size of our list and fixed page
size chosen, as well as the current page. There&#39;s also some edge cases of empty lists, or lists that are short
enough to just display all their page numbers. Users can click on any displayed page number to jump to it. There&#39;s
a prev/next navigation, which brings the user forward and back one page at a time. Whenever the current page
changes, the URL should update accordingly. For a responsive implementation, we want to hide the page numbers, and
only show the prev/next toggles on small screens.&lt;/p&gt;

&lt;p&gt;Wow! Ok, we have our work cut out for us. But wait til you see how easy this is! There&#39;ll be links to our actual
production components involved (all open-source) at the end.&lt;/p&gt;

&lt;a name=&quot;Pagination.Schema&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Pagination Schema&lt;/h2&gt;

&lt;p&gt;Let&#39;s tackle the first part of this, which is: how do we adapt the
&lt;a href=&quot;https://facebook.github.io/relay/graphql/connections.htm&quot;&gt;GraphQL connection spec&lt;/a&gt; in order to hold necessary
information that a UI might need? Generally we want the UI&#39;s to be as simple as possible, and so if the server
could construct a suitable pagination schema, that would be preferable. The simpler our UI, and the more business
logic and good abstractions made in our GraphQL server, the more portable and reusable this all becomes.&lt;/p&gt;

&lt;p&gt;What kind of data does the UI need, in order to render a particular page of contents? Well, for a particular page
we&#39;d need to render the actual number it corresponds to. We&#39;ll need to know if this is the current page or not (so
we can distinguish it in the UI from neighboring pages). And, we&#39;ll need to know the actual cursor (think:
&lt;a href=&quot;https://relay.dev/graphql/connections.htm&quot;&gt;opaque string&lt;/a&gt;) that corresponds to this page number. It seems likely
we&#39;ll need some sort of way to construct cursors from page numbers, on the server.&lt;/p&gt;

&lt;p&gt;So, check this out:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;c1&quot;&gt;// SDL&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PageCursor&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;pageNumber&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;isCurrent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Boolean&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PageCursors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PageCursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;around&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PageCursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PageCursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PageCursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This is our pagination schema. Including a field of type &lt;code&gt;pageCursors&lt;/code&gt; as a connection-level field, onto a
connection, is sufficient for a UI to incredibly simply &#39;just render&#39; a correct pagination bar always, and be able
to hook up proper interactions. We can fully construct a simple UI (using Relay, shown in the next section) that
can present and allow for the interactions desired, for windowed pagination.&lt;/p&gt;

&lt;p&gt;But, of course we&#39;re glossing over the implementation for such a &lt;code&gt;pageCursors&lt;/code&gt; type, so let&#39;s check that out before
looking at how a client might consume this.&lt;/p&gt;

&lt;p&gt;Our backing API&#39;s largely still paginate via offsets, and not cursors. That is, they accept page/size or
size/offset style arguments. We use &lt;a href=&quot;https://github.com/graphql/graphql-relay-js&quot;&gt;graphql-relay-js&lt;/a&gt;, which includes
helpers to make sure types and resolvers are compatible with some Relay expectations. So, we use this library to
generate our cursors, and can convert the cursor to an offset. A page of 4 with a size of 10, returns the elements
numbered 30 - 39 in that list. So a page of 4 (and size of 10), is equivalent to an offset of 29 (and size of 10).
We have:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pageToCursor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This gives us the offset of the last value of the previous page. While our upstream services are all still
paginating using this size/offset method, the &lt;a href=&quot;https://relay.dev/graphql/connections.htm&quot;&gt;GraphQL cursor spec&lt;/a&gt;
prefers opaque cursors to be used on the client. This allows the actual implementation of pagination to change
upstream while clients remain unaffected. Thus if we ever update our upstream pagination arguments/logic/setup, we
could update this schema implementation accordingly, and clients would continue to be functional.&lt;/p&gt;

&lt;p&gt;For inspiration in constructing our &lt;code&gt;first&lt;/code&gt;, &lt;code&gt;last&lt;/code&gt;, and &lt;code&gt;around&lt;/code&gt; groups, we turn to
&lt;a href=&quot;https://www.fngtps.com/&quot;&gt;Fingertips&lt;/a&gt; and their
&lt;a href=&quot;https://github.com/Fingertips/peiji-san/blob/6bd1bc7c152961dcde376a8bcb2ca393b5b45829/lib/peiji_san/view_helper.rb#L87&quot;&gt;pagination library&lt;/a&gt;.
That code goes through the various cases possible (a short list, a long list where the current page is near the
front, middle or end, various degenerate cases, etc.), and returns a proper structure that represents this data. It
can handle all combinations of list sizes, and current position relative to the total size.&lt;/p&gt;

&lt;p&gt;In pseudo-code, it looks like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;emptyList&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;around&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;listIsShort&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;around&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;totalPages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;nearBeginning&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;around&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;totalPages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;nearMiddle&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;middle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;currentPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;currentPage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;currentPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;totalPages&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;nearEnd&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;around&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Our full implementation of that method can be found
&lt;a href=&quot;https://github.com/artsy/metaphysics/blob/205592be7f59970cf80313972ceb95bb1579c31f/src/schema/v2/fields/pagination.ts#L96&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For a real-life example, check out
&lt;a href=&quot;https://metaphysics-staging.artsy.net/v2?query=%7B%0AartworksConnection(first%3A5%2C%20after%3A%20%22YXJyYXljb25uZWN0aW9uOjE0%22)%20%7B%0A%20%20pageInfo%20%7B%0A%20%20%20%20hasNextPage%0A%20%20%20%20endCursor%0A%20%20%7D%0A%20%20pageCursors%7B%0A%20%20%20%20first%20%7B%0A%20%20%20%20%20%20cursor%0A%20%20%20%20%20%20page%0A%20%20%20%20%20%20isCurrent%0A%20%20%20%20%7D%0A%20%20%20%20last%20%7B%0A%20%20%20%20%20%20cursor%0A%20%20%20%20%20%20page%0A%20%20%20%20%20%20isCurrent%0A%20%20%20%20%7D%0A%20%20%20%20around%20%7B%0A%20%20%20%20%20%20cursor%0A%20%20%20%20%20%20page%0A%20%20%20%20%20%20isCurrent%0A%20%20%20%20%7D%0A%20%20%20%20previous%20%7B%0A%20%20%20%20%20%20page%0A%20%20%20%20%20%20cursor%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%7D&quot;&gt;this link, corresponding to a page number of 4&lt;/a&gt;.
You can adjust the arguments to see how the output changes based on where you are in the list. Try putting
different cursor values in! It looks like:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2020-01-21-graphql-relay-windowed-pagination/graphiql.png&quot;&gt;&lt;/p&gt;

&lt;p&gt;Let&#39;s look at a couple of other pieces of data requested here. One of these is a &lt;code&gt;previous&lt;/code&gt; page cursor. This is to
support that action (the prev/next toggles) in the UI. However, we don&#39;t need a custom &lt;code&gt;next&lt;/code&gt; item to support that
behavior. That&#39;s because we tend to use
&lt;a href=&quot;https://facebook.github.io/relay/graphql/connections.htm#sec-Forward-pagination-arguments&quot;&gt;forward-style pagination arguments&lt;/a&gt;
with connections, which means the connection will already return the data needed for that action (remember, you can
implement a scrolling infinite scroll feed that always takes you to the next page right out of the box).
Specifically, the &lt;code&gt;hasNextPage&lt;/code&gt; and &lt;code&gt;endCursor&lt;/code&gt; are those fields from the
&lt;a href=&quot;https://facebook.github.io/relay/graphql/connections.htm#sec-undefined.PageInfo.Fields&quot;&gt;GraphQL &lt;code&gt;pageInfo&lt;/code&gt; object&lt;/a&gt;
which give you that information.&lt;/p&gt;

&lt;a name=&quot;Companion.UI.Component&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Companion UI Component&lt;/h2&gt;

&lt;p&gt;Ok, now that we have a connection and corresponding fields that provide the needed data, let&#39;s take a look at a
simple React component that can render this:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;17&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;18&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;19&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;20&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;21&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;22&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;23&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Page&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pageCursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}})&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/Button&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;c1&quot;&gt;// Show page 1 if `first` is present, and append with dots&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;c1&quot;&gt;// Show everything in `around`&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;c1&quot;&gt;// Show last page if present, and prepend with dots&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;c1&quot;&gt;// Show previous toggle, active if present&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;c1&quot;&gt;// Show next toggle, active if next page exists&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;disabled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Previous&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/Button&amp;gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Page&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pageCursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&amp;gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;around&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Page&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pageCursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Page&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pageCursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&amp;gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&amp;gt;)}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;disabled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hasNextPage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()}&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Next&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/Button&amp;gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;That&#39;s basically it, visually speaking! The data provided by our GraphQL server is sufficient to render what&#39;s
needed. You can see such a UI component in our design system
&lt;a href=&quot;https://github.com/artsy/palette/blob/f882d32c3fdc6e7f81915c2922e3824bd26791e7/packages/palette/src/elements/Pagination/Pagination.tsx&quot;&gt;here&lt;/a&gt;.
It looks very similar to the above code. Of note, is since this is a simple UI component, it is vanilla React. It
is not a Relay component. It requires an &lt;code&gt;onClick&lt;/code&gt; and &lt;code&gt;onNext&lt;/code&gt; to be passed as props.&lt;/p&gt;

&lt;a name=&quot;Relay.Integration.Step.I&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Relay Integration Step I&lt;/h2&gt;

&lt;p&gt;Now, let&#39;s take a look at how we can build a Relay container that will use the above UI component. First, let&#39;s
build a Relay-wrapped component of the above UI component. This is a fragment container, and lists all the fields
needed:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;17&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;18&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;19&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;20&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;21&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;fragment&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Pagination_pageCursors&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PageCursors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;around&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;isCurrent&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;isCurrent&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;isCurrent&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;previous&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;As a fragment container, this doesn&#39;t have the ability to fetch anything by itself. We want to pass in an &lt;code&gt;onClick&lt;/code&gt;
and &lt;code&gt;onNext&lt;/code&gt; prop from a parent, as well as the &lt;code&gt;hasNextPage&lt;/code&gt; and &lt;code&gt;endCursor&lt;/code&gt; data. Check out
&lt;a href=&quot;https://github.com/artsy/reaction/blob/c6d630f8c3213f47c5124f63eda13fbb9d8f497b/src/Components/v2/Pagination.tsx&quot;&gt;this component&lt;/a&gt;
in our library to see how we take that vanilla React component mentioned above, and use the above fragment to make
a Relay fragment container out of it.&lt;/p&gt;

&lt;p&gt;Now, we need to decide what kind of parent container is appropriate, and how this fragment container will be used.&lt;/p&gt;

&lt;a name=&quot;Relay.Integration.Step.II&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Relay Integration Step II&lt;/h2&gt;

&lt;p&gt;This is going to be confusing, but for this step, we use a
&lt;a href=&quot;https://relay.dev/docs/en/refetch-container&quot;&gt;refetch container&lt;/a&gt; in order to present our paginated collection view,
rather than the aptly-named &lt;a href=&quot;https://relay.dev/docs/en/pagination-container&quot;&gt;Relay pagination container&lt;/a&gt;. The
latter is more suited for an infinite scroll feed view (presenting all content already fetched, only adjacent pages
in a particular direction are able to be scrolled to, etc.) vs. the windowed pagination we are trying to
accomplish. The refetch container is a much more natural fit for our use case, despite the naming.&lt;/p&gt;

&lt;p&gt;That fragment looks like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;fragment&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ConnectionResults_query&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Query&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;someConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;after&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$after&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;pageInfo&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;hasNextPage&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;endCursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;pageCursors&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Pagination_pageCursors&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OtherStuffForYourView&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;We include our &lt;code&gt;pageCursors&lt;/code&gt; fragment, as well as the &lt;code&gt;hasNextPage&lt;/code&gt; and &lt;code&gt;endCursor&lt;/code&gt; from the &lt;code&gt;pageInfo&lt;/code&gt; object. We
need to provide the &lt;code&gt;onClick&lt;/code&gt; and &lt;code&gt;onNext&lt;/code&gt; callbacks as well. Since this component will have access to a
&lt;a href=&quot;https://relay.dev/docs/en/refetch-container#refetch&quot;&gt;&lt;code&gt;relay&lt;/code&gt; prop&lt;/a&gt; since it is a refetch container, those look
like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;handleNext&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hasNextPage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;handleClick&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;endCursor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;handleClick&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;relay&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;refetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;after&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cursor&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;cm&quot;&gt;/* Update URL, set state, etc. */&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;The refetch query defined for the container will look like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SomeConnectionQuery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;$first&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$after&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ConnectionResults_query&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;arguments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;first&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$first&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;after&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;$after&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;We&#39;re pretty much done, this is all just Relay boilerplate at this point.&lt;/p&gt;

&lt;p&gt;Putting it all together, our refetch container winds up rendering a fully functional pagination component in one
line:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;js&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Pagination&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;handleClick&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;onNext&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;handleNext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;pageCursors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pageCursors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;That&#39;s it! Any connection can have this pagination functionality added to it very simply. You include the page
cursor schema on the server for that type (we have a
&lt;a href=&quot;https://github.com/artsy/metaphysics/blob/205592be7f59970cf80313972ceb95bb1579c31f/src/schema/v2/fields/pagination.ts#L160&quot;&gt;factory method&lt;/a&gt;
to help us do that automatically for any connection type). Then, following the above steps, you can quickly build a
Relay refetch container that displays and seamlessly paginates any list.&lt;/p&gt;

&lt;p&gt;You can see an example of this in numerous places on the &lt;a href=&quot;https://www.artsy.net&quot;&gt;Artsy&lt;/a&gt; website. Head on over to
our &lt;a href=&quot;https://www.artsy.net/collect&quot;&gt;Artworks browse experience&lt;/a&gt; and have fun filtering and searching/browsing
through all accessible works! The pagination controls and functionality on this page, and others, are built using
the technique described in this post.&lt;/p&gt;

&lt;a name=&quot;Examples&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Examples&lt;/h2&gt;

&lt;p&gt;Since our &lt;a href=&quot;https://github.com/artsy/metaphysics&quot;&gt;GraphQL orchestration layer&lt;/a&gt;, our
&lt;a href=&quot;https://github.com/artsy/palette&quot;&gt;design system&lt;/a&gt; and
&lt;a href=&quot;https://github.com/artsy/reaction&quot;&gt;UI component and app library&lt;/a&gt; are all open source, here&#39;s links to our actual
production implementation of the above:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/artsy/metaphysics/blob/205592be7f59970cf80313972ceb95bb1579c31f/src/schema/v2/fields/pagination.ts&quot;&gt;Pagination schema in GraphQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/artsy/palette/blob/f882d32c3fdc6e7f81915c2922e3824bd26791e7/packages/palette/src/elements/Pagination/Pagination.tsx&quot;&gt;React UI component&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/artsy/reaction/blob/c6d630f8c3213f47c5124f63eda13fbb9d8f497b/src/Components/v2/Pagination.tsx&quot;&gt;Relay FragmentContainer wrapping of the above&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/artsy/reaction/blob/c6d630f8c3213f47c5124f63eda13fbb9d8f497b/src/Apps/Search/Routes/Artists/SearchResultsArtists.tsx&quot;&gt;Relay RefetchContainer full example&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

</description>
        <pubDate>Tue, 21 Jan 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/01/21/graphql-relay-windowed-pagination/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/01/21/graphql-relay-windowed-pagination/</guid>
        
        
        <category>graphql</category>
        
        <category>pagination</category>
        
        <category>relay</category>
        
      </item>
    
      <item>
        <title>At Long Last: A Log Out Button</title>
        <description>&lt;p&gt;In 2013, Artsy shipped the first version of our iOS app. Typical for an early-day startup, the app was a &quot;minimum
viable product&quot; (with a big emphasis on &quot;minimum&quot;). One of the features that didn&#39;t make the cut was something you
expect to see in most apps: a log out button.&lt;/p&gt;

&lt;p&gt;When I joined Artsy a year later, there was still no log out button. And there would be no log out button for
another six years, until today.&lt;/p&gt;

&lt;p&gt;I want to talk about this quirk of our app, from both product and technical perspectives. Why wasn&#39;t this already
in our app? Why was it so difficult to build? These are interesting questions, and their answers shed light on how
products mature over time. I also want to talk about how we finally managed to prioritize this kinda weird feature
request (spoilers: it was our company-wide hackathon). Let&#39;s go!&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;When I say that our app doesn&#39;t have a log out button, that&#39;s a bit of a fib: it &lt;em&gt;does&lt;/em&gt; have a log out button... in
the admin-only debug menu. The reason why this isn&#39;t a user-facing feature is that the final step of this
admin-only log out feature is a call to &lt;code&gt;exit(0)&lt;/code&gt;, effectively crashing the app. That&#39;s &lt;em&gt;one&lt;/em&gt; way to make sure that
user-specific state doesn&#39;t pollute your app&#39;s runtime, but of course it would be ridiculous for a user-facing log
out button to crash the app. The only other way to log out was to uninstall the app, which is &lt;em&gt;not&lt;/em&gt; something we
want to encourage users to do.&lt;/p&gt;

&lt;p&gt;So Artsy staff could log out of the app, but our normal users couldn&#39;t. This quirk was acceptable in the early days
of our app, but as the years wore on, it became less of a quirk and more of a product limitation. Even three months
after creating our new Mobile Experience team, we hadn&#39;t yet prioritized this feature. Let&#39;s
&lt;a href=&quot;https://en.wikipedia.org/wiki/Five_whys&quot;&gt;dive into this question&lt;/a&gt; a little bit.&lt;/p&gt;

&lt;p&gt;The log out button hadn&#39;t been prioritized. &lt;strong&gt;Why?&lt;/strong&gt; To be honest, we had â€“ and still have â€“ a lot of work to do to
improve the app (&lt;a href=&quot;http://artsy.net/jobs&quot;&gt;we&#39;re hiring, by the way&lt;/a&gt;). Among the high-impact work we&#39;ve been
shipping, the log out button simply never made the cut. &lt;strong&gt;Why?&lt;/strong&gt; It turns out be quite complicated to implement a
log out button in our app. &lt;strong&gt;Why?&lt;/strong&gt; To answer that, we need to step back and think about software development and
requirements gathering, generally.&lt;/p&gt;

&lt;p&gt;Experienced software developers will tell you that it&#39;s far, far easier to build a piece of software with a feature
in mind &lt;em&gt;from the start&lt;/em&gt; than it is to take an existing piece of software and add something to it that it was never
intended to do. For our app, logging out was something it was never intended to do, and so adding it was
technically difficult. &lt;strong&gt;Why?&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Because of &lt;a href=&quot;https://softwareengineering.stackexchange.com/questions/148108/why-is-global-state-so-evil&quot;&gt;state&lt;/a&gt;.
When you log in to our app, the state of the app changes: we get a user ID and access token from the Artsy API and
our code assumes that these values never change. This is further complicated by the fact that our app is split into
two pieces: the native code (written in Objective-C and Swift) and the React Native code (written in TypeScript).
You can effectively think of these as &lt;em&gt;two&lt;/em&gt; apps that interoperate with each other. The state now has to be managed
across &lt;em&gt;two&lt;/em&gt; pieces of software, further complexifying the work to add a log out button.&lt;/p&gt;

&lt;p&gt;Returning to the idea of developing features in mind from the start (versus adding them after the fact), our React
Native codebase had always assumed a logged-in user. Adding support for this later on was too difficult (indeed,
our solution was to
&lt;a href=&quot;https://github.com/artsy/emission/pull/2027/files#diff-0cc174f9197fd0b06ecbd2eaa0247833R1020&quot;&gt;invalidate the entire React Native runtime upon log out&lt;/a&gt;).
This wasn&#39;t a limitation of React Native, but rather it was a limitation of how we chose to organize our code. If
we&#39;d added a log out button earlier in the product lifetime, it wouldn&#39;t have been so difficult. The longer we
waited, the more and more code we wrote that implicitly relied upon our existing limitations.&lt;/p&gt;

&lt;p&gt;In this way, the &lt;em&gt;absence&lt;/em&gt; of a feature had gained its own inertia. The missing feature became a present absence,
and I think there&#39;s more to think about there â€“ maybe for another blog post.&lt;/p&gt;

&lt;p&gt;So what we had was a difficult technical problem that wasn&#39;t &lt;em&gt;that&lt;/em&gt; high of priority and didn&#39;t have an obvious
solution. Our product team wasn&#39;t feeling the pain, but our colleagues who interface more directly with our users
&lt;em&gt;were&lt;/em&gt; feeling it.&lt;/p&gt;

&lt;p&gt;Artsy kicked off 2020 with a company-wide Hackathon. We run these events roughly once a year, and they provide a
great opportunity for engineers and non-engineers to work together to build something over a few days. Maybe it&#39;s a
brand-new piece of software to help us do our jobs better. Maybe it&#39;s a new zine to collect our favourite artworks
from the site? And maybe, just maybe, it&#39;s a long-neglected user feature that never made the cut in prioritization
meetings.&lt;/p&gt;

&lt;p&gt;Among all the ideas that Artsy staff submitted for the Hackathon, the Artsy iOS Log Out button received the third
most votes.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2020-01-15-ios-logout-button-at-last/idea.png&quot; alt=&quot;Screenshot of our Hackathon ideas board&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I sat down with another Mobile Experience engineer, Brian, and the people who submitted the Hackathon idea. If we
were going to build this, it was worth doing right, so we asked questions and learned more about why users need a
log out button at all. I&#39;ll spare you the details, but it suffices to say that I learned a lot.&lt;/p&gt;

&lt;p&gt;Brian and I worked on the feature, digging into the internals of our app and the interop between native and React
Native code. Our solution wasn&#39;t necessarily the &quot;best&quot; solution, but it worked within the assumptions that the app
has already made. Here&#39;s roughly the plan we set out with.&lt;/p&gt;

&lt;p&gt;On the React Native side of the app, build a settings screen with the log out button:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;When the user taps the button, post a notification through &lt;code&gt;NSNotificationCenter&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Also, show the user who they are logged in &lt;em&gt;as&lt;/em&gt; on this screen.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;On the native side of the app, listen for the notification and take the following steps when it&#39;s fired:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Tear down the React Native bridge (invalidate it and release it).&lt;/li&gt;
&lt;li&gt;Tear down the native user interface (set singleton instance to &lt;code&gt;nil&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;Get a fresh unauthenticated API token.&lt;/li&gt;
&lt;li&gt;Use the token to show the sign in/up flow (set the window&#39;s &lt;code&gt;rootViewController&lt;/code&gt; property).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Invalidating the React Native bridge is quite a dramatic action to take, but it&#39;s effective. We chose this solution
because it allows our React Native code to continue assuming that the user ID and access token never change (during
its lifetime, anyway).&lt;/p&gt;

&lt;p&gt;We had a few other items to follow-up on, mostly reference cycles that were holding onto invalid singleton
instances in-memory. Here&#39;s the log out button in action:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/2020-01-15-ios-logout-button-at-last/logout.png&quot; alt=&quot;Screenshot of our new log out button!&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We learned a tonne about the React Native bridge, the existing architecture of our app, and how we&#39;d like to see
that mature going forward.&lt;/p&gt;

&lt;p&gt;I said earlier that the longer we waited, the harder it was to build this log out button because more and more of
our existing code relied upon assumptions that the log out button would break. Now that we &lt;em&gt;do&lt;/em&gt; have a log out
button, &lt;em&gt;new code we write needs to take it into account&lt;/em&gt;. The assumptions coders can make about this codebase are
shifting over time â€“ this is an experience that I never appreciated while working on minimum viable products. I&#39;m
trying to lean into these shifts and use them to drive further modernizations in our codebase. For instance, I&#39;m
already thinking ahead to how everything will work once our sign in/up flow is moved from Objective-C to React
Native (since the user ID and access token &lt;em&gt;will&lt;/em&gt; need to be mutable state).&lt;/p&gt;

&lt;p&gt;In case you&#39;re curious, all our iOS code is open source. The work to add a log out button is totally open source in
&lt;a href=&quot;https://github.com/artsy/emission/pull/2027&quot;&gt;these&lt;/a&gt; &lt;a href=&quot;https://github.com/artsy/eigen/pull/2977&quot;&gt;two&lt;/a&gt; pull requests.&lt;/p&gt;

&lt;p&gt;Any organization structure will lead to features falling through cracks. It just happens, it&#39;s the nature of
structured organizations. What we&#39;ve learned at Artsy is that Hackathons (and cross-team collaboration in general)
are effective &quot;escape hatches&quot; for important-but-not-urgent work to get prioritized. They help our colleagues in
Engineering and other teams get to know each other, get to know our business, and find out what kind of features
our users need â€“ even less-than-glamorous features, like a log out button.&lt;/p&gt;
</description>
        <pubDate>Wed, 15 Jan 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/01/15/ios-logout-button-at-last/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/01/15/ios-logout-button-at-last/</guid>
        
        
        <category>hackathon</category>
        
        <category>ios</category>
        
        <category>tech debt</category>
        
      </item>
    
      <item>
        <title>Better GraphQL Error Handling I - Using Custom Directives</title>
        <description>&lt;p&gt;This will be the first in a series of posts about how we used advanced GraphQL tooling and functionality to better
handle errors occurring during query resolution, and better equip clients to reason about such errors.&lt;/p&gt;

&lt;p&gt;The goal is to describe our current approach, but also do a deep dive into specific ways we&#39;ve extended our
&lt;a href=&quot;https://github.com/artsy/metaphysics&quot;&gt;GraphQL server&lt;/a&gt; to help us accomplish that. If you are an interested GraphQL
user, you may find this useful, even if some of the larger context specifically around how we are using it to help
standardize error handling doesn&#39;t apply.&lt;/p&gt;

&lt;!-- more --&gt;


&lt;a name=&quot;Introduction.and.Initial.Context&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Introduction and Initial Context&lt;/h2&gt;

&lt;p&gt;At Artsy, we use GraphQL as our API language of choice. In particular,
&lt;a href=&quot;https://artsy.github.io/blog/2018/05/08/is-graphql-the-future/&quot;&gt;as&lt;/a&gt;
&lt;a href=&quot;https://artsy.github.io/blog/2016/06/19/graphql-for-mobile/&quot;&gt;we&#39;ve described&lt;/a&gt;
&lt;a href=&quot;https://artsy.github.io/blog/2016/11/02/improving-page-speed-with-graphql/&quot;&gt;before&lt;/a&gt;, we have an orchestration
layer speaking GraphQL, which is what our front-end clients talk to. The GraphQL orchestration layer wraps up
access to several backend services, which are made accessible via a combination of data loaders and
&lt;a href=&quot;https://www.apollographql.com/docs/apollo-server/features/schema-stitching/&quot;&gt;schema stitching&lt;/a&gt;.
&lt;a href=&quot;https://www.apollographql.com/docs/apollo-server/federation/introduction/&quot;&gt;Apollo Federation&lt;/a&gt; is another tool
people are using to bring together disparate backends when using GraphQL in an orchestration layer.&lt;/p&gt;

&lt;p&gt;Now, consider the following query, which is a realistic one you might see when accessing a &#39;product&#39; page.&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;artwork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;andy-warhol-skull&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;mainContentStuff&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;biographicalData&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;userReviews&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Accesses&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;back&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;reviews&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;service&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;Part of the &lt;a href=&quot;https://graphql.github.io/graphql-spec/&quot;&gt;GraphQL spec&lt;/a&gt; advises that one should return a 2XX status
code, even if there are exceptions raised when resolving your query. A non-2XX status code from a GraphQL server
would indicate an error with the server itself. Errors that occur during query resolution can be consolidated and
placed in the &lt;code&gt;errors&lt;/code&gt; key of the response. This is all
&lt;a href=&quot;https://graphql.github.io/graphql-spec/draft/#sec-Errors&quot;&gt;advised by the spec&lt;/a&gt;, and so is found in most GraphQL
implementations.&lt;/p&gt;

&lt;p&gt;Given that this query likely backs a product page, some questions about possible error handling behavior that
immediately arise:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;If there are multiple fields erroring, which error (if any) is reported to the user?&lt;/li&gt;
&lt;li&gt;How does the UI decide whether an error is recoverable? That is, if the &lt;code&gt;mainContentStuff&lt;/code&gt; field for a view has
errored, that&#39;s probably not recoverable, and appropriate feedback should be displayed. But, if user reviews are
unavailable at this time, it&#39;s likely you might still want to render the main view, but with that section
appropriately handled. Is there a generic way to handle this?&lt;/li&gt;
&lt;/ul&gt;


&lt;a name=&quot;Using.a.Directive.to.Eliminate.Ambiguity&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Using a Directive to Eliminate Ambiguity&lt;/h2&gt;

&lt;p&gt;We decided to allow our UI components to declare, using a GraphQL directive, one and only one field in a query to
optionally be the &#39;principal field&#39;. That is, this is the field that, if there are any errors resolving it, should
result in an entire view rendering an appropriate error state. For web, this means a non-2XX status code and
resulting error page. Any errors occurring in field resolution of non-principal fields should still result in a 2XX
to the user, and the UI should be able to gracefully recover from the missing data. Since we use
React/Relay/GraphQL, and GraphQL queries are colocated with UI components, a GraphQL directive is particularly
useful.&lt;/p&gt;

&lt;p&gt;Rewriting the above query, we might do something like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;artwork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;andy-warhol-skull&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;mainContentStuff&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;principalField&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;biographicalData&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;userReviews&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Accesses&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;back&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;reviews&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;service&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This would mean that any errors occuring in resolving &lt;code&gt;mainContentStuff&lt;/code&gt; would result in either a 500 status code
and error page to the user, or possibly a more specific error and status code. However, any errors occurring in
resolving user reviews or other fields, would not cause a 500 and error page. Instead, there would be a 200 and the
UI would render. This means that our UI components should generally be defensive about their incoming props being
&lt;code&gt;null&lt;/code&gt; (which is likely what you&#39;d see when the corresponding field errors during query resolution). Using
TypeScript and
&lt;a href=&quot;https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html&quot;&gt;strict null checking&lt;/a&gt; can help
make your UI bulletproof to these sorts of issues.&lt;/p&gt;

&lt;p&gt;With this context, let&#39;s look at how we implement a custom &lt;code&gt;@principalField&lt;/code&gt; GraphQL directive. Future posts in
this series talking about custom GraphQL functionality will likely skip this intro section.&lt;/p&gt;

&lt;a name=&quot;Implementing.a.Custom.GraphQL.Directive&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Implementing a Custom GraphQL Directive&lt;/h2&gt;

&lt;p&gt;First, we have a new directive that we&#39;d like to add to our schema. That is, we&#39;d like a client to be able to
specify &lt;code&gt;@principalField&lt;/code&gt; alongside any field, and have that query be validated correctly by the server. You can
&lt;a href=&quot;https://metaphysics-staging.artsy.net/?query=%7B%0Aartwork(id%3A%22andy-warhol-skull%22)%20%40nonExistentDirective%7B%0A%20%20id%0A%7D%7D&quot;&gt;see for yourself&lt;/a&gt;
how &lt;a href=&quot;https://github.com/graphql/graphql-js&quot;&gt;graphql-js&lt;/a&gt; and
&lt;a href=&quot;https://github.com/graphql/express-graphql&quot;&gt;express-graphql&lt;/a&gt; respond when an unknown directive is specified. Your
GraphQL server implementation may look slightly different.&lt;/p&gt;

&lt;p&gt;Turns out, that&#39;s pretty easy to do in &lt;code&gt;graphql-js&lt;/code&gt;. We declare a variable of type &lt;code&gt;GraphQLDirective&lt;/code&gt;, which
operates on a &lt;code&gt;DirectiveLocation.FIELD&lt;/code&gt; location:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PrincipalFieldDirective&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;GraphQLDirective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;principalField&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;locations&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DirectiveLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;FIELD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;and then when we create our schema, we pass this in as &lt;code&gt;directives&lt;/code&gt;. Since this will overwrite the
&lt;a href=&quot;https://www.apollographql.com/docs/apollo-server/schema/directives/&quot;&gt;default directives&lt;/a&gt;, we need to append ours.&lt;/p&gt;

&lt;p&gt;Something like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;specifiedDirectives&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;graphql&amp;quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;GraphQLSchema&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;directives&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[...&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;specifiedDirectives&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PrincipalFieldDirective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;In terms of the SDL for your schema, this is equivalent to the following line:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;nx&quot;&gt;directive&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;principalField&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;FIELD&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;That&#39;s it! You&#39;ve successfully added a new directive to your schema. At this point, your GraphQL server will
properly validate and allow a &lt;code&gt;@principalField&lt;/code&gt; directive specified by a client alongside any field. Now, we do
want to ensure that if this directive is used, it only appears once in your query. We can accomplish this with a
custom GraphQL validation, which we&#39;ll cover in the next post.&lt;/p&gt;

&lt;p&gt;So now, how should we implement the functionality of this directive? We decided that we want to use the
&lt;a href=&quot;https://github.com/graphql/graphql-spec/blob/master/spec/Section%207%20--%20Response.md#response-format&quot;&gt;extensions&lt;/a&gt;
part of our GraphQL response to carry this data, a free-form map of data up to the implementor, which is a perfect
fit for this type of optional additional information. If an error occurs in a field tagged with the directive, we
want the response to look something like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;json&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;quot;data&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nt&quot;&gt;&amp;quot;principalField&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;quot;error&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;In &lt;code&gt;express-graphql&lt;/code&gt;, we&#39;ll need a method appropriate for the
&lt;a href=&quot;https://github.com/graphql/express-graphql#options&quot;&gt;extensions&lt;/a&gt; option. That looks like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;principalFieldDirectiveExtension&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;documentAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getPrincipalFieldDirectivePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;documentAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;errors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;isEqual&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;principalField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;If there is a field designated with the principal field directive, and there is an error at that same path, we&#39;ll
return that information, otherwise do nothing.&lt;/p&gt;

&lt;p&gt;That&#39;s it! We have one additional helper we need to write, &lt;code&gt;getPrincipalFieldDirectivePath&lt;/code&gt;. This builds an array
of all the fields encountered to get to one tagged with our directive. It matches the way the
&lt;a href=&quot;https://graphql.github.io/graphql-spec/June2018/#sec-Errors&quot;&gt;path of an error&lt;/a&gt; is constructed by the server, which
enables us to determine if a particular error was associated with a field tagged with the directive.&lt;/p&gt;

&lt;p&gt;That looks like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;11&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;12&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;13&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;14&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;15&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;16&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;17&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;18&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;19&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;20&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;21&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;22&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;23&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;visit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;BREAK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DocumentNode&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;graphql&amp;quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;kr&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getPrincipalFieldDirectivePath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;documentNode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;DocumentNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;visit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;documentNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;Field&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;enter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;kr&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;alias&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;leave&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;Directive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;principalField&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;BREAK&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;path&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;This uses a &lt;a href=&quot;https://graphql.org/graphql-js/language/#visit&quot;&gt;GraphQL visitor&lt;/a&gt; to traverse our query, and build up
an array of field names. We can exit early with that path if we encounter our directive.&lt;/p&gt;

&lt;a name=&quot;Example.Query&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Example Query&lt;/h2&gt;

&lt;p&gt;Let&#39;s take a look at how you can use this in practice, in order to help standardize when and with what status a UI
can inform the user of an error.&lt;/p&gt;

&lt;p&gt;Something like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;javascript&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nx&quot;&gt;artwork&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;andy-warhol-skull&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;principalField&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;userReviews&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nx&quot;&gt;notes&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nx&quot;&gt;contents&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;results in:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;9&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;10&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;json&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;quot;data&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nt&quot;&gt;&amp;quot;artwork&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;quot;extensions&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nt&quot;&gt;&amp;quot;principalFieldError&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;quot;httpStatusCode&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;and the UI can immediately return an appropriate message to the user, if the artwork is not found. If fetching the
artwork is successful, but there&#39;s an issue with the reviews, the response will look like:&lt;/p&gt;

&lt;div class=&#39;bogus-wrapper&#39;&gt;&lt;notextile&gt;&lt;figure class=&#39;code&#39;&gt;&lt;figcaption&gt;&lt;span&gt;&lt;/span&gt;&lt;/figcaption&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre class=&quot;line-numbers&quot;&gt;&lt;span class=&#39;line-number&#39;&gt;1&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;2&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;3&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;4&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;5&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;6&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;7&lt;/span&gt;
&lt;span class=&#39;line-number&#39;&gt;8&lt;/span&gt;
&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#39;code&#39;&gt;&lt;pre&gt;&lt;code class=&#39;json&#39;&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;quot;data&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;nt&quot;&gt;&amp;quot;artwork&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;quot;userReviews&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;      &lt;span class=&quot;nt&quot;&gt;&amp;quot;contents&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;span class=&#39;line&#39;&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;&lt;/figure&gt;&lt;/notextile&gt;&lt;/div&gt;


&lt;p&gt;We can make sure that our UI components (likely Relay containers) corresponding to &lt;code&gt;userReviews&lt;/code&gt; are defensive
about that incoming prop being &lt;code&gt;null&lt;/code&gt;. Most likely a zero state (&quot;No Reviews Found&quot;), or just skipping the section
entirely, is appropriate.&lt;/p&gt;

&lt;a name=&quot;Conclusion&quot;&gt;&lt;/a&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;In this way, we can standardize on and remove ambiguity about how a UI handles one or more errors in query
resolution and exactly when such an error should be propagated and made user-facing. We can help ensure that our
UI&#39;s are resilient to errors occurring in a leaf.&lt;/p&gt;

&lt;p&gt;In the next post, we&#39;ll look at how we can write a GraphQL validation rule to ensure that a client specifies at
most one field with the &lt;code&gt;@principalField&lt;/code&gt; directive. After that, we&#39;ll take a look at how you can successfully
parse and support GraphQL query resolution errors occurring in a variety of contexts such as during stitching.
Putting this altogether, we hope you will come away with a better understanding of how to extend your GraphQL
server with your own custom behaviors, and in particular how we&#39;ve used these to better log/propagate/present the
potential errors occurring during a query.&lt;/p&gt;
</description>
        <pubDate>Mon, 13 Jan 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/01/13/graphql-custom-directives/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/01/13/graphql-custom-directives/</guid>
        
        
        <category>error handling</category>
        
        <category>graphql</category>
        
      </item>
    
      <item>
        <title>Is this you? No, really, is this you?</title>
        <description>&lt;p&gt;You are a software engineer.&lt;/p&gt;

&lt;p&gt;You consider yourself an introvert, and you really appreciate &quot;engineering time&quot;, where you prefer to work for
extended uninterrupted periods because interruptions wreck you. You are used to being misunderstood. Ever since you
can remember the people around you have been kind of baffling: they constantly fail to notice stuff that&#39;s really
obvious and important to you, and then they have the audacity to get frustrated with you for not understanding
&lt;em&gt;them&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;But whatever, you can deal with this, right? This is just how life goes, right? Everyone&#39;s like this, right?&lt;/p&gt;

&lt;p&gt;Right?&lt;/p&gt;

&lt;!-- more --&gt;


&lt;p&gt;It&#39;s really been like this as long as you can remember. Maybe even as early as kindergarten, when you distinctly
remember feeling &quot;Wow, I guess all these kids must already know each other?&quot; because how else would they know how
to just start playing together? You might have gotten really, really good at languages -- or you might have
eschewed the humanities entirely and focused on things like Math and Science. Regardless, you were in it for the
&lt;em&gt;systems&lt;/em&gt; -- grammar just &lt;em&gt;makes sense&lt;/em&gt; to you, in the same way software engineering just &lt;em&gt;makes sense&lt;/em&gt; to you now.
Math, you finally understood, was just a specialized language for referring to the relations between things --
sure, okay!&lt;/p&gt;

&lt;p&gt;Socially, things were always a little weird for you. Other people never &lt;em&gt;quite&lt;/em&gt; behaved in ways that made sense to
you, and especially when younger you probably socialized by getting &#39;adopted&#39; by some other kid who seemed to know
what was going on. Whatever you studied you poured yourself into deeply as long as it held your interest -- your
mind expanded into the space your lessons created and eagerly walked hidden pathways that your classmates didn&#39;t
see. You asked the questions in class that surprised the teacher and annoyed your peers, and you probably got damn
good grades.&lt;/p&gt;

&lt;p&gt;You may have been bullied.&lt;/p&gt;

&lt;p&gt;You likely went to college and focused on something that interested you -- perhaps you doubled down on language, or
maybe you went into engineering or music or math. It was a revelation, because maybe for the first time in your
life you were surrounded by a self-selecting group of peers, some of whom shared your passion for analysis and deep
thinking. You didn&#39;t have to go to great lengths to establish a shared context, for instance. You could speak words
that were meaningful to you and someone else could understand and offer a meaningful response, and this made you
feel uncomfortable at first but you really loved it. Your experience of college was maybe a bit different than you
expected - certainly nothing like the movies you watched as a kid. You got really into a weird hobby, maybe, and
didn&#39;t end up going to too many parties.&lt;/p&gt;

&lt;p&gt;Relationships and intimacy have always been a bit fraught for you. You frequently find yourself trying to figure
out what you&#39;re supposed to be feeling, and you work hard to show your partner the person you want to be. Maybe
when you first moved in with someone you had a bit of a freakout that has made you nervous to think about ever
since, or maybe meeting a significant other&#39;s family has been so anxiety-inducing as to prove impossible. Maybe you
have a string of failed relationships behind you, each of them starting out so promisingly and then imploding
catastrophically and confusingly once the initial honeymoon phase was over and it was time to really get to know,
get to grow with another person. You don&#39;t know how to do that, and every time you try you seem to make someone
upset.&lt;/p&gt;

&lt;p&gt;You&#39;re a software engineer at least partly because computers are much easier to communicate with than people. When
a computer doesn&#39;t understand you it&#39;s because you&#39;ve done something wrong. When a computer says something
incorrect it&#39;s also because you&#39;ve done something wrong. You can step through and rigorously debug the problem,
identifying and isolating the mistake. The more you played around with tech the more you liked it - and when you
discovered programming it blew your mind, because you &lt;em&gt;intuitively&lt;/em&gt; understood the relational nature of computation
and found yourself suddenly gifted with superpowers.&lt;/p&gt;

&lt;p&gt;When you entered the working world you were REALLY confused, though. You were able to complete a week&#39;s worth of
assignments in an afternoon. It was really obvious to you who was working intelligently and who was not, and you
had to learn, perhaps painfully, that sharing that kind of feedback isn&#39;t always constructive. Maybe one day you
got some criticism about something you did and it really hurt in ways you didn&#39;t expect. Maybe you found yourself
reacting defensively, and the next thing you know you&#39;re in a meeting with HR over what to you was clearly all a
big misunderstanding, but nobody is smiling. Or maybe instead someone recognized that you were having a tough time,
and stepped in to defuse the situation.&lt;/p&gt;

&lt;p&gt;Regardless, your agency was compromised. You found yourself resenting the arbitrary and unwritten rules of the
professional world: you have to be at your desk and looking busy even when you&#39;re just thinking; let people say
things that are not true if correcting them publicly will embarrass someone; people will ignore your advice and
then something will break because of it and it&#39;s very important not to get too upset.&lt;/p&gt;

&lt;p&gt;You&#39;re used to modeling the world in a specific way, but school didn&#39;t actually prepare you in any way for the
complex web of social dynamics that, just like in kindergarten, everyone else seems to grok. It&#39;s really
frustrating, maybe you&#39;ve been fired once or twice, maybe you&#39;ve left a few jobs out of embarrassment. You
eventually figured it out -- or maybe you didn&#39;t! The thing is, programming has never been the hard part of work,
for you. The people have been the much more interesting and challenging domain to master.&lt;/p&gt;

&lt;p&gt;Today, you&#39;re an engineer who really deeply understands and enjoys your stack. You have workflows that you can do
in your sleep, you know intuitively what the current state of your system is and you have a powerful intuition for
downstream problems. Maybe you&#39;ve figured out how to play the social game, in which case you&#39;re probably gregarious
and supportive and kind to your coworkers. Maybe you haven&#39;t, in which case you&#39;re super productive but don&#39;t
attend a lot of office functions. Either way is fine as long as you&#39;ve found a place where you feel comfortable!&lt;/p&gt;

&lt;p&gt;At the same time, you&#39;ve had a sense for years that something isn&#39;t quite... right. You&#39;ve probably learned to
ignore it. Sure things get super stressful sometimes. Sure you find yourself really unreasonably tired, especially
after meeting-heavy days. Sure when you get downtime sometimes all you can do is just sit there doing nothing --
maybe you feel bad about that? Maybe you use an abnormally high number of sick days purely for mental health
reasons. Maybe you&#39;ve got a substance abuse issue. You&#39;re probably struggling with codependency, anxiety and/or
depression. You think of yourself as just &quot;a depressed person&quot;, but try not to let it define you. You feel
constantly on the edge of burnout, but no matter how many vacations you take it doesn&#39;t seem to get any better.&lt;/p&gt;

&lt;p&gt;Maybe you are sensitive to certain kinds of sensory stimuli - like, you can&#39;t wear synthetic fabric because it just
feels gross. Maybe you can&#39;t eat peaches because the peach fuzz on the roof of your mouth is unbearable. Maybe you
can&#39;t go into a well-lit room without sunglasses, maybe every sound you hear comes in at the same volume. Maybe a
bunch of these kinds of things or more bother you, and maybe you&#39;ve forgotten because you&#39;ve just pushed through
them your whole life. Maybe you&#39;ve accepted that you&#39;re just kind of weird and different.&lt;/p&gt;

&lt;p&gt;But maybe -- and this may be the best news you&#39;ve ever received -- you&#39;re autistic.&lt;/p&gt;

&lt;p&gt;Many (if not most) autistic people would tell you similar stories about their personal histories, especially those
who have gone undiagnosed into adulthood. If these descriptions resonate with you -- maybe not exactly, but maybe
you can see the shape I&#39;m trying to paint -- then it&#39;s worth considering the possibility that you may be
&lt;strong&gt;neurodivergent&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Autism is one form of neurodiversity, and what I&#39;m describing above is a very autistic experience - but there&#39;s a
ton of overlap with ADHD, Dyslexia and other neurodivergent conditions. We&#39;ve learned so much about neurodiversity
in the past ten years, and even if you consider yourself fairly well-informed about autism it&#39;s worth updating your
understanding.&lt;/p&gt;

&lt;p&gt;Your first step, quite reasonably, might be to go take a look at the
&lt;a href=&quot;https://www.cdc.gov/ncbddd/autism/hcp-dsm.html&quot;&gt;official diagnostic criteria&lt;/a&gt; for autism. But autistic or not, if
you do that you will in all likelihood not see yourself reflected -- those criteria are purely behavioral, while
the experience of being autistic is purely subjective. Non-autistic (or &quot;allistic&quot;) experts on autism document
observable behavior but don&#39;t actually understand what they&#39;re seeing. I tried to
&lt;a href=&quot;https://theaspergian.com/2019/04/17/humanizing-the-dsm-diagnosis-for-autism/&quot;&gt;reframe those criteria&lt;/a&gt; in a way
that makes them feel human and relatable rather than inhuman and other.&lt;/p&gt;

&lt;p&gt;I&#39;m writing this blog post because my own self-diagnosis at age 34 and formal diagnosis this past fall at age 36
changed my life, and I &lt;em&gt;know for a fact&lt;/em&gt; that there going to be some autistic people reading this who don&#39;t know
that they&#39;re autistic.&lt;/p&gt;

&lt;p&gt;If you&#39;re interested in learning more, I highly recommend perusing
&lt;a href=&quot;https://reddit.com/r/autismTranslated&quot;&gt;AutismTranslated&lt;/a&gt;, a subreddit to make autistic traits more recognizable
and relatable to those of us who subjectively experience them. I&#39;m personally most active
&lt;a href=&quot;https://twitter.com/mykola&quot;&gt;on twitter&lt;/a&gt; these days and you can always find me there, along with hundreds of other
folks using the &lt;a href=&quot;https://twitter.com/search?q=%23actuallyAutistic&quot;&gt;#actuallyAutistic&lt;/a&gt;,
&lt;a href=&quot;https://twitter.com/search?q=%23allAutistics&quot;&gt;#allAutistics&lt;/a&gt; and
&lt;a href=&quot;https://twitter.com/search?q=%23askingAutistics&quot;&gt;#askingAutistics&lt;/a&gt; hashtags. Autism is a condition particularly
vulnerable to intersectional dynamics, which means that resources like
&lt;a href=&quot;https://twitter.com/search?q=%23autisticWhileBlack&quot;&gt;#autisticWhileBlack&lt;/a&gt; and
&lt;a href=&quot;https://reddit.com/r/aspergirls&quot;&gt;/r/aspergirls&lt;/a&gt; are crucial to folks in those demographics.&lt;/p&gt;

&lt;p&gt;Finally, as preparation for this blog post I asked diagnosed neurodivergent tech workers on twitter
&lt;a href=&quot;https://twitter.com/mykola/status/1205927773644214273&quot;&gt;to volunteer if they&#39;re willing to answer questions&lt;/a&gt;, and
as of this writing over a hundred people have answered. So if you want to know more about what this is like --
whether you want to better understand yourself or you have other people in your life you want to learn how to
better support -- please check out that thread and the huge number of responses, and don&#39;t be afraid to reach out
to people!&lt;/p&gt;

&lt;p&gt;If you&#39;re autistic and undiagnosed you&#39;re living life on hard mode and you don&#39;t even know it. Learning who you
are, learning what your authentic needs are and learning how to heal from years of maladaptive coping mechanisms
can and will change your life in a million ways. You can move from barely getting by to thriving as your most
authentic self.&lt;/p&gt;

&lt;p&gt;I see you and I believe in you, and there are a lot of us out here ready to help. &amp;lt;3&lt;/p&gt;
</description>
        <pubDate>Mon, 06 Jan 2020 00:00:00 +0000</pubDate>
        <link>http://artsy.github.io/blog/2020/01/06/is-this-you/</link>
        <guid isPermaLink="true">http://artsy.github.io/blog/2020/01/06/is-this-you/</guid>
        
        
        <category>autism</category>
        
        <category>culture</category>
        
        <category>diversity</category>
        
        <category>mental-health</category>
        
        <category>neurodiversity</category>
        
      </item>
    
  </channel>
</rss>
